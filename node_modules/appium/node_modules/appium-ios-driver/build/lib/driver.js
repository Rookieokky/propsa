'use strict';

var _get = require('babel-runtime/helpers/get')['default'];

var _inherits = require('babel-runtime/helpers/inherits')['default'];

var _createClass = require('babel-runtime/helpers/create-class')['default'];

var _classCallCheck = require('babel-runtime/helpers/class-call-check')['default'];

var _slicedToArray = require('babel-runtime/helpers/sliced-to-array')['default'];

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _Object$assign = require('babel-runtime/core-js/object/assign')['default'];

var _getIterator = require('babel-runtime/core-js/get-iterator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _appiumBaseDriver = require('appium-base-driver');

var _utils = require('./utils');

var _utils2 = _interopRequireDefault(_utils);

var _logger = require('./logger');

var _logger2 = _interopRequireDefault(_logger);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _appiumSupport = require('appium-support');

var _appiumIosSimulator = require('appium-ios-simulator');

var _appiumUiauto = require('appium-uiauto');

var _appiumInstruments = require('appium-instruments');

var _asyncbox = require('asyncbox');

var _appiumIosLog = require('appium-ios-log');

var _commandsIndex = require('./commands/index');

var _commandsIndex2 = _interopRequireDefault(_commandsIndex);

var _desiredCaps = require('./desired-caps');

var _desiredCaps2 = _interopRequireDefault(_desiredCaps);

var _mobileJsonWireProtocol = require('mobile-json-wire-protocol');

var _nodeIdevice = require('node-idevice');

var _nodeIdevice2 = _interopRequireDefault(_nodeIdevice);

var _commandsSafari = require('./commands/safari');

var _safariLauncher = require('./safari-launcher');

// promisify _iDevice
var iDevice = function iDevice() {
  var device = _nodeIdevice2['default'].apply(undefined, arguments);
  var promisified = {};
  var _arr = ['install', 'installAndWait', 'remove', 'isInstalled'];
  for (var _i = 0; _i < _arr.length; _i++) {
    var m = _arr[_i];
    promisified[m] = _bluebird2['default'].promisify(device[m].bind(device));
  }
  return promisified;
};

var serverCapabilities = {
  webStorageEnabled: false,
  locationContextEnabled: false,
  browserName: '',
  platform: 'MAC',
  javascriptEnabled: true,
  databaseEnabled: false,
  takesScreenshot: true,
  networkConnectionEnabled: false
};

var IosDriver = (function (_BaseDriver) {
  _inherits(IosDriver, _BaseDriver);

  _createClass(IosDriver, [{
    key: 'resetIos',
    value: function resetIos() {
      this.appExt = ".app";
      _lodash2['default'].defaults(this.opts, serverCapabilities);
      this.xcodeVersion = null;
      this.iosSdkVersion = null;
      this.iosSimUdid = null;
      this.logs = {};
      this.instruments = null;
      this.uiAutoClient = null;
      this.onInstrumentsDie = function () {};
      this.stopping = false;
      this.cbForCurrentCmd = null;
      this.remote = null;
      this.curContext = null;
      this.curWebFrames = [];
      this.selectingNewPage = false;
      this.windowHandleCache = [];
      this.webElementIds = [];
      this.implicitWaitMs = 0;
      this.asynclibWaitMs = 0;
      this.pageLoadMs = 6000;
      this.asynclibResponseCb = null;
      this.returnedFromExecuteAtom = {};
      this.executedAtomsCounter = 0;
      this.curCoords = null;
      this.curWebCoords = null;
      this.landscapeWebCoordsOffset = 0;
      this.keepAppToRetainPrefs = false;
      this.ready = false;
      this.asyncWaitMs = 0;

      this.settings = new _appiumBaseDriver.DeviceSettings({}, _lodash2['default'].noop);

      this.locatorStrategies = ['xpath', 'id', 'class name', '-ios uiautomation', 'accessibility id'];
      this.webLocatorStrategies = ['link text', 'css selector', 'tag name', 'partial link text'];
    }
  }]);

  function IosDriver(opts, shouldValidateCaps) {
    _classCallCheck(this, IosDriver);

    _get(Object.getPrototypeOf(IosDriver.prototype), 'constructor', this).call(this, opts, shouldValidateCaps);

    this.desiredCapConstraints = _desiredCaps2['default'];
    this.resetIos();
  }

  _createClass(IosDriver, [{
    key: 'validateLocatorStrategy',
    value: function validateLocatorStrategy(strategy) {
      _get(Object.getPrototypeOf(IosDriver.prototype), 'validateLocatorStrategy', this).call(this, strategy, this.isWebContext());
    }
  }, {
    key: 'start',
    value: function start() {
      return _regeneratorRuntime.async(function start$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            if (!this.isRealDevice()) {
              context$2$0.next = 5;
              break;
            }

            context$2$0.next = 3;
            return _regeneratorRuntime.awrap(this.startRealDevice());

          case 3:
            context$2$0.next = 7;
            break;

          case 5:
            context$2$0.next = 7;
            return _regeneratorRuntime.awrap(this.startSimulator());

          case 7:
            this.ready = true;

          case 8:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'createSession',
    value: function createSession(caps) {
      var _ref, _ref2, sessionId;

      return _regeneratorRuntime.async(function createSession$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            context$2$0.next = 2;
            return _regeneratorRuntime.awrap(_get(Object.getPrototypeOf(IosDriver.prototype), 'createSession', this).call(this, caps));

          case 2:
            _ref = context$2$0.sent;
            _ref2 = _slicedToArray(_ref, 1);
            sessionId = _ref2[0];

            // merge server capabilities + desired capabilities
            this.caps = _Object$assign({}, serverCapabilities, this.caps);
            this.caps.desired = caps;

            context$2$0.next = 9;
            return _regeneratorRuntime.awrap(_utils2['default'].detectUdid(this.opts));

          case 9:
            context$2$0.next = 11;
            return _regeneratorRuntime.awrap(_utils2['default'].prepareIosOpts(this.opts));

          case 11:
            this.realDevice = null;
            this.useRobot = this.opts.useRobot;
            this.safari = this.opts.safari;
            this.curOrientation = this.opts.initialOrientation;

            this.sock = _path2['default'].resolve(this.opts.tmpDir || '/tmp', 'instruments_sock');
            this.perfLogEnabled = !!(typeof this.opts.loggingPrefs === 'object' && this.opts.loggingPrefs.performance);
            context$2$0.prev = 17;
            context$2$0.next = 20;
            return _regeneratorRuntime.awrap(this.configureApp());

          case 20:
            context$2$0.next = 26;
            break;

          case 22:
            context$2$0.prev = 22;
            context$2$0.t0 = context$2$0['catch'](17);

            _logger2['default'].error('Bad app: \'' + this.opts.app + '\'. App paths need to ' + 'be absolute, or relative to the appium server ' + 'install dir, or a URL to compressed file, or a ' + 'special app name.');
            throw context$2$0.t0;

          case 26:
            context$2$0.next = 28;
            return _regeneratorRuntime.awrap(this.start());

          case 28:

            // TODO: this should be in BaseDriver.postCreateSession
            this.startNewCommandTimeout('createSession');
            return context$2$0.abrupt('return', [sessionId, this.caps]);

          case 30:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this, [[17, 22]]);
    }
  }, {
    key: 'stop',
    value: function stop() {
      return _regeneratorRuntime.async(function stop$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            this.ready = false;

            if (!this.uiAutoClient) {
              context$2$0.next = 4;
              break;
            }

            context$2$0.next = 4;
            return _regeneratorRuntime.awrap(this.uiAutoClient.shutdown());

          case 4:
            if (!this.instruments) {
              context$2$0.next = 13;
              break;
            }

            context$2$0.prev = 5;
            context$2$0.next = 8;
            return _regeneratorRuntime.awrap(this.instruments.shutdown());

          case 8:
            context$2$0.next = 13;
            break;

          case 10:
            context$2$0.prev = 10;
            context$2$0.t0 = context$2$0['catch'](5);

            _logger2['default'].error('Instruments didn\'t shut down. ' + context$2$0.t0);

          case 13:

            this.uiAutoClient = null;
            this.instruments = null;
            this.realDevice = null;

            // postcleanup
            this.curCoords = null;
            this.opts.curOrientation = null;
            if (!_lodash2['default'].isEmpty(this.logs)) {
              this.logs.syslog.stopCapture();
              this.logs = {};
            }

            if (!this.remote) {
              context$2$0.next = 22;
              break;
            }

            context$2$0.next = 22;
            return _regeneratorRuntime.awrap(this.stopRemote());

          case 22:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this, [[5, 10]]);
    }
  }, {
    key: 'deleteSession',
    value: function deleteSession() {
      return _regeneratorRuntime.async(function deleteSession$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            _logger2['default'].debug("Deleting ios session");

            context$2$0.next = 3;
            return _regeneratorRuntime.awrap(this.stop());

          case 3:
            if (!this.isRealDevice()) {
              context$2$0.next = 8;
              break;
            }

            context$2$0.next = 6;
            return _regeneratorRuntime.awrap(this.runRealDeviceReset());

          case 6:
            context$2$0.next = 10;
            break;

          case 8:
            context$2$0.next = 10;
            return _regeneratorRuntime.awrap(this.runSimReset());

          case 10:
            context$2$0.next = 12;
            return _regeneratorRuntime.awrap(_get(Object.getPrototypeOf(IosDriver.prototype), 'deleteSession', this).call(this));

          case 12:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'executeCommand',
    value: function executeCommand(cmd) {
      for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
        args[_key - 1] = arguments[_key];
      }

      var _get2;

      return _regeneratorRuntime.async(function executeCommand$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            _logger2['default'].debug('Executing iOS command \'' + cmd + '\'');

            if (!(cmd === 'receiveAsyncResponse')) {
              context$2$0.next = 7;
              break;
            }

            context$2$0.next = 4;
            return _regeneratorRuntime.awrap(this.receiveAsyncResponse.apply(this, args));

          case 4:
            return context$2$0.abrupt('return', context$2$0.sent);

          case 7:
            if (!(this.ready || _lodash2['default'].includes(['launchApp'], cmd))) {
              context$2$0.next = 11;
              break;
            }

            context$2$0.next = 10;
            return _regeneratorRuntime.awrap((_get2 = _get(Object.getPrototypeOf(IosDriver.prototype), 'executeCommand', this)).call.apply(_get2, [this, cmd].concat(args)));

          case 10:
            return context$2$0.abrupt('return', context$2$0.sent);

          case 11:
            throw new _mobileJsonWireProtocol.errors.NoSuchDriverError('Driver is not ready, cannot execute ' + cmd + '.');

          case 12:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }

    // TODO: reformat this.helpers + configureApp
  }, {
    key: 'configureApp',
    value: function configureApp() {
      var ext;
      return _regeneratorRuntime.async(function configureApp$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            context$2$0.prev = 0;

            // if the app name is a bundleId assign it to the bundleId property
            if (!this.opts.bundleId && _utils2['default'].appIsPackageOrBundle(this.opts.app)) {
              this.opts.bundleId = this.opts.app;
            }

            // if we have an ipa file, set it in opts
            if (this.opts.app) {
              ext = this.opts.app.substring(this.opts.app.length - 3).toLowerCase();

              if (ext === 'ipa') {
                this.opts.ipa = this.opts.app;
              }
            }

            if (!(this.opts.app && this.opts.app.toLowerCase() === "settings")) {
              context$2$0.next = 7;
              break;
            }

            if (parseFloat(this.opts.platformVersion) >= 8) {
              _logger2['default'].debug("We are on iOS8+ so not copying preferences app");
              this.opts.bundleId = "com.apple.Preferences";
              this.opts.app = null;
            }
            context$2$0.next = 31;
            break;

          case 7:
            if (!this.isSafari()) {
              context$2$0.next = 24;
              break;
            }

            if (this.isRealDevice()) {
              context$2$0.next = 12;
              break;
            }

            if (parseFloat(this.opts.platformVersion) >= 8) {
              _logger2['default'].debug("We are on iOS8+ so not copying Safari app");
              this.opts.bundleId = _commandsSafari.SAFARI_BUNDLE;
              this.opts.app = null;
            }
            context$2$0.next = 22;
            break;

          case 12:
            context$2$0.next = 14;
            return _regeneratorRuntime.awrap(this.realDevice.isInstalled(this.opts.bundleId));

          case 14:
            if (context$2$0.sent) {
              context$2$0.next = 21;
              break;
            }

            context$2$0.next = 17;
            return _regeneratorRuntime.awrap((0, _safariLauncher.needsInstall)());

          case 17:
            if (!context$2$0.sent) {
              context$2$0.next = 21;
              break;
            }

            _logger2['default'].debug('SafariLauncher not found, building...');
            context$2$0.next = 21;
            return _regeneratorRuntime.awrap((0, _safariLauncher.install)());

          case 21:
            this.opts.bundleId = _safariLauncher.SAFARI_LAUNCHER_BUNDLE;

          case 22:
            context$2$0.next = 31;
            break;

          case 24:
            if (!(this.opts.bundleId && _utils2['default'].appIsPackageOrBundle(this.opts.bundleId) && (this.opts.app === "" || _utils2['default'].appIsPackageOrBundle(this.opts.app)))) {
              context$2$0.next = 28;
              break;
            }

            // we have a bundle ID, but no app, or app is also a bundle
            _logger2['default'].debug("App is an iOS bundle, will attempt to run as pre-existing");
            context$2$0.next = 31;
            break;

          case 28:
            context$2$0.next = 30;
            return _regeneratorRuntime.awrap(this.helpers.configureApp(this.opts.app, '.app'));

          case 30:
            this.opts.app = context$2$0.sent;

          case 31:
            context$2$0.next = 37;
            break;

          case 33:
            context$2$0.prev = 33;
            context$2$0.t0 = context$2$0['catch'](0);

            _logger2['default'].error(context$2$0.t0);
            throw new Error('Bad app: ' + this.opts.app + '. App paths need to be absolute, or relative to the appium ' + "server install dir, or a URL to compressed file, or a special app name.");

          case 37:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this, [[0, 33]]);
    }
  }, {
    key: 'startSimulator',
    value: function startSimulator() {
      var dString;
      return _regeneratorRuntime.async(function startSimulator$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            context$2$0.next = 2;
            return _regeneratorRuntime.awrap(_utils2['default'].removeInstrumentsSocket(this.sock));

          case 2:

            _logger2['default'].debug("Setting Xcode version");
            context$2$0.next = 5;
            return _regeneratorRuntime.awrap(_utils2['default'].getAndCheckXcodeVersion(this.opts));

          case 5:
            this.xcodeVersion = context$2$0.sent;

            _logger2['default'].debug('Xcode version set to ' + this.xcodeVersion);

            _logger2['default'].debug("Setting iOS SDK Version");
            context$2$0.next = 10;
            return _regeneratorRuntime.awrap(_utils2['default'].getAndCheckIosSdkVersion());

          case 10:
            this.iosSdkVersion = context$2$0.sent;

            _logger2['default'].debug('iOS SDK Version set to ' + this.iosSdkVersion);

            context$2$0.next = 14;
            return _regeneratorRuntime.awrap(this.checkSimAvailable());

          case 14:
            context$2$0.next = 16;
            return _regeneratorRuntime.awrap(this.moveBuiltInApp());

          case 16:
            context$2$0.next = 18;
            return _regeneratorRuntime.awrap((0, _appiumIosSimulator.getSimulator)(this.iosSimUdid, this.xcodeVersion));

          case 18:
            this.sim = context$2$0.sent;
            context$2$0.next = 21;
            return _regeneratorRuntime.awrap(_utils2['default'].parseLocalizableStrings(this.opts));

          case 21:
            context$2$0.next = 23;
            return _regeneratorRuntime.awrap(_utils2['default'].setBundleIdFromApp(this.opts));

          case 23:
            context$2$0.next = 25;
            return _regeneratorRuntime.awrap(this.createInstruments());

          case 25:
            // previously setDeviceInfo()
            this.shouldPrelaunchSimulator = _utils2['default'].shouldPrelaunchSimulator(this.opts, this.iosSdkVersion);
            context$2$0.next = 28;
            return _regeneratorRuntime.awrap(this.adjustedDeviceName());

          case 28:
            dString = context$2$0.sent;

            if (!this.caps.app) {
              context$2$0.next = 32;
              break;
            }

            context$2$0.next = 32;
            return _regeneratorRuntime.awrap(_utils2['default'].setDeviceTypeInInfoPlist(this.opts.app, dString));

          case 32:
            context$2$0.next = 34;
            return _regeneratorRuntime.awrap(this.checkPreferences());

          case 34:
            context$2$0.next = 36;
            return _regeneratorRuntime.awrap(this.runSimReset());

          case 36:
            context$2$0.next = 38;
            return _regeneratorRuntime.awrap(this.isolateSimDevice());

          case 38:
            context$2$0.next = 40;
            return _regeneratorRuntime.awrap(this.setLocale());

          case 40:
            context$2$0.next = 42;
            return _regeneratorRuntime.awrap(this.setPreferences());

          case 42:
            context$2$0.next = 44;
            return _regeneratorRuntime.awrap(this.startLogCapture());

          case 44:
            context$2$0.next = 46;
            return _regeneratorRuntime.awrap(this.prelaunchSimulator());

          case 46:
            context$2$0.next = 48;
            return _regeneratorRuntime.awrap(this.startInstruments());

          case 48:
            context$2$0.next = 50;
            return _regeneratorRuntime.awrap(this.onInstrumentsLaunch());

          case 50:
            context$2$0.next = 52;
            return _regeneratorRuntime.awrap(this.configureBootstrap());

          case 52:
            context$2$0.next = 54;
            return _regeneratorRuntime.awrap(this.setBundleId());

          case 54:
            context$2$0.next = 56;
            return _regeneratorRuntime.awrap(this.setInitialOrientation());

          case 56:
            context$2$0.next = 58;
            return _regeneratorRuntime.awrap(this.initAutoWebview());

          case 58:
            context$2$0.next = 60;
            return _regeneratorRuntime.awrap(this.waitForAppLaunched());

          case 60:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'startRealDevice',
    value: function startRealDevice() {
      return _regeneratorRuntime.async(function startRealDevice$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            context$2$0.next = 2;
            return _regeneratorRuntime.awrap(_utils2['default'].removeInstrumentsSocket(this.sock));

          case 2:
            context$2$0.next = 4;
            return _regeneratorRuntime.awrap(_utils2['default'].parseLocalizableStrings(this.opts));

          case 4:
            context$2$0.next = 6;
            return _regeneratorRuntime.awrap(_utils2['default'].setBundleIdFromApp(this.opts));

          case 6:
            context$2$0.next = 8;
            return _regeneratorRuntime.awrap(this.createInstruments());

          case 8:
            context$2$0.next = 10;
            return _regeneratorRuntime.awrap(this.runRealDeviceReset());

          case 10:
            context$2$0.next = 12;
            return _regeneratorRuntime.awrap(this.startLogCapture());

          case 12:
            context$2$0.next = 14;
            return _regeneratorRuntime.awrap(this.installToRealDevice());

          case 14:
            context$2$0.next = 16;
            return _regeneratorRuntime.awrap(this.startInstruments());

          case 16:
            context$2$0.next = 18;
            return _regeneratorRuntime.awrap(this.onInstrumentsLaunch());

          case 18:
            context$2$0.next = 20;
            return _regeneratorRuntime.awrap(this.configureBootstrap());

          case 20:
            context$2$0.next = 22;
            return _regeneratorRuntime.awrap(this.setBundleId());

          case 22:
            context$2$0.next = 24;
            return _regeneratorRuntime.awrap(this.setInitialOrientation());

          case 24:
            context$2$0.next = 26;
            return _regeneratorRuntime.awrap(this.initAutoWebview());

          case 26:
            context$2$0.next = 28;
            return _regeneratorRuntime.awrap(this.waitForAppLaunched());

          case 28:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'installToRealDevice',
    value: function installToRealDevice() {
      var msg;
      return _regeneratorRuntime.async(function installToRealDevice$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            if (!(this.opts.autoLaunch === false)) {
              context$2$0.next = 2;
              break;
            }

            return context$2$0.abrupt('return');

          case 2:
            if (!this.opts.udid) {
              context$2$0.next = 35;
              break;
            }

            context$2$0.next = 5;
            return _regeneratorRuntime.awrap(this.realDevice.isInstalled(this.opts.bundleId));

          case 5:
            if (!context$2$0.sent) {
              context$2$0.next = 15;
              break;
            }

            _logger2['default'].debug("App is installed.");

            if (!this.opts.fullReset) {
              context$2$0.next = 11;
              break;
            }

            _logger2['default'].debug("fullReset requested. Forcing app install.");
            context$2$0.next = 13;
            break;

          case 11:
            _logger2['default'].debug("fullReset not requested. No need to install.");
            return context$2$0.abrupt('return');

          case 13:
            context$2$0.next = 16;
            break;

          case 15:
            _logger2['default'].debug("App is not installed. Will try to install the app.");

          case 16:
            if (!(this.opts.ipa && this.opts.bundleId)) {
              context$2$0.next = 21;
              break;
            }

            context$2$0.next = 19;
            return _regeneratorRuntime.awrap(this.installIpa());

          case 19:
            context$2$0.next = 33;
            break;

          case 21:
            if (!this.opts.ipa) {
              context$2$0.next = 27;
              break;
            }

            msg = "You specified a UDID and ipa but did not include the bundle id";

            _logger2['default'].warn(msg);
            throw new _mobileJsonWireProtocol.errors.UnknownError(msg);

          case 27:
            if (!this.opts.app) {
              context$2$0.next = 32;
              break;
            }

            context$2$0.next = 30;
            return _regeneratorRuntime.awrap(this.realDevice.install(this.opts.app));

          case 30:
            context$2$0.next = 33;
            break;

          case 32:
            _logger2['default'].debug("Real device specified but no ipa or app path, assuming bundle ID is " + "on device");

          case 33:
            context$2$0.next = 36;
            break;

          case 35:
            _logger2['default'].debug("No device id or app, not installing to real device.");

          case 36:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'getIDeviceObj',
    value: function getIDeviceObj() {
      var idiPath = _path2['default'].resolve(__dirname, "../../../build/", "libimobiledevice-macosx/ideviceinstaller");
      _logger2['default'].debug('Creating iDevice object with udid ' + this.opts.udid);
      try {
        return iDevice(this.opts.udid);
      } catch (e1) {
        _logger2['default'].debug('Couldn\'t find ideviceinstaller, trying built-in at ' + idiPath);
        try {
          return iDevice(this.opts.udid, { cmd: idiPath });
        } catch (e2) {
          var msg = "Could not initialize ideviceinstaller; make sure it is " + "installed and works on your system";
          _logger2['default'].error(msg);
          throw new Error(msg);
        }
      }
    }
  }, {
    key: 'installIpa',
    value: function installIpa() {
      return _regeneratorRuntime.async(function installIpa$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            _logger2['default'].debug('Installing ipa found at ' + this.opts.ipa);
            context$2$0.next = 3;
            return _regeneratorRuntime.awrap(this.realDevice.isInstalled(this.opts.bundleId));

          case 3:
            if (!context$2$0.sent) {
              context$2$0.next = 9;
              break;
            }

            _logger2['default'].debug("Bundle found on device, removing before reinstalling.");
            context$2$0.next = 7;
            return _regeneratorRuntime.awrap(this.realDevice.remove(this.opts.bundleId));

          case 7:
            context$2$0.next = 10;
            break;

          case 9:
            _logger2['default'].debug("Nothing found on device, going ahead and installing.");

          case 10:
            context$2$0.next = 12;
            return _regeneratorRuntime.awrap(this.realDevice.installAndWait(this.opts.ipa, this.opts.bundleId));

          case 12:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'moveBuiltInApp',
    value: function moveBuiltInApp() {
      return _regeneratorRuntime.async(function moveBuiltInApp$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'validateDesiredCaps',

    // call sim function once it is in place
    value: function validateDesiredCaps(caps) {
      // check with the base class, and return if it fails
      var res = _get(Object.getPrototypeOf(IosDriver.prototype), 'validateDesiredCaps', this).call(this, caps);
      if (!res) return res;

      // make sure that the capabilities have one of `app` or `bundleId`
      if ((caps.browserName || '').toLowerCase() !== 'safari' && !caps.app && !caps.bundleId) {
        var msg = 'The desired capabilities must include either an app or a bundleId for iOS';
        _logger2['default'].errorAndThrow(msg);
      }

      // `launchTimeout` is more complex than the validators can easily handle
      // and too specific for a generalized validator of its own
      if (caps.launchTimeout) {
        // it can be a number, a JSON string, or an object
        var msg = 'launchTimeout must be a number, object, or string JSON object';
        if (!_lodash2['default'].isNumber(caps.launchTimeout)) {
          if (_lodash2['default'].isString(caps.launchTimeout)) {
            // if this is a string, it must be a JSON string
            try {
              // change `launchTimeout` to an object
              caps.launchTimeout = JSON.parse(caps.launchTimeout);
            } catch (err) {
              // it was a string, but not something parsable as JSON
              _logger2['default'].errorAndThrow(msg);
            }
          }
          if (!_lodash2['default'].isObject(caps.launchTimeout)) {
            _logger2['default'].errorAndThrow(msg);
          }
        }
      }

      // `processArguments` is more complex as it can be a string
      // or a hash
      if (caps.processArguments) {
        if (_lodash2['default'].isString(caps.processArguments)) {
          try {
            // try to parse the string as JSON
            caps.processArguments = JSON.parse(caps.processArguments);
          } catch (ign) {
            // if we cannot parse, just leave as a string
          }
        } else if (!_lodash2['default'].isObject(caps.processArguments)) {
            _logger2['default'].errorAndThrow('processArguments must be a string, object, or a string JSON object');
          }
      }

      // finally, return true since the superclass check passed, as did this
      return true;
    }
  }, {
    key: 'checkPreferences',
    value: function checkPreferences() {
      var settingsCaps, safariSettingsCaps, _iteratorNormalCompletion, _didIteratorError, _iteratorError, _iterator, _step, cap;

      return _regeneratorRuntime.async(function checkPreferences$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            settingsCaps = ['locationServicesEnabled', 'locationServicesAuthorized', 'safariAllowPopups', 'safariIgnoreFraudWarning', 'safariOpenLinksInBackground'];
            safariSettingsCaps = settingsCaps.slice(2, 5);

            this.needToSetPrefs = false;
            this.needToSetSafariPrefs = false;
            _iteratorNormalCompletion = true;
            _didIteratorError = false;
            _iteratorError = undefined;
            context$2$0.prev = 7;
            for (_iterator = _getIterator(settingsCaps); !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
              cap = _step.value;

              if (_lodash2['default'].has(this.opts, cap)) {
                this.needToSetPrefs = true;
                if (_lodash2['default'].includes(safariSettingsCaps, cap)) {
                  this.needToSetSafariPrefs = true;
                }
              }
            }
            context$2$0.next = 15;
            break;

          case 11:
            context$2$0.prev = 11;
            context$2$0.t0 = context$2$0['catch'](7);
            _didIteratorError = true;
            _iteratorError = context$2$0.t0;

          case 15:
            context$2$0.prev = 15;
            context$2$0.prev = 16;

            if (!_iteratorNormalCompletion && _iterator['return']) {
              _iterator['return']();
            }

          case 18:
            context$2$0.prev = 18;

            if (!_didIteratorError) {
              context$2$0.next = 21;
              break;
            }

            throw _iteratorError;

          case 21:
            return context$2$0.finish(18);

          case 22:
            return context$2$0.finish(15);

          case 23:
            this.keepAppToRetainPrefs = this.needToSetPrefs;

          case 24:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this, [[7, 11, 15, 23], [16,, 18, 22]]);
    }
  }, {
    key: 'deleteSim',
    value: function deleteSim() {
      return _regeneratorRuntime.async(function deleteSim$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            context$2$0.next = 2;
            return _regeneratorRuntime.awrap(this.sim['delete']());

          case 2:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'clearAppData',
    value: function clearAppData() {
      return _regeneratorRuntime.async(function clearAppData$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            if (!(!this.keepAppToRetainPrefs && this.opts.app && this.opts.bundleId)) {
              context$2$0.next = 3;
              break;
            }

            context$2$0.next = 3;
            return _regeneratorRuntime.awrap(this.sim.cleanCustomApp(_path2['default'].basename(this.opts.app), this.opts.bundleId));

          case 3:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'cleanupDeviceState',
    value: function cleanupDeviceState() {
      var bundleId;
      return _regeneratorRuntime.async(function cleanupDeviceState$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            if (!(this.isRealDevice() && this.opts.bundleId && this.opts.fullReset)) {
              context$2$0.next = 15;
              break;
            }

            bundleId = this.opts.bundleId;

            _logger2['default'].debug('Full reset requested. Will try to uninstall the app \'' + bundleId + '\'.');
            context$2$0.prev = 3;
            context$2$0.next = 6;
            return _regeneratorRuntime.awrap(this.realDevice.remove(bundleId));

          case 6:
            context$2$0.next = 12;
            break;

          case 8:
            context$2$0.prev = 8;
            context$2$0.t0 = context$2$0['catch'](3);

            _logger2['default'].error('Could not remove \'' + bundleId + '\' from device');
            throw context$2$0.t0;

          case 12:
            _logger2['default'].debug('Removed ' + bundleId);
            context$2$0.next = 29;
            break;

          case 15:
            if (this.isRealDevice()) {
              context$2$0.next = 29;
              break;
            }

            if (!this.sim) {
              context$2$0.next = 29;
              break;
            }

            _logger2['default'].debug('Cleaning sim state.');
            context$2$0.prev = 18;
            context$2$0.next = 21;
            return _regeneratorRuntime.awrap(this.clearAppData());

          case 21:
            context$2$0.next = 23;
            return _regeneratorRuntime.awrap(this.sim.clean());

          case 23:
            context$2$0.next = 29;
            break;

          case 25:
            context$2$0.prev = 25;
            context$2$0.t1 = context$2$0['catch'](18);

            _logger2['default'].warn(context$2$0.t1);
            _logger2['default'].warn("Could not reset simulator. Leaving as is.");

          case 29:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this, [[3, 8], [18, 25]]);
    }
  }, {
    key: 'runRealDeviceReset',
    value: function runRealDeviceReset() {
      return _regeneratorRuntime.async(function runRealDeviceReset$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            if (!(this.opts.reset || this.opts.fullReset)) {
              context$2$0.next = 7;
              break;
            }

            _logger2['default'].debug("Running ios real device reset flow");

            if (!this.opts.reset) {
              context$2$0.next = 5;
              break;
            }

            context$2$0.next = 5;
            return _regeneratorRuntime.awrap(this.cleanupDeviceState());

          case 5:
            context$2$0.next = 8;
            break;

          case 7:
            _logger2['default'].debug("Reset not set, not ending real device");

          case 8:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'runSimReset',
    value: function runSimReset() {
      return _regeneratorRuntime.async(function runSimReset$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            if (!(this.opts.reset || this.opts.fullReset)) {
              context$2$0.next = 15;
              break;
            }

            _logger2['default'].debug("Running ios sim reset flow");
            // The simulator process must be ended before we delete applications.
            context$2$0.next = 4;
            return _regeneratorRuntime.awrap(this.endSimulator());

          case 4:
            if (!(this.opts.fullReset && !this.isRealDevice())) {
              context$2$0.next = 10;
              break;
            }

            _logger2['default'].debug('Full reset is on, so erasing simulator');
            context$2$0.next = 8;
            return _regeneratorRuntime.awrap(this.cleanSimulator());

          case 8:
            context$2$0.next = 13;
            break;

          case 10:
            if (!this.opts.reset) {
              context$2$0.next = 13;
              break;
            }

            context$2$0.next = 13;
            return _regeneratorRuntime.awrap(this.cleanupDeviceState());

          case 13:
            context$2$0.next = 16;
            break;

          case 15:
            _logger2['default'].debug("Reset not set, not ending sim");

          case 16:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'cleanSimulator',
    value: function cleanSimulator() {
      return _regeneratorRuntime.async(function cleanSimulator$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            _logger2['default'].debug('Cleaning the simulator');

            if (!this.sim) {
              context$2$0.next = 4;
              break;
            }

            context$2$0.next = 4;
            return _regeneratorRuntime.awrap(this.sim.clean());

          case 4:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'endSimulator',
    value: function endSimulator() {
      return _regeneratorRuntime.async(function endSimulator$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            _logger2['default'].debug("Killing the simulator");

            if (!this.sim) {
              context$2$0.next = 4;
              break;
            }

            context$2$0.next = 4;
            return _regeneratorRuntime.awrap(this.sim.shutdown());

          case 4:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'isolateSimDevice',
    value: function isolateSimDevice() {
      return _regeneratorRuntime.async(function isolateSimDevice$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            if (!(!this.isRealDevice() && this.opts.isolateSimDevice && this.iosSdkVersion >= 8)) {
              context$2$0.next = 3;
              break;
            }

            context$2$0.next = 3;
            return _regeneratorRuntime.awrap(this.sim.isolateSim());

          case 3:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'launchAndQuitSimulator',
    value: function launchAndQuitSimulator() {
      return _regeneratorRuntime.async(function launchAndQuitSimulator$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            _logger2['default'].debug('No simulator directories found.');
            context$2$0.next = 3;
            return _regeneratorRuntime.awrap(this.sim.launchAndQuit(this.isSafari()));

          case 3:
            return context$2$0.abrupt('return', context$2$0.sent);

          case 4:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'setLocale',
    value: function setLocale() {
      var updated;
      return _regeneratorRuntime.async(function setLocale$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            if (!this.isRealDevice()) {
              context$2$0.next = 5;
              break;
            }

            _logger2['default'].debug("Not setting locale because we're using a real device");
            return context$2$0.abrupt('return');

          case 5:
            if (!(!this.opts.language && !this.opts.locale && !this.opts.calendarFormat)) {
              context$2$0.next = 8;
              break;
            }

            _logger2['default'].debug("Not setting locale");
            return context$2$0.abrupt('return');

          case 8:
            context$2$0.next = 10;
            return _regeneratorRuntime.awrap(this.sim.isFresh());

          case 10:
            if (!context$2$0.sent) {
              context$2$0.next = 12;
              break;
            }

            this.launchAndQuitSimulator();

          case 12:

            _logger2['default'].debug("Setting locale information");
            this.localeConfig = this.localeConfig || {};
            this.localeConfig = {
              language: this.opts.language || this.localeConfig.language,
              locale: this.opts.locale || this.localeConfig.locale,
              calendarFormat: this.opts.calendarFormat || this.localeConfig.calendarFormat
            };

            context$2$0.prev = 15;
            context$2$0.next = 18;
            return _regeneratorRuntime.awrap(this.sim.updateLocale(this.opts.language, this.opts.locale, this.opts.calendarFormat));

          case 18:
            updated = context$2$0.sent;

            if (!updated) {
              context$2$0.next = 23;
              break;
            }

            _logger2['default'].debug('Locale was updated. Stopping simulator.');
            context$2$0.next = 23;
            return _regeneratorRuntime.awrap(this.endSimulator());

          case 23:
            context$2$0.next = 28;
            break;

          case 25:
            context$2$0.prev = 25;
            context$2$0.t0 = context$2$0['catch'](15);

            _logger2['default'].errorAndThrow('Appium was unable to set locale info: ' + context$2$0.t0);

          case 28:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this, [[15, 25]]);
    }
  }, {
    key: 'setPreferences',
    value: function setPreferences() {
      var msg;
      return _regeneratorRuntime.async(function setPreferences$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            if (this.needToSetPrefs) {
              context$2$0.next = 5;
              break;
            }

            _logger2['default'].debug("No iOS / app preferences to set");
            return context$2$0.abrupt('return');

          case 5:
            if (!this.opts.fullReset) {
              context$2$0.next = 10;
              break;
            }

            msg = "Cannot set preferences because a full-reset was requested";

            _logger2['default'].debug(msg);
            _logger2['default'].error(msg);
            throw new Error(msg);

          case 10:

            _logger2['default'].debug("Setting iOS and app preferences");

            context$2$0.next = 13;
            return _regeneratorRuntime.awrap(this.sim.isFresh());

          case 13:
            if (!context$2$0.sent) {
              context$2$0.next = 16;
              break;
            }

            context$2$0.next = 16;
            return _regeneratorRuntime.awrap(this.launchAndQuitSimulator());

          case 16:
            context$2$0.prev = 16;
            context$2$0.next = 19;
            return _regeneratorRuntime.awrap(this.setLocServicesPrefs());

          case 19:
            context$2$0.next = 25;
            break;

          case 21:
            context$2$0.prev = 21;
            context$2$0.t0 = context$2$0['catch'](16);

            _logger2['default'].error("Error setting location services preferences, prefs will not work");
            _logger2['default'].error(context$2$0.t0);

          case 25:
            context$2$0.prev = 25;
            context$2$0.next = 28;
            return _regeneratorRuntime.awrap(this.setSafariPrefs());

          case 28:
            context$2$0.next = 34;
            break;

          case 30:
            context$2$0.prev = 30;
            context$2$0.t1 = context$2$0['catch'](25);

            _logger2['default'].error("Error setting safari preferences, prefs will not work");
            _logger2['default'].error(context$2$0.t1);

          case 34:

            _logger2['default'].debug("Updated plist files, rebooting the simulator if it's already open");
            context$2$0.next = 37;
            return _regeneratorRuntime.awrap(this.endSimulator());

          case 37:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this, [[16, 21], [25, 30]]);
    }
  }, {
    key: 'setLocServicesPrefs',
    value: function setLocServicesPrefs() {
      var locServ, msg, locAuth;
      return _regeneratorRuntime.async(function setLocServicesPrefs$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            locServ = _lodash2['default'].find([this.opts.locationServicesEnabled, this.opts.locationServicesAuthorized], function (c) {
              return !_lodash2['default'].isUndefined(c);
            });

            if (_lodash2['default'].isUndefined(locServ)) {
              context$2$0.next = 6;
              break;
            }

            locServ = locServ ? 1 : 0;
            _logger2['default'].debug('Setting location services to ' + locServ);
            context$2$0.next = 6;
            return _regeneratorRuntime.awrap(this.sim.updateSettings('locationServices', {
              LocationServicesEnabled: locServ,
              'LocationServicesEnabledIn7.0': locServ,
              'LocationServicesEnabledIn8.0': locServ
            }));

          case 6:
            if (_lodash2['default'].isUndefined(this.opts.locationServicesAuthorized)) {
              context$2$0.next = 15;
              break;
            }

            if (this.opts.bundleId) {
              context$2$0.next = 11;
              break;
            }

            msg = "Can't set location services for app without bundle ID";

            _logger2['default'].error(msg);
            throw new Error(msg);

          case 11:
            locAuth = !!this.opts.locationServicesAuthorized;

            if (locAuth) {
              _logger2['default'].debug("Authorizing location services for app");
            } else {
              _logger2['default'].debug("De-authorizing location services for app");
            }
            context$2$0.next = 15;
            return _regeneratorRuntime.awrap(this.sim.updateLocationSettings(this.opts.bundleId, locAuth));

          case 15:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'setSafariPrefs',
    value: function setSafariPrefs() {
      var safariSettings, val;
      return _regeneratorRuntime.async(function setSafariPrefs$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            safariSettings = {};

            if (_lodash2['default'].has(this.opts, 'safariAllowPopups')) {
              val = !!this.opts.safariAllowPopups;

              _logger2['default'].debug('Setting javascript window opening to \'' + val + '\'');
              safariSettings.WebKitJavaScriptCanOpenWindowsAutomatically = val;
              safariSettings.JavaScriptCanOpenWindowsAutomatically = val;
            }
            if (_lodash2['default'].has(this.opts, 'safariIgnoreFraudWarning')) {
              val = !this.opts.safariIgnoreFraudWarning;

              _logger2['default'].debug('Setting fraudulent website warning to \'' + val + '\'');
              safariSettings.WarnAboutFraudulentWebsites = val;
            }
            if (_lodash2['default'].has(this.opts, 'safariOpenLinksInBackground')) {
              val = this.opts.safariOpenLinksInBackground ? 1 : 0;

              _logger2['default'].debug('Setting opening links in background to \'' + !!val + '\'');
              safariSettings.OpenLinksInBackground = val;
            }

            if (!(_lodash2['default'].size(safariSettings) > 0)) {
              context$2$0.next = 7;
              break;
            }

            context$2$0.next = 7;
            return _regeneratorRuntime.awrap(this.sim.updateSafariSettings(safariSettings));

          case 7:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'startLogCapture',
    value: function startLogCapture() {
      return _regeneratorRuntime.async(function startLogCapture$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            if (_lodash2['default'].isEmpty(this.logs)) {
              context$2$0.next = 3;
              break;
            }

            _logger2['default'].warn("Trying to start iOS log capture but it's already started!");
            return context$2$0.abrupt('return');

          case 3:
            this.logs.crashlog = new _appiumIosLog.IOSCrashLog();
            this.logs.syslog = new _appiumIosLog.IOSLog({
              sim: this.sim,
              udid: this.opts.udid,
              showLogs: this.opts.showIOSLog
            });
            context$2$0.prev = 5;
            context$2$0.next = 8;
            return _regeneratorRuntime.awrap(this.logs.syslog.startCapture());

          case 8:
            context$2$0.next = 14;
            break;

          case 10:
            context$2$0.prev = 10;
            context$2$0.t0 = context$2$0['catch'](5);

            _logger2['default'].warn("Could not capture logs from device. Continuing without capturing logs.");
            return context$2$0.abrupt('return');

          case 14:
            context$2$0.next = 16;
            return _regeneratorRuntime.awrap(this.logs.crashlog.startCapture());

          case 16:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this, [[5, 10]]);
    }
  }, {
    key: 'prelaunchSimulator',
    value: function prelaunchSimulator() {
      return _regeneratorRuntime.async(function prelaunchSimulator$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            if (this.shouldPrelaunchSimulator) {
              context$2$0.next = 3;
              break;
            }

            _logger2['default'].debug("Not pre-launching simulator");
            return context$2$0.abrupt('return');

          case 3:
            context$2$0.next = 5;
            return _regeneratorRuntime.awrap(this.endSimulator());

          case 5:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'onInstrumentsLaunch',

    // TODO: implement prelaunch sim in simulator package
    value: function onInstrumentsLaunch() {
      return _regeneratorRuntime.async(function onInstrumentsLaunch$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            _logger2['default'].debug('Instruments launched. Starting poll loop for new commands.');

            if (!this.opts.origAppPath) {
              context$2$0.next = 6;
              break;
            }

            _logger2['default'].debug("Copying app back to its original place");
            context$2$0.next = 5;
            return _regeneratorRuntime.awrap(_appiumSupport.fs.ncp(this.opts.app, this.opts.origAppPath));

          case 5:
            return context$2$0.abrupt('return', context$2$0.sent);

          case 6:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'setBundleId',
    value: function setBundleId() {
      var bId;
      return _regeneratorRuntime.async(function setBundleId$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            if (!this.opts.bundleId) {
              context$2$0.next = 4;
              break;
            }

            return context$2$0.abrupt('return');

          case 4:
            context$2$0.next = 6;
            return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand('au.bundleId()'));

          case 6:
            bId = context$2$0.sent;

            _logger2['default'].debug('Bundle ID for open app is ' + bId.value);
            this.opts.bundleId = bId.value;

          case 9:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'setInitialOrientation',
    value: function setInitialOrientation() {
      var command;
      return _regeneratorRuntime.async(function setInitialOrientation$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            if (!(typeof this.opts.initialOrientation === "string" && _lodash2['default'].includes(["LANDSCAPE", "PORTRAIT"], this.opts.initialOrientation.toUpperCase()))) {
              context$2$0.next = 12;
              break;
            }

            _logger2['default'].debug('Setting initial orientation to ' + this.opts.initialOrientation);
            command = 'au.setScreenOrientation(\'' + this.opts.initialOrientation.toUpperCase() + '\')';
            context$2$0.prev = 3;
            context$2$0.next = 6;
            return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand(command));

          case 6:
            this.opts.curOrientation = this.opts.initialOrientation;
            context$2$0.next = 12;
            break;

          case 9:
            context$2$0.prev = 9;
            context$2$0.t0 = context$2$0['catch'](3);

            _logger2['default'].warn('Setting initial orientation failed with: ' + context$2$0.t0);

          case 12:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this, [[3, 9]]);
    }
  }, {
    key: 'isRealDevice',
    value: function isRealDevice() {
      return !!this.opts.udid;
    }
  }, {
    key: 'isSafari',
    value: function isSafari() {
      return this.opts.safari;
    }
  }, {
    key: 'waitForAppLaunched',
    value: function waitForAppLaunched() {
      var condFn;
      return _regeneratorRuntime.async(function waitForAppLaunched$(context$2$0) {
        var _this = this;

        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            condFn = undefined;

            if (!this.opts.waitForAppScript) {
              context$2$0.next = 6;
              break;
            }

            // the default getSourceForElementForXML does not fit some use case, so making this customizable.
            // TODO: collect script from customer and propose several options, please comment in issue #4190.
            _logger2['default'].debug('Using custom script to wait for app start: ' + this.opts.waitForAppScript);
            condFn = function callee$2$0() {
              var res;
              return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
                while (1) switch (context$3$0.prev = context$3$0.next) {
                  case 0:
                    res = undefined;
                    context$3$0.prev = 1;
                    context$3$0.next = 4;
                    return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand('try{\n' + this.opts.waitForAppScript + '\n} catch(err) { $.log("waitForAppScript err: " + error); false; };'));

                  case 4:
                    res = context$3$0.sent;
                    context$3$0.next = 11;
                    break;

                  case 7:
                    context$3$0.prev = 7;
                    context$3$0.t0 = context$3$0['catch'](1);

                    _logger2['default'].debug('Cannot eval waitForAppScript script, err: ' + context$3$0.t0);
                    return context$3$0.abrupt('return', false);

                  case 11:
                    if (!(typeof res !== 'boolean')) {
                      context$3$0.next = 14;
                      break;
                    }

                    _logger2['default'].debug('Unexpected return type in waitForAppScript script');
                    return context$3$0.abrupt('return', false);

                  case 14:
                    return context$3$0.abrupt('return', res);

                  case 15:
                  case 'end':
                    return context$3$0.stop();
                }
              }, null, _this, [[1, 7]]);
            };
            context$2$0.next = 18;
            break;

          case 6:
            if (!this.isSafari()) {
              context$2$0.next = 16;
              break;
            }

            if (!this.isRealDevice()) {
              context$2$0.next = 10;
              break;
            }

            context$2$0.next = 10;
            return _regeneratorRuntime.awrap(this.clickButtonToLaunchSafari());

          case 10:
            _logger2['default'].debug('Waiting for initial webview');
            context$2$0.next = 13;
            return _regeneratorRuntime.awrap(this.navToInitialWebview());

          case 13:
            condFn = function callee$2$0() {
              return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
                while (1) switch (context$3$0.prev = context$3$0.next) {
                  case 0:
                    return context$3$0.abrupt('return', true);

                  case 1:
                  case 'end':
                    return context$3$0.stop();
                }
              }, null, _this);
            };
            context$2$0.next = 18;
            break;

          case 16:
            _logger2['default'].debug("Waiting for app source to contain elements");
            condFn = function callee$2$0() {
              var source, appEls;
              return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
                while (1) switch (context$3$0.prev = context$3$0.next) {
                  case 0:
                    context$3$0.prev = 0;
                    context$3$0.next = 3;
                    return _regeneratorRuntime.awrap(this.getSourceForElementForXML());

                  case 3:
                    source = context$3$0.sent;

                    source = JSON.parse(source || "{}");
                    appEls = (source.UIAApplication || {})['>'];
                    return context$3$0.abrupt('return', appEls && appEls.length > 0 && !IosDriver.isSpringBoard(source.UIAApplication));

                  case 9:
                    context$3$0.prev = 9;
                    context$3$0.t0 = context$3$0['catch'](0);

                    _logger2['default'].warn('Couldn\'t extract app element from source, error was: ' + context$3$0.t0);
                    return context$3$0.abrupt('return', false);

                  case 13:
                  case 'end':
                    return context$3$0.stop();
                }
              }, null, _this, [[0, 9]]);
            };

          case 18:
            context$2$0.prev = 18;
            context$2$0.next = 21;
            return _regeneratorRuntime.awrap((0, _asyncbox.waitForCondition)(condFn, { logger: _logger2['default'], waitMs: 10000, intervalMs: 500 }));

          case 21:
            context$2$0.next = 31;
            break;

          case 23:
            context$2$0.prev = 23;
            context$2$0.t0 = context$2$0['catch'](18);

            if (!(context$2$0.t0.message && context$2$0.t0.message.match(/Condition unmet/))) {
              context$2$0.next = 30;
              break;
            }

            _logger2['default'].warn('Initial spin timed out, continuing but the app might not be ready.');
            _logger2['default'].debug('Initial spin error was: ' + context$2$0.t0);
            context$2$0.next = 31;
            break;

          case 30:
            throw context$2$0.t0;

          case 31:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this, [[18, 23]]);
    }
  }, {
    key: 'createInstruments',
    value: function createInstruments() {
      return _regeneratorRuntime.async(function createInstruments$(context$2$0) {
        var _this2 = this;

        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            _logger2['default'].debug("Creating instruments");
            this.uiAutoClient = new _appiumUiauto.UIAutoClient(this.sock);
            context$2$0.next = 4;
            return _regeneratorRuntime.awrap(this.makeInstruments());

          case 4:
            this.instruments = context$2$0.sent;

            this.instruments.onShutdown['catch'](function callee$2$0() {
              return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
                while (1) switch (context$3$0.prev = context$3$0.next) {
                  case 0:
                    context$3$0.next = 2;
                    return _regeneratorRuntime.awrap(this.startUnexpectedShutdown(new _mobileJsonWireProtocol.errors.UnknownError('Abnormal Instruments termination!')));

                  case 2:
                  case 'end':
                    return context$3$0.stop();
                }
              }, null, _this2);
            }).done();

          case 6:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'shouldIgnoreInstrumentsExit',
    value: function shouldIgnoreInstrumentsExit() {
      return this.safari && this.isRealDevice();
    }
  }, {
    key: 'makeInstruments',
    value: function makeInstruments() {
      var bootstrapPath, instruments;
      return _regeneratorRuntime.async(function makeInstruments$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            context$2$0.next = 2;
            return _regeneratorRuntime.awrap((0, _appiumUiauto.prepareBootstrap)({
              sock: this.sock,
              interKeyDelay: this.opts.interKeyDelay,
              justLoopInfinitely: false,
              autoAcceptAlerts: this.opts.autoAcceptAlerts,
              autoDismissAlerts: this.opts.autoDismissAlerts,
              sendKeyStrategy: this.opts.sendKeyStrategy || (this.isRealDevice() ? 'grouped' : 'oneByOne')
            }));

          case 2:
            bootstrapPath = context$2$0.sent;
            context$2$0.t0 = _appiumInstruments.Instruments;
            context$2$0.t1 = (!this.isRealDevice() ? this.opts.app : null) || this.opts.bundleId;
            context$2$0.t2 = this.opts.udid;
            context$2$0.t3 = this.opts.processArguments;
            context$2$0.t4 = this.shouldIgnoreInstrumentsExit();
            context$2$0.t5 = bootstrapPath;
            context$2$0.t6 = this.opts.automationTraceTemplatePath;
            context$2$0.t7 = this.opts.instrumentsPath;
            context$2$0.t8 = this.opts.withoutDelay;
            context$2$0.t9 = this.opts.platformVersion;
            context$2$0.t10 = this.opts.webSocket;
            context$2$0.t11 = this.opts.launchTimeout;
            context$2$0.t12 = this.opts.backendRetries;
            context$2$0.t13 = this.isRealDevice();

            if (!(this.iosSdkVersion >= 7.1)) {
              context$2$0.next = 23;
              break;
            }

            context$2$0.next = 20;
            return _regeneratorRuntime.awrap(this.adjustedDeviceName());

          case 20:
            context$2$0.t14 = context$2$0.sent;
            context$2$0.next = 24;
            break;

          case 23:
            context$2$0.t14 = null;

          case 24:
            context$2$0.t15 = context$2$0.t14;
            context$2$0.t16 = _path2['default'].resolve(this.opts.tmpDir || '/tmp', 'appium-instruments');
            context$2$0.t17 = this.opts.traceDir;
            context$2$0.t18 = {
              app: context$2$0.t1,
              udid: context$2$0.t2,
              processArguments: context$2$0.t3,
              ignoreStartupExit: context$2$0.t4,
              bootstrap: context$2$0.t5,
              template: context$2$0.t6,
              instrumentsPath: context$2$0.t7,
              withoutDelay: context$2$0.t8,
              platformVersion: context$2$0.t9,
              webSocket: context$2$0.t10,
              launchTimeout: context$2$0.t11,
              flakeyRetries: context$2$0.t12,
              realDevice: context$2$0.t13,
              simulatorSdkAndDevice: context$2$0.t15,
              tmpDir: context$2$0.t16,
              traceDir: context$2$0.t17
            };
            instruments = new context$2$0.t0(context$2$0.t18);
            return context$2$0.abrupt('return', instruments);

          case 30:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'startInstruments',
    value: function startInstruments() {
      return _regeneratorRuntime.async(function startInstruments$(context$2$0) {
        var _this3 = this;

        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            _logger2['default'].debug("Starting UIAutoClient, and launching Instruments.");

            context$2$0.next = 3;
            return _regeneratorRuntime.awrap(_bluebird2['default'].all([this.uiAutoClient.start().then(function () {
              _this3.instruments.registerLaunch();
            }), this.instruments.launch()]));

          case 3:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'configureBootstrap',
    value: function configureBootstrap() {
      var isVerbose, cmd;
      return _regeneratorRuntime.async(function configureBootstrap$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            _logger2['default'].debug("Setting bootstrap config keys/values");
            isVerbose = true;
            cmd = 'target = $.target();\n';

            cmd += 'au = $;\n';
            cmd += '$.isVerbose = ' + isVerbose + ';\n';
            // Not using uiauto grace period because of bug.
            // cmd += '$.target().setTimeout(1);\n';
            context$2$0.next = 7;
            return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand(cmd));

          case 7:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'checkSimAvailable',
    value: function checkSimAvailable() {
      var timeout, availDevices, dString, noDevicesError, sim;
      return _regeneratorRuntime.async(function checkSimAvailable$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            if (!this.isRealDevice()) {
              context$2$0.next = 3;
              break;
            }

            _logger2['default'].debug("Not checking whether simulator is available since we're on " + "a real device");
            return context$2$0.abrupt('return');

          case 3:
            if (!(this.iosSdkVersion < 7.1)) {
              context$2$0.next = 6;
              break;
            }

            _logger2['default'].debug("Instruments v < 7.1, not checking device string support");
            return context$2$0.abrupt('return');

          case 6:

            _logger2['default'].debug("Checking whether instruments supports our device string");
            timeout = _lodash2['default'].isObject(this.opts.launchTimeout) ? this.opts.launchTimeout.global : this.opts.launchTimeout;
            context$2$0.next = 10;
            return _regeneratorRuntime.awrap((0, _asyncbox.retry)(3, _appiumInstruments.utils.getAvailableDevices, timeout));

          case 10:
            availDevices = context$2$0.sent;
            context$2$0.next = 13;
            return _regeneratorRuntime.awrap(this.adjustedDeviceName());

          case 13:
            dString = context$2$0.sent;

            noDevicesError = function noDevicesError() {
              var msg = 'Could not find a device to launch. You requested ' + ('\'' + dString + '\', but the available devices were: ') + JSON.stringify(availDevices);
              _logger2['default'].errorAndThrow(msg);
            };

            if (this.iosSdkVersion >= 8) {
              sim = _utils2['default'].getSimForDeviceString(dString, availDevices);

              if (sim[0] === null || sim[1] === null) {
                noDevicesError();
              }
              this.iosSimUdid = sim[1];
              _logger2['default'].debug('iOS sim UDID is ' + this.iosSimUdid);
            } else if (!_lodash2['default'].includes(availDevices, dString)) {
              noDevicesError();
            }

          case 16:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'getSourceForElementForXML',
    value: function getSourceForElementForXML(ctx) {
      var source;
      return _regeneratorRuntime.async(function getSourceForElementForXML$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            source = undefined;

            if (ctx) {
              context$2$0.next = 7;
              break;
            }

            context$2$0.next = 4;
            return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand("au.mainApp().getTreeForXML()"));

          case 4:
            source = context$2$0.sent;
            context$2$0.next = 10;
            break;

          case 7:
            context$2$0.next = 9;
            return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand('au.getElement(\'' + ctx + '\').getTreeForXML()'));

          case 9:
            source = context$2$0.sent;

          case 10:
            if (!source) {
              context$2$0.next = 14;
              break;
            }

            return context$2$0.abrupt('return', JSON.stringify(source));

          case 14:
            throw new Error('Bad response from getTreeForXML. res was ' + JSON.stringify(source));

          case 15:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'adjustedDeviceName',
    value: function adjustedDeviceName() {
      return _regeneratorRuntime.async(function adjustedDeviceName$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            context$2$0.t0 = this.opts._adjustedDeviceName;

            if (context$2$0.t0) {
              context$2$0.next = 5;
              break;
            }

            context$2$0.next = 4;
            return _regeneratorRuntime.awrap((0, _appiumIosSimulator.getDeviceString)(this.opts));

          case 4:
            context$2$0.t0 = context$2$0.sent;

          case 5:
            this.opts._adjustedDeviceName = context$2$0.t0;
            return context$2$0.abrupt('return', this.opts._adjustedDeviceName);

          case 7:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'realDevice',
    get: function get() {
      this._realDevice = this._realDevice || this.getIDeviceObj();
      return this._realDevice;
    },
    set: function set(rd) {
      this._realDevice = rd;
    }
  }], [{
    key: 'isSpringBoard',
    value: function isSpringBoard(uiAppObj) {
      // TODO: move to helpers
      // Test for iOS homescreen (SpringBoard). AUT occassionally start the sim, but fails to load
      // the app. If that occurs, getSourceForElementFoXML will return a doc object that meets our
      // app-check conditions, resulting in a false positive. This function tests the UiApplication
      // property's meta data to ensure that the Appium doesn't confuse SpringBoard with the app
      // under test.
      return _lodash2['default'].propertyOf(uiAppObj['@'])('name') === 'SpringBoard';
    }
  }]);

  return IosDriver;
})(_appiumBaseDriver.BaseDriver);

var _iteratorNormalCompletion2 = true;
var _didIteratorError2 = false;
var _iteratorError2 = undefined;

try {

  for (var _iterator2 = _getIterator(_lodash2['default'].toPairs(_commandsIndex2['default'])), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
    var _step2$value = _slicedToArray(_step2.value, 2);

    var cmd = _step2$value[0];
    var fn = _step2$value[1];

    IosDriver.prototype[cmd] = fn;
  }
} catch (err) {
  _didIteratorError2 = true;
  _iteratorError2 = err;
} finally {
  try {
    if (!_iteratorNormalCompletion2 && _iterator2['return']) {
      _iterator2['return']();
    }
  } finally {
    if (_didIteratorError2) {
      throw _iteratorError2;
    }
  }
}

exports.IosDriver = IosDriver;
exports['default'] = IosDriver;

// on real device, need to check if safari launcher exists
// first check if it is already on the device

// it's not on the device, so check if we need to build

// if user has passed in desiredCaps.autoLaunch = false
// meaning they will manage app install / launching

// TODO: this need to be split in 2 helpers

// we need the simulator to have its directories in place

// We already have a bundle Id

// on iOS8 in particular, we can get a working session before the app
// is ready to respond to commands; in that case the source will be empty
// so we just spin until it's not

// unexpected exit

// at the moment all the logging in uiauto is at debug level

// on real devices bundleId is always used
// TODO: level was configured according to logger

// TODO: all this json/xml logic is very expensive, we need
// to use a SAX parser instead.

// this should never happen but we've received bug reports; this will help us track down
// what's wrong in getTreeForXML
//# sourceMappingURL=data:application/json;base64,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dkI7OztXQTVJb0IsdUJBQUMsUUFBUSxFQUFFOzs7Ozs7O0FBTzlCLGFBQU8sb0JBQUUsVUFBVSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLGFBQWEsQ0FBQztLQUM5RDs7O1NBeHdCRyxTQUFTOzs7Ozs7Ozs7QUErNEJmLHFDQUFzQixvQkFBRSxPQUFPLDRCQUFVLGlIQUFFOzs7UUFBakMsR0FBRztRQUFFLEVBQUU7O0FBQ2YsYUFBUyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUM7R0FDL0I7Ozs7Ozs7Ozs7Ozs7Ozs7UUFHUSxTQUFTLEdBQVQsU0FBUztxQkFDSCxTQUFTIiwiZmlsZSI6ImxpYi9kcml2ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCYXNlRHJpdmVyLCBEZXZpY2VTZXR0aW5ncyB9IGZyb20gJ2FwcGl1bS1iYXNlLWRyaXZlcic7XG5pbXBvcnQgdXRpbHMgZnJvbSAnLi91dGlscyc7XG5pbXBvcnQgbG9nZ2VyIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCB7IGZzIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IHsgZ2V0U2ltdWxhdG9yLCBnZXREZXZpY2VTdHJpbmcgfSBmcm9tICdhcHBpdW0taW9zLXNpbXVsYXRvcic7XG5pbXBvcnQgeyBwcmVwYXJlQm9vdHN0cmFwLCBVSUF1dG9DbGllbnQgfSBmcm9tICdhcHBpdW0tdWlhdXRvJztcbmltcG9ydCB7IEluc3RydW1lbnRzLCB1dGlscyBhcyBpbnN0cnVtZW50c1V0aWxzIH0gZnJvbSAnYXBwaXVtLWluc3RydW1lbnRzJztcbmltcG9ydCB7IHJldHJ5LCB3YWl0Rm9yQ29uZGl0aW9uIH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IHsgSU9TTG9nLCBJT1NDcmFzaExvZyB9IGZyb20gJ2FwcGl1bS1pb3MtbG9nJztcbmltcG9ydCBjb21tYW5kcyBmcm9tICcuL2NvbW1hbmRzL2luZGV4JztcbmltcG9ydCBkZXNpcmVkQ2FwQ29uc3RyYWludHMgZnJvbSAnLi9kZXNpcmVkLWNhcHMnO1xuaW1wb3J0IHsgZXJyb3JzIH0gZnJvbSAnbW9iaWxlLWpzb24td2lyZS1wcm90b2NvbCc7XG5pbXBvcnQgX2lEZXZpY2UgZnJvbSAnbm9kZS1pZGV2aWNlJztcbmltcG9ydCB7IFNBRkFSSV9CVU5ETEUgfSBmcm9tICcuL2NvbW1hbmRzL3NhZmFyaSc7XG5pbXBvcnQgeyBpbnN0YWxsLCBuZWVkc0luc3RhbGwsIFNBRkFSSV9MQVVOQ0hFUl9CVU5ETEUgfSBmcm9tICcuL3NhZmFyaS1sYXVuY2hlcic7XG5cbi8vIHByb21pc2lmeSBfaURldmljZVxubGV0IGlEZXZpY2UgPSBmdW5jdGlvbiAoLi4uYXJncykge1xuICBsZXQgZGV2aWNlID0gX2lEZXZpY2UoLi4uYXJncyk7XG4gIGxldCBwcm9taXNpZmllZCA9IHt9O1xuICBmb3IgKGxldCBtIG9mIFsnaW5zdGFsbCcsICdpbnN0YWxsQW5kV2FpdCcsICdyZW1vdmUnLCAnaXNJbnN0YWxsZWQnXSkge1xuICAgIHByb21pc2lmaWVkW21dID0gQi5wcm9taXNpZnkoZGV2aWNlW21dLmJpbmQoZGV2aWNlKSk7XG4gIH1cbiAgcmV0dXJuIHByb21pc2lmaWVkO1xufTtcblxubGV0IHNlcnZlckNhcGFiaWxpdGllcyA9IHtcbiAgd2ViU3RvcmFnZUVuYWJsZWQ6IGZhbHNlLFxuICBsb2NhdGlvbkNvbnRleHRFbmFibGVkOiBmYWxzZSxcbiAgYnJvd3Nlck5hbWU6ICcnLFxuICBwbGF0Zm9ybTogJ01BQycsXG4gIGphdmFzY3JpcHRFbmFibGVkOiB0cnVlLFxuICBkYXRhYmFzZUVuYWJsZWQ6IGZhbHNlLFxuICB0YWtlc1NjcmVlbnNob3Q6IHRydWUsXG4gIG5ldHdvcmtDb25uZWN0aW9uRW5hYmxlZDogZmFsc2UsXG59O1xuXG5jbGFzcyBJb3NEcml2ZXIgZXh0ZW5kcyBCYXNlRHJpdmVyIHtcbiAgcmVzZXRJb3MgKCkge1xuICAgIHRoaXMuYXBwRXh0ID0gXCIuYXBwXCI7XG4gICAgXy5kZWZhdWx0cyh0aGlzLm9wdHMsIHNlcnZlckNhcGFiaWxpdGllcyk7XG4gICAgdGhpcy54Y29kZVZlcnNpb24gPSBudWxsO1xuICAgIHRoaXMuaW9zU2RrVmVyc2lvbiA9IG51bGw7XG4gICAgdGhpcy5pb3NTaW1VZGlkID0gbnVsbDtcbiAgICB0aGlzLmxvZ3MgPSB7fTtcbiAgICB0aGlzLmluc3RydW1lbnRzID0gbnVsbDtcbiAgICB0aGlzLnVpQXV0b0NsaWVudCA9IG51bGw7XG4gICAgdGhpcy5vbkluc3RydW1lbnRzRGllID0gZnVuY3Rpb24gKCkge307XG4gICAgdGhpcy5zdG9wcGluZyA9IGZhbHNlO1xuICAgIHRoaXMuY2JGb3JDdXJyZW50Q21kID0gbnVsbDtcbiAgICB0aGlzLnJlbW90ZSA9IG51bGw7XG4gICAgdGhpcy5jdXJDb250ZXh0ID0gbnVsbDtcbiAgICB0aGlzLmN1cldlYkZyYW1lcyA9IFtdO1xuICAgIHRoaXMuc2VsZWN0aW5nTmV3UGFnZSA9IGZhbHNlO1xuICAgIHRoaXMud2luZG93SGFuZGxlQ2FjaGUgPSBbXTtcbiAgICB0aGlzLndlYkVsZW1lbnRJZHMgPSBbXTtcbiAgICB0aGlzLmltcGxpY2l0V2FpdE1zID0gMDtcbiAgICB0aGlzLmFzeW5jbGliV2FpdE1zID0gMDtcbiAgICB0aGlzLnBhZ2VMb2FkTXMgPSA2MDAwO1xuICAgIHRoaXMuYXN5bmNsaWJSZXNwb25zZUNiID0gbnVsbDtcbiAgICB0aGlzLnJldHVybmVkRnJvbUV4ZWN1dGVBdG9tID0ge307XG4gICAgdGhpcy5leGVjdXRlZEF0b21zQ291bnRlciA9IDA7XG4gICAgdGhpcy5jdXJDb29yZHMgPSBudWxsO1xuICAgIHRoaXMuY3VyV2ViQ29vcmRzID0gbnVsbDtcbiAgICB0aGlzLmxhbmRzY2FwZVdlYkNvb3Jkc09mZnNldCA9IDA7XG4gICAgdGhpcy5rZWVwQXBwVG9SZXRhaW5QcmVmcyA9IGZhbHNlO1xuICAgIHRoaXMucmVhZHkgPSBmYWxzZTtcbiAgICB0aGlzLmFzeW5jV2FpdE1zID0gMDtcblxuICAgIHRoaXMuc2V0dGluZ3MgPSBuZXcgRGV2aWNlU2V0dGluZ3Moe30sIF8ubm9vcCk7XG5cbiAgICB0aGlzLmxvY2F0b3JTdHJhdGVnaWVzID0gW1xuICAgICAgJ3hwYXRoJyxcbiAgICAgICdpZCcsXG4gICAgICAnY2xhc3MgbmFtZScsXG4gICAgICAnLWlvcyB1aWF1dG9tYXRpb24nLFxuICAgICAgJ2FjY2Vzc2liaWxpdHkgaWQnXG4gICAgXTtcbiAgICB0aGlzLndlYkxvY2F0b3JTdHJhdGVnaWVzID0gW1xuICAgICAgJ2xpbmsgdGV4dCcsXG4gICAgICAnY3NzIHNlbGVjdG9yJyxcbiAgICAgICd0YWcgbmFtZScsXG4gICAgICAncGFydGlhbCBsaW5rIHRleHQnXG4gICAgXTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKG9wdHMsIHNob3VsZFZhbGlkYXRlQ2Fwcykge1xuICAgIHN1cGVyKG9wdHMsIHNob3VsZFZhbGlkYXRlQ2Fwcyk7XG5cbiAgICB0aGlzLmRlc2lyZWRDYXBDb25zdHJhaW50cyA9IGRlc2lyZWRDYXBDb25zdHJhaW50cztcbiAgICB0aGlzLnJlc2V0SW9zKCk7XG4gIH1cblxuICB2YWxpZGF0ZUxvY2F0b3JTdHJhdGVneSAoc3RyYXRlZ3kpIHtcbiAgICBzdXBlci52YWxpZGF0ZUxvY2F0b3JTdHJhdGVneShzdHJhdGVneSwgdGhpcy5pc1dlYkNvbnRleHQoKSk7XG4gIH1cblxuICBhc3luYyBzdGFydCAoKSB7XG4gICAgaWYgKHRoaXMuaXNSZWFsRGV2aWNlKCkpIHtcbiAgICAgIGF3YWl0IHRoaXMuc3RhcnRSZWFsRGV2aWNlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGF3YWl0IHRoaXMuc3RhcnRTaW11bGF0b3IoKTtcbiAgICB9XG4gICAgdGhpcy5yZWFkeSA9IHRydWU7XG4gIH1cblxuICBhc3luYyBjcmVhdGVTZXNzaW9uIChjYXBzKSB7XG4gICAgbGV0IFtzZXNzaW9uSWRdID0gYXdhaXQgc3VwZXIuY3JlYXRlU2Vzc2lvbihjYXBzKTtcblxuICAgIC8vIG1lcmdlIHNlcnZlciBjYXBhYmlsaXRpZXMgKyBkZXNpcmVkIGNhcGFiaWxpdGllc1xuICAgIHRoaXMuY2FwcyA9IE9iamVjdC5hc3NpZ24oe30sIHNlcnZlckNhcGFiaWxpdGllcywgdGhpcy5jYXBzKTtcbiAgICB0aGlzLmNhcHMuZGVzaXJlZCA9IGNhcHM7XG5cbiAgICBhd2FpdCB1dGlscy5kZXRlY3RVZGlkKHRoaXMub3B0cyk7XG4gICAgYXdhaXQgdXRpbHMucHJlcGFyZUlvc09wdHModGhpcy5vcHRzKTtcbiAgICB0aGlzLnJlYWxEZXZpY2UgPSBudWxsO1xuICAgIHRoaXMudXNlUm9ib3QgPSB0aGlzLm9wdHMudXNlUm9ib3Q7XG4gICAgdGhpcy5zYWZhcmkgPSB0aGlzLm9wdHMuc2FmYXJpO1xuICAgIHRoaXMuY3VyT3JpZW50YXRpb24gPSB0aGlzLm9wdHMuaW5pdGlhbE9yaWVudGF0aW9uO1xuXG4gICAgdGhpcy5zb2NrID0gcGF0aC5yZXNvbHZlKHRoaXMub3B0cy50bXBEaXIgfHwgJy90bXAnLCAnaW5zdHJ1bWVudHNfc29jaycpO1xuICAgIHRoaXMucGVyZkxvZ0VuYWJsZWQgPSAhISh0eXBlb2YgdGhpcy5vcHRzLmxvZ2dpbmdQcmVmcyA9PT0gJ29iamVjdCcgJiYgdGhpcy5vcHRzLmxvZ2dpbmdQcmVmcy5wZXJmb3JtYW5jZSk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuY29uZmlndXJlQXBwKCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoYEJhZCBhcHA6ICcke3RoaXMub3B0cy5hcHB9Jy4gQXBwIHBhdGhzIG5lZWQgdG8gYCArXG4gICAgICAgICAgICAgICAgICAgYGJlIGFic29sdXRlLCBvciByZWxhdGl2ZSB0byB0aGUgYXBwaXVtIHNlcnZlciBgICtcbiAgICAgICAgICAgICAgICAgICBgaW5zdGFsbCBkaXIsIG9yIGEgVVJMIHRvIGNvbXByZXNzZWQgZmlsZSwgb3IgYSBgICtcbiAgICAgICAgICAgICAgICAgICBgc3BlY2lhbCBhcHAgbmFtZS5gKTtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gICAgYXdhaXQgdGhpcy5zdGFydCgpO1xuXG4gICAgLy8gVE9ETzogdGhpcyBzaG91bGQgYmUgaW4gQmFzZURyaXZlci5wb3N0Q3JlYXRlU2Vzc2lvblxuICAgIHRoaXMuc3RhcnROZXdDb21tYW5kVGltZW91dCgnY3JlYXRlU2Vzc2lvbicpO1xuICAgIHJldHVybiBbc2Vzc2lvbklkLCB0aGlzLmNhcHNdO1xuICB9XG5cbiAgYXN5bmMgc3RvcCAoKSB7XG4gICAgdGhpcy5yZWFkeSA9IGZhbHNlO1xuXG4gICAgaWYgKHRoaXMudWlBdXRvQ2xpZW50KSB7XG4gICAgICBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zaHV0ZG93bigpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmluc3RydW1lbnRzKSB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLmluc3RydW1lbnRzLnNodXRkb3duKCk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKGBJbnN0cnVtZW50cyBkaWRuJ3Qgc2h1dCBkb3duLiAke2Vycn1gKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnVpQXV0b0NsaWVudCA9IG51bGw7XG4gICAgdGhpcy5pbnN0cnVtZW50cyA9IG51bGw7XG4gICAgdGhpcy5yZWFsRGV2aWNlID0gbnVsbDtcblxuICAgIC8vIHBvc3RjbGVhbnVwXG4gICAgdGhpcy5jdXJDb29yZHMgPSBudWxsO1xuICAgIHRoaXMub3B0cy5jdXJPcmllbnRhdGlvbiA9IG51bGw7XG4gICAgaWYgKCFfLmlzRW1wdHkodGhpcy5sb2dzKSkge1xuICAgICAgdGhpcy5sb2dzLnN5c2xvZy5zdG9wQ2FwdHVyZSgpO1xuICAgICAgdGhpcy5sb2dzID0ge307XG4gICAgfVxuXG4gICAgaWYgKHRoaXMucmVtb3RlKSB7XG4gICAgICBhd2FpdCB0aGlzLnN0b3BSZW1vdGUoKTtcbiAgICB9XG5cbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZVNlc3Npb24gKCkge1xuICAgIGxvZ2dlci5kZWJ1ZyhcIkRlbGV0aW5nIGlvcyBzZXNzaW9uXCIpO1xuXG4gICAgYXdhaXQgdGhpcy5zdG9wKCk7XG5cbiAgICBpZiAodGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgICAgYXdhaXQgdGhpcy5ydW5SZWFsRGV2aWNlUmVzZXQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXdhaXQgdGhpcy5ydW5TaW1SZXNldCgpO1xuICAgIH1cbiAgICBhd2FpdCBzdXBlci5kZWxldGVTZXNzaW9uKCk7XG4gIH1cblxuICBhc3luYyBleGVjdXRlQ29tbWFuZCAoY21kLCAuLi5hcmdzKSB7XG4gICAgbG9nZ2VyLmRlYnVnKGBFeGVjdXRpbmcgaU9TIGNvbW1hbmQgJyR7Y21kfSdgKTtcbiAgICBpZiAoY21kID09PSAncmVjZWl2ZUFzeW5jUmVzcG9uc2UnKSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5yZWNlaXZlQXN5bmNSZXNwb25zZSguLi5hcmdzKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMucmVhZHkgfHwgXy5pbmNsdWRlcyhbJ2xhdW5jaEFwcCddLCBjbWQpKSB7XG4gICAgICByZXR1cm4gYXdhaXQgc3VwZXIuZXhlY3V0ZUNvbW1hbmQoY21kLCAuLi5hcmdzKTtcbiAgICB9XG5cbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vU3VjaERyaXZlckVycm9yKGBEcml2ZXIgaXMgbm90IHJlYWR5LCBjYW5ub3QgZXhlY3V0ZSAke2NtZH0uYCk7XG4gIH1cblxuICAvLyBUT0RPOiByZWZvcm1hdCB0aGlzLmhlbHBlcnMgKyBjb25maWd1cmVBcHBcbiAgYXN5bmMgY29uZmlndXJlQXBwICgpIHtcbiAgICB0cnkge1xuICAgICAgLy8gaWYgdGhlIGFwcCBuYW1lIGlzIGEgYnVuZGxlSWQgYXNzaWduIGl0IHRvIHRoZSBidW5kbGVJZCBwcm9wZXJ0eVxuICAgICAgaWYgKCF0aGlzLm9wdHMuYnVuZGxlSWQgJiYgdXRpbHMuYXBwSXNQYWNrYWdlT3JCdW5kbGUodGhpcy5vcHRzLmFwcCkpIHtcbiAgICAgICAgdGhpcy5vcHRzLmJ1bmRsZUlkID0gdGhpcy5vcHRzLmFwcDtcbiAgICAgIH1cblxuICAgICAgLy8gaWYgd2UgaGF2ZSBhbiBpcGEgZmlsZSwgc2V0IGl0IGluIG9wdHNcbiAgICAgIGlmICh0aGlzLm9wdHMuYXBwKSB7XG4gICAgICAgIGxldCBleHQgPSB0aGlzLm9wdHMuYXBwLnN1YnN0cmluZyh0aGlzLm9wdHMuYXBwLmxlbmd0aCAtIDMpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGlmIChleHQgPT09ICdpcGEnKSB7XG4gICAgICAgICAgdGhpcy5vcHRzLmlwYSA9IHRoaXMub3B0cy5hcHA7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMub3B0cy5hcHAgJiYgdGhpcy5vcHRzLmFwcC50b0xvd2VyQ2FzZSgpID09PSBcInNldHRpbmdzXCIpIHtcbiAgICAgICAgaWYgKHBhcnNlRmxvYXQodGhpcy5vcHRzLnBsYXRmb3JtVmVyc2lvbikgPj0gOCkge1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhcIldlIGFyZSBvbiBpT1M4KyBzbyBub3QgY29weWluZyBwcmVmZXJlbmNlcyBhcHBcIik7XG4gICAgICAgICAgdGhpcy5vcHRzLmJ1bmRsZUlkID0gXCJjb20uYXBwbGUuUHJlZmVyZW5jZXNcIjtcbiAgICAgICAgICB0aGlzLm9wdHMuYXBwID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICh0aGlzLmlzU2FmYXJpKCkpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzUmVhbERldmljZSgpKSB7XG4gICAgICAgICAgaWYgKHBhcnNlRmxvYXQodGhpcy5vcHRzLnBsYXRmb3JtVmVyc2lvbikgPj0gOCkge1xuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKFwiV2UgYXJlIG9uIGlPUzgrIHNvIG5vdCBjb3B5aW5nIFNhZmFyaSBhcHBcIik7XG4gICAgICAgICAgICB0aGlzLm9wdHMuYnVuZGxlSWQgPSBTQUZBUklfQlVORExFO1xuICAgICAgICAgICAgdGhpcy5vcHRzLmFwcCA9IG51bGw7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIG9uIHJlYWwgZGV2aWNlLCBuZWVkIHRvIGNoZWNrIGlmIHNhZmFyaSBsYXVuY2hlciBleGlzdHNcbiAgICAgICAgICAvLyBmaXJzdCBjaGVjayBpZiBpdCBpcyBhbHJlYWR5IG9uIHRoZSBkZXZpY2VcbiAgICAgICAgICBpZiAoIWF3YWl0IHRoaXMucmVhbERldmljZS5pc0luc3RhbGxlZCh0aGlzLm9wdHMuYnVuZGxlSWQpKSB7XG4gICAgICAgICAgICAvLyBpdCdzIG5vdCBvbiB0aGUgZGV2aWNlLCBzbyBjaGVjayBpZiB3ZSBuZWVkIHRvIGJ1aWxkXG4gICAgICAgICAgICBpZiAoYXdhaXQgbmVlZHNJbnN0YWxsKCkpIHtcbiAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCdTYWZhcmlMYXVuY2hlciBub3QgZm91bmQsIGJ1aWxkaW5nLi4uJyk7XG4gICAgICAgICAgICAgIGF3YWl0IGluc3RhbGwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5vcHRzLmJ1bmRsZUlkID0gU0FGQVJJX0xBVU5DSEVSX0JVTkRMRTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdHMuYnVuZGxlSWQgJiZcbiAgICAgICAgICAgICAgICAgdXRpbHMuYXBwSXNQYWNrYWdlT3JCdW5kbGUodGhpcy5vcHRzLmJ1bmRsZUlkKSAmJlxuICAgICAgICAgICAgICAgICAodGhpcy5vcHRzLmFwcCA9PT0gXCJcIiB8fCB1dGlscy5hcHBJc1BhY2thZ2VPckJ1bmRsZSh0aGlzLm9wdHMuYXBwKSkpIHtcbiAgICAgICAgLy8gd2UgaGF2ZSBhIGJ1bmRsZSBJRCwgYnV0IG5vIGFwcCwgb3IgYXBwIGlzIGFsc28gYSBidW5kbGVcbiAgICAgICAgbG9nZ2VyLmRlYnVnKFwiQXBwIGlzIGFuIGlPUyBidW5kbGUsIHdpbGwgYXR0ZW1wdCB0byBydW4gYXMgcHJlLWV4aXN0aW5nXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5vcHRzLmFwcCA9IGF3YWl0IHRoaXMuaGVscGVycy5jb25maWd1cmVBcHAodGhpcy5vcHRzLmFwcCwgJy5hcHAnKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihlcnIpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgQmFkIGFwcDogJHt0aGlzLm9wdHMuYXBwfS4gQXBwIHBhdGhzIG5lZWQgdG8gYmUgYWJzb2x1dGUsIG9yIHJlbGF0aXZlIHRvIHRoZSBhcHBpdW0gYCArXG4gICAgICAgIFwic2VydmVyIGluc3RhbGwgZGlyLCBvciBhIFVSTCB0byBjb21wcmVzc2VkIGZpbGUsIG9yIGEgc3BlY2lhbCBhcHAgbmFtZS5cIik7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc3RhcnRTaW11bGF0b3IgKCkge1xuICAgIGF3YWl0IHV0aWxzLnJlbW92ZUluc3RydW1lbnRzU29ja2V0KHRoaXMuc29jayk7XG5cbiAgICBsb2dnZXIuZGVidWcoXCJTZXR0aW5nIFhjb2RlIHZlcnNpb25cIik7XG4gICAgdGhpcy54Y29kZVZlcnNpb24gPSBhd2FpdCB1dGlscy5nZXRBbmRDaGVja1hjb2RlVmVyc2lvbih0aGlzLm9wdHMpO1xuICAgIGxvZ2dlci5kZWJ1ZyhgWGNvZGUgdmVyc2lvbiBzZXQgdG8gJHt0aGlzLnhjb2RlVmVyc2lvbn1gKTtcblxuICAgIGxvZ2dlci5kZWJ1ZyhcIlNldHRpbmcgaU9TIFNESyBWZXJzaW9uXCIpO1xuICAgIHRoaXMuaW9zU2RrVmVyc2lvbiA9IGF3YWl0IHV0aWxzLmdldEFuZENoZWNrSW9zU2RrVmVyc2lvbigpO1xuICAgIGxvZ2dlci5kZWJ1ZyhgaU9TIFNESyBWZXJzaW9uIHNldCB0byAke3RoaXMuaW9zU2RrVmVyc2lvbn1gKTtcblxuICAgIGF3YWl0IHRoaXMuY2hlY2tTaW1BdmFpbGFibGUoKTtcblxuICAgIGF3YWl0IHRoaXMubW92ZUJ1aWx0SW5BcHAoKTtcblxuICAgIHRoaXMuc2ltID0gYXdhaXQgZ2V0U2ltdWxhdG9yKHRoaXMuaW9zU2ltVWRpZCwgdGhpcy54Y29kZVZlcnNpb24pO1xuXG4gICAgYXdhaXQgdXRpbHMucGFyc2VMb2NhbGl6YWJsZVN0cmluZ3ModGhpcy5vcHRzKTtcblxuICAgIGF3YWl0IHV0aWxzLnNldEJ1bmRsZUlkRnJvbUFwcCh0aGlzLm9wdHMpO1xuXG4gICAgYXdhaXQgdGhpcy5jcmVhdGVJbnN0cnVtZW50cygpO1xuXG4gICAge1xuICAgICAgLy8gcHJldmlvdXNseSBzZXREZXZpY2VJbmZvKClcbiAgICAgIHRoaXMuc2hvdWxkUHJlbGF1bmNoU2ltdWxhdG9yID0gdXRpbHMuc2hvdWxkUHJlbGF1bmNoU2ltdWxhdG9yKHRoaXMub3B0cywgdGhpcy5pb3NTZGtWZXJzaW9uKTtcbiAgICAgIGxldCBkU3RyaW5nID0gYXdhaXQgdGhpcy5hZGp1c3RlZERldmljZU5hbWUoKTtcbiAgICAgIGlmICh0aGlzLmNhcHMuYXBwKSB7XG4gICAgICAgIGF3YWl0IHV0aWxzLnNldERldmljZVR5cGVJbkluZm9QbGlzdCh0aGlzLm9wdHMuYXBwLCBkU3RyaW5nKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBhd2FpdCB0aGlzLmNoZWNrUHJlZmVyZW5jZXMoKTtcblxuICAgIGF3YWl0IHRoaXMucnVuU2ltUmVzZXQoKTtcbiAgICBhd2FpdCB0aGlzLmlzb2xhdGVTaW1EZXZpY2UoKTtcbiAgICBhd2FpdCB0aGlzLnNldExvY2FsZSgpO1xuICAgIGF3YWl0IHRoaXMuc2V0UHJlZmVyZW5jZXMoKTtcbiAgICBhd2FpdCB0aGlzLnN0YXJ0TG9nQ2FwdHVyZSgpO1xuICAgIGF3YWl0IHRoaXMucHJlbGF1bmNoU2ltdWxhdG9yKCk7XG4gICAgYXdhaXQgdGhpcy5zdGFydEluc3RydW1lbnRzKCk7XG4gICAgYXdhaXQgdGhpcy5vbkluc3RydW1lbnRzTGF1bmNoKCk7XG4gICAgYXdhaXQgdGhpcy5jb25maWd1cmVCb290c3RyYXAoKTtcbiAgICBhd2FpdCB0aGlzLnNldEJ1bmRsZUlkKCk7XG4gICAgYXdhaXQgdGhpcy5zZXRJbml0aWFsT3JpZW50YXRpb24oKTtcbiAgICBhd2FpdCB0aGlzLmluaXRBdXRvV2VidmlldygpO1xuICAgIGF3YWl0IHRoaXMud2FpdEZvckFwcExhdW5jaGVkKCk7XG4gIH1cblxuICBhc3luYyBzdGFydFJlYWxEZXZpY2UgKCkge1xuICAgIGF3YWl0IHV0aWxzLnJlbW92ZUluc3RydW1lbnRzU29ja2V0KHRoaXMuc29jayk7XG4gICAgYXdhaXQgdXRpbHMucGFyc2VMb2NhbGl6YWJsZVN0cmluZ3ModGhpcy5vcHRzKTtcbiAgICBhd2FpdCB1dGlscy5zZXRCdW5kbGVJZEZyb21BcHAodGhpcy5vcHRzKTtcbiAgICBhd2FpdCB0aGlzLmNyZWF0ZUluc3RydW1lbnRzKCk7XG4gICAgYXdhaXQgdGhpcy5ydW5SZWFsRGV2aWNlUmVzZXQoKTtcbiAgICBhd2FpdCB0aGlzLnN0YXJ0TG9nQ2FwdHVyZSgpO1xuICAgIGF3YWl0IHRoaXMuaW5zdGFsbFRvUmVhbERldmljZSgpO1xuICAgIGF3YWl0IHRoaXMuc3RhcnRJbnN0cnVtZW50cygpO1xuICAgIGF3YWl0IHRoaXMub25JbnN0cnVtZW50c0xhdW5jaCgpO1xuICAgIGF3YWl0IHRoaXMuY29uZmlndXJlQm9vdHN0cmFwKCk7XG4gICAgYXdhaXQgdGhpcy5zZXRCdW5kbGVJZCgpO1xuICAgIGF3YWl0IHRoaXMuc2V0SW5pdGlhbE9yaWVudGF0aW9uKCk7XG4gICAgYXdhaXQgdGhpcy5pbml0QXV0b1dlYnZpZXcoKTtcbiAgICBhd2FpdCB0aGlzLndhaXRGb3JBcHBMYXVuY2hlZCgpO1xuICB9XG5cbiAgYXN5bmMgaW5zdGFsbFRvUmVhbERldmljZSAoKSB7XG4gICAgLy8gaWYgdXNlciBoYXMgcGFzc2VkIGluIGRlc2lyZWRDYXBzLmF1dG9MYXVuY2ggPSBmYWxzZVxuICAgIC8vIG1lYW5pbmcgdGhleSB3aWxsIG1hbmFnZSBhcHAgaW5zdGFsbCAvIGxhdW5jaGluZ1xuICAgIGlmICh0aGlzLm9wdHMuYXV0b0xhdW5jaCA9PT0gZmFsc2UpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5vcHRzLnVkaWQpIHtcbiAgICAgIGlmIChhd2FpdCB0aGlzLnJlYWxEZXZpY2UuaXNJbnN0YWxsZWQodGhpcy5vcHRzLmJ1bmRsZUlkKSkge1xuICAgICAgICBsb2dnZXIuZGVidWcoXCJBcHAgaXMgaW5zdGFsbGVkLlwiKTtcbiAgICAgICAgaWYgKHRoaXMub3B0cy5mdWxsUmVzZXQpIHtcbiAgICAgICAgICBsb2dnZXIuZGVidWcoXCJmdWxsUmVzZXQgcmVxdWVzdGVkLiBGb3JjaW5nIGFwcCBpbnN0YWxsLlwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBsb2dnZXIuZGVidWcoXCJmdWxsUmVzZXQgbm90IHJlcXVlc3RlZC4gTm8gbmVlZCB0byBpbnN0YWxsLlwiKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhcIkFwcCBpcyBub3QgaW5zdGFsbGVkLiBXaWxsIHRyeSB0byBpbnN0YWxsIHRoZSBhcHAuXCIpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5vcHRzLmlwYSAmJiB0aGlzLm9wdHMuYnVuZGxlSWQpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5pbnN0YWxsSXBhKCk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMub3B0cy5pcGEpIHtcbiAgICAgICAgbGV0IG1zZyA9IFwiWW91IHNwZWNpZmllZCBhIFVESUQgYW5kIGlwYSBidXQgZGlkIG5vdCBpbmNsdWRlIHRoZSBidW5kbGUgaWRcIjtcbiAgICAgICAgbG9nZ2VyLndhcm4obXNnKTtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duRXJyb3IobXNnKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5vcHRzLmFwcCkge1xuICAgICAgICBhd2FpdCB0aGlzLnJlYWxEZXZpY2UuaW5zdGFsbCh0aGlzLm9wdHMuYXBwKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhcIlJlYWwgZGV2aWNlIHNwZWNpZmllZCBidXQgbm8gaXBhIG9yIGFwcCBwYXRoLCBhc3N1bWluZyBidW5kbGUgSUQgaXMgXCIgK1xuICAgICAgICAgICAgICAgICAgICAgXCJvbiBkZXZpY2VcIik7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhcIk5vIGRldmljZSBpZCBvciBhcHAsIG5vdCBpbnN0YWxsaW5nIHRvIHJlYWwgZGV2aWNlLlwiKTtcbiAgICB9XG4gIH1cblxuICBnZXRJRGV2aWNlT2JqICgpIHtcbiAgICBsZXQgaWRpUGF0aCA9IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsIFwiLi4vLi4vLi4vYnVpbGQvXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJsaWJpbW9iaWxlZGV2aWNlLW1hY29zeC9pZGV2aWNlaW5zdGFsbGVyXCIpO1xuICAgIGxvZ2dlci5kZWJ1ZyhgQ3JlYXRpbmcgaURldmljZSBvYmplY3Qgd2l0aCB1ZGlkICR7dGhpcy5vcHRzLnVkaWR9YCk7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBpRGV2aWNlKHRoaXMub3B0cy51ZGlkKTtcbiAgICB9IGNhdGNoIChlMSkge1xuICAgICAgbG9nZ2VyLmRlYnVnKGBDb3VsZG4ndCBmaW5kIGlkZXZpY2VpbnN0YWxsZXIsIHRyeWluZyBidWlsdC1pbiBhdCAke2lkaVBhdGh9YCk7XG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4gaURldmljZSh0aGlzLm9wdHMudWRpZCwge2NtZDogaWRpUGF0aH0pO1xuICAgICAgfSBjYXRjaCAoZTIpIHtcbiAgICAgICAgbGV0IG1zZyA9IFwiQ291bGQgbm90IGluaXRpYWxpemUgaWRldmljZWluc3RhbGxlcjsgbWFrZSBzdXJlIGl0IGlzIFwiICtcbiAgICAgICAgICAgICAgICAgIFwiaW5zdGFsbGVkIGFuZCB3b3JrcyBvbiB5b3VyIHN5c3RlbVwiO1xuICAgICAgICBsb2dnZXIuZXJyb3IobXNnKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1zZyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgaW5zdGFsbElwYSAoKSB7XG4gICAgbG9nZ2VyLmRlYnVnKGBJbnN0YWxsaW5nIGlwYSBmb3VuZCBhdCAke3RoaXMub3B0cy5pcGF9YCk7XG4gICAgaWYgKGF3YWl0IHRoaXMucmVhbERldmljZS5pc0luc3RhbGxlZCh0aGlzLm9wdHMuYnVuZGxlSWQpKSB7XG4gICAgICBsb2dnZXIuZGVidWcoXCJCdW5kbGUgZm91bmQgb24gZGV2aWNlLCByZW1vdmluZyBiZWZvcmUgcmVpbnN0YWxsaW5nLlwiKTtcbiAgICAgIGF3YWl0IHRoaXMucmVhbERldmljZS5yZW1vdmUodGhpcy5vcHRzLmJ1bmRsZUlkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbG9nZ2VyLmRlYnVnKFwiTm90aGluZyBmb3VuZCBvbiBkZXZpY2UsIGdvaW5nIGFoZWFkIGFuZCBpbnN0YWxsaW5nLlwiKTtcbiAgICB9XG4gICAgYXdhaXQgdGhpcy5yZWFsRGV2aWNlLmluc3RhbGxBbmRXYWl0KHRoaXMub3B0cy5pcGEsIHRoaXMub3B0cy5idW5kbGVJZCk7XG4gIH1cblxuICBhc3luYyBtb3ZlQnVpbHRJbkFwcCAoKSB7XG4gICAgLy8gY2FsbCBzaW0gZnVuY3Rpb24gb25jZSBpdCBpcyBpbiBwbGFjZVxuICB9XG5cbiAgdmFsaWRhdGVEZXNpcmVkQ2FwcyAoY2Fwcykge1xuICAgIC8vIGNoZWNrIHdpdGggdGhlIGJhc2UgY2xhc3MsIGFuZCByZXR1cm4gaWYgaXQgZmFpbHNcbiAgICBsZXQgcmVzID0gc3VwZXIudmFsaWRhdGVEZXNpcmVkQ2FwcyhjYXBzKTtcbiAgICBpZiAoIXJlcykgcmV0dXJuIHJlcztcblxuICAgIC8vIG1ha2Ugc3VyZSB0aGF0IHRoZSBjYXBhYmlsaXRpZXMgaGF2ZSBvbmUgb2YgYGFwcGAgb3IgYGJ1bmRsZUlkYFxuICAgIGlmICgoY2Fwcy5icm93c2VyTmFtZSB8fCAnJykudG9Mb3dlckNhc2UoKSAhPT0gJ3NhZmFyaScgJiZcbiAgICAgICAgIWNhcHMuYXBwICYmICEgY2Fwcy5idW5kbGVJZCkge1xuICAgICAgbGV0IG1zZyA9ICdUaGUgZGVzaXJlZCBjYXBhYmlsaXRpZXMgbXVzdCBpbmNsdWRlIGVpdGhlciBhbiBhcHAgb3IgYSBidW5kbGVJZCBmb3IgaU9TJztcbiAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KG1zZyk7XG4gICAgfVxuXG4gICAgLy8gYGxhdW5jaFRpbWVvdXRgIGlzIG1vcmUgY29tcGxleCB0aGFuIHRoZSB2YWxpZGF0b3JzIGNhbiBlYXNpbHkgaGFuZGxlXG4gICAgLy8gYW5kIHRvbyBzcGVjaWZpYyBmb3IgYSBnZW5lcmFsaXplZCB2YWxpZGF0b3Igb2YgaXRzIG93blxuICAgIGlmIChjYXBzLmxhdW5jaFRpbWVvdXQpIHtcbiAgICAgIC8vIGl0IGNhbiBiZSBhIG51bWJlciwgYSBKU09OIHN0cmluZywgb3IgYW4gb2JqZWN0XG4gICAgICBsZXQgbXNnID0gJ2xhdW5jaFRpbWVvdXQgbXVzdCBiZSBhIG51bWJlciwgb2JqZWN0LCBvciBzdHJpbmcgSlNPTiBvYmplY3QnO1xuICAgICAgaWYgKCFfLmlzTnVtYmVyKGNhcHMubGF1bmNoVGltZW91dCkpIHtcbiAgICAgICAgaWYgKF8uaXNTdHJpbmcoY2Fwcy5sYXVuY2hUaW1lb3V0KSkge1xuICAgICAgICAgIC8vIGlmIHRoaXMgaXMgYSBzdHJpbmcsIGl0IG11c3QgYmUgYSBKU09OIHN0cmluZ1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBjaGFuZ2UgYGxhdW5jaFRpbWVvdXRgIHRvIGFuIG9iamVjdFxuICAgICAgICAgICAgY2Fwcy5sYXVuY2hUaW1lb3V0ID0gSlNPTi5wYXJzZShjYXBzLmxhdW5jaFRpbWVvdXQpO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgLy8gaXQgd2FzIGEgc3RyaW5nLCBidXQgbm90IHNvbWV0aGluZyBwYXJzYWJsZSBhcyBKU09OXG4gICAgICAgICAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdyhtc2cpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIV8uaXNPYmplY3QoY2Fwcy5sYXVuY2hUaW1lb3V0KSkge1xuICAgICAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KG1zZyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBgcHJvY2Vzc0FyZ3VtZW50c2AgaXMgbW9yZSBjb21wbGV4IGFzIGl0IGNhbiBiZSBhIHN0cmluZ1xuICAgIC8vIG9yIGEgaGFzaFxuICAgIGlmIChjYXBzLnByb2Nlc3NBcmd1bWVudHMpIHtcbiAgICAgIGlmIChfLmlzU3RyaW5nKGNhcHMucHJvY2Vzc0FyZ3VtZW50cykpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyB0cnkgdG8gcGFyc2UgdGhlIHN0cmluZyBhcyBKU09OXG4gICAgICAgICAgY2Fwcy5wcm9jZXNzQXJndW1lbnRzID0gSlNPTi5wYXJzZShjYXBzLnByb2Nlc3NBcmd1bWVudHMpO1xuICAgICAgICB9IGNhdGNoIChpZ24pIHtcbiAgICAgICAgICAvLyBpZiB3ZSBjYW5ub3QgcGFyc2UsIGp1c3QgbGVhdmUgYXMgYSBzdHJpbmdcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICghXy5pc09iamVjdChjYXBzLnByb2Nlc3NBcmd1bWVudHMpKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KCdwcm9jZXNzQXJndW1lbnRzIG11c3QgYmUgYSBzdHJpbmcsIG9iamVjdCwgb3IgYSBzdHJpbmcgSlNPTiBvYmplY3QnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBmaW5hbGx5LCByZXR1cm4gdHJ1ZSBzaW5jZSB0aGUgc3VwZXJjbGFzcyBjaGVjayBwYXNzZWQsIGFzIGRpZCB0aGlzXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBhc3luYyBjaGVja1ByZWZlcmVuY2VzICgpIHtcbiAgICAvLyBUT0RPOiB0aGlzIG5lZWQgdG8gYmUgc3BsaXQgaW4gMiBoZWxwZXJzXG4gICAgbGV0IHNldHRpbmdzQ2FwcyA9IFtcbiAgICAgICdsb2NhdGlvblNlcnZpY2VzRW5hYmxlZCcsXG4gICAgICAnbG9jYXRpb25TZXJ2aWNlc0F1dGhvcml6ZWQnLFxuICAgICAgJ3NhZmFyaUFsbG93UG9wdXBzJyxcbiAgICAgICdzYWZhcmlJZ25vcmVGcmF1ZFdhcm5pbmcnLFxuICAgICAgJ3NhZmFyaU9wZW5MaW5rc0luQmFja2dyb3VuZCdcbiAgICBdO1xuICAgIGxldCBzYWZhcmlTZXR0aW5nc0NhcHMgPSBzZXR0aW5nc0NhcHMuc2xpY2UoMiwgNSk7XG4gICAgdGhpcy5uZWVkVG9TZXRQcmVmcyA9IGZhbHNlO1xuICAgIHRoaXMubmVlZFRvU2V0U2FmYXJpUHJlZnMgPSBmYWxzZTtcbiAgICBmb3IgKGxldCBjYXAgb2Ygc2V0dGluZ3NDYXBzKSB7XG4gICAgICBpZiAoXy5oYXModGhpcy5vcHRzLCBjYXApKSB7XG4gICAgICAgIHRoaXMubmVlZFRvU2V0UHJlZnMgPSB0cnVlO1xuICAgICAgICBpZiAoXy5pbmNsdWRlcyhzYWZhcmlTZXR0aW5nc0NhcHMsIGNhcCkpIHtcbiAgICAgICAgICB0aGlzLm5lZWRUb1NldFNhZmFyaVByZWZzID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLmtlZXBBcHBUb1JldGFpblByZWZzID0gdGhpcy5uZWVkVG9TZXRQcmVmcztcbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZVNpbSAoKSB7XG4gICAgYXdhaXQgdGhpcy5zaW0uZGVsZXRlKCk7XG4gIH1cblxuICBhc3luYyBjbGVhckFwcERhdGEgICgpIHtcbiAgICBpZiAoIXRoaXMua2VlcEFwcFRvUmV0YWluUHJlZnMgJiYgdGhpcy5vcHRzLmFwcCAmJiB0aGlzLm9wdHMuYnVuZGxlSWQpIHtcbiAgICAgIGF3YWl0IHRoaXMuc2ltLmNsZWFuQ3VzdG9tQXBwKHBhdGguYmFzZW5hbWUodGhpcy5vcHRzLmFwcCksIHRoaXMub3B0cy5idW5kbGVJZCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgY2xlYW51cERldmljZVN0YXRlICgpIHtcbiAgICBpZiAodGhpcy5pc1JlYWxEZXZpY2UoKSAmJiB0aGlzLm9wdHMuYnVuZGxlSWQgJiYgdGhpcy5vcHRzLmZ1bGxSZXNldCkge1xuICAgICAgbGV0IGJ1bmRsZUlkID0gdGhpcy5vcHRzLmJ1bmRsZUlkO1xuICAgICAgbG9nZ2VyLmRlYnVnKGBGdWxsIHJlc2V0IHJlcXVlc3RlZC4gV2lsbCB0cnkgdG8gdW5pbnN0YWxsIHRoZSBhcHAgJyR7YnVuZGxlSWR9Jy5gKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMucmVhbERldmljZS5yZW1vdmUoYnVuZGxlSWQpO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcihgQ291bGQgbm90IHJlbW92ZSAnJHtidW5kbGVJZH0nIGZyb20gZGV2aWNlYCk7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH1cbiAgICAgIGxvZ2dlci5kZWJ1ZyhgUmVtb3ZlZCAke2J1bmRsZUlkfWApO1xuICAgIH0gZWxzZSBpZiAoIXRoaXMuaXNSZWFsRGV2aWNlKCkpIHtcbiAgICAgIGlmICh0aGlzLnNpbSkge1xuICAgICAgICBsb2dnZXIuZGVidWcoJ0NsZWFuaW5nIHNpbSBzdGF0ZS4nKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCB0aGlzLmNsZWFyQXBwRGF0YSgpO1xuICAgICAgICAgIGF3YWl0IHRoaXMuc2ltLmNsZWFuKCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIGxvZ2dlci53YXJuKGVycik7XG4gICAgICAgICAgbG9nZ2VyLndhcm4oXCJDb3VsZCBub3QgcmVzZXQgc2ltdWxhdG9yLiBMZWF2aW5nIGFzIGlzLlwiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHJ1blJlYWxEZXZpY2VSZXNldCAoKSB7XG4gICAgaWYgKHRoaXMub3B0cy5yZXNldCB8fCB0aGlzLm9wdHMuZnVsbFJlc2V0KSB7XG4gICAgICBsb2dnZXIuZGVidWcoXCJSdW5uaW5nIGlvcyByZWFsIGRldmljZSByZXNldCBmbG93XCIpO1xuICAgICAgaWYgKHRoaXMub3B0cy5yZXNldCkge1xuICAgICAgICBhd2FpdCB0aGlzLmNsZWFudXBEZXZpY2VTdGF0ZSgpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBsb2dnZXIuZGVidWcoXCJSZXNldCBub3Qgc2V0LCBub3QgZW5kaW5nIHJlYWwgZGV2aWNlXCIpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHJ1blNpbVJlc2V0ICgpIHtcbiAgICBpZiAodGhpcy5vcHRzLnJlc2V0IHx8IHRoaXMub3B0cy5mdWxsUmVzZXQpIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhcIlJ1bm5pbmcgaW9zIHNpbSByZXNldCBmbG93XCIpO1xuICAgICAgLy8gVGhlIHNpbXVsYXRvciBwcm9jZXNzIG11c3QgYmUgZW5kZWQgYmVmb3JlIHdlIGRlbGV0ZSBhcHBsaWNhdGlvbnMuXG4gICAgICBhd2FpdCB0aGlzLmVuZFNpbXVsYXRvcigpO1xuICAgICAgaWYgKHRoaXMub3B0cy5mdWxsUmVzZXQgJiYgIXRoaXMuaXNSZWFsRGV2aWNlKCkpIHtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKCdGdWxsIHJlc2V0IGlzIG9uLCBzbyBlcmFzaW5nIHNpbXVsYXRvcicpO1xuICAgICAgICBhd2FpdCB0aGlzLmNsZWFuU2ltdWxhdG9yKCk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMub3B0cy5yZXNldCkge1xuICAgICAgICBhd2FpdCB0aGlzLmNsZWFudXBEZXZpY2VTdGF0ZSgpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBsb2dnZXIuZGVidWcoXCJSZXNldCBub3Qgc2V0LCBub3QgZW5kaW5nIHNpbVwiKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBjbGVhblNpbXVsYXRvciAoKSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdDbGVhbmluZyB0aGUgc2ltdWxhdG9yJyk7XG4gICAgaWYgKHRoaXMuc2ltKSB7XG4gICAgICBhd2FpdCB0aGlzLnNpbS5jbGVhbigpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGVuZFNpbXVsYXRvciAoKSB7XG4gICAgbG9nZ2VyLmRlYnVnKFwiS2lsbGluZyB0aGUgc2ltdWxhdG9yXCIpO1xuICAgIGlmICh0aGlzLnNpbSkge1xuICAgICAgYXdhaXQgdGhpcy5zaW0uc2h1dGRvd24oKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBpc29sYXRlU2ltRGV2aWNlICgpIHtcbiAgICBpZiAoIXRoaXMuaXNSZWFsRGV2aWNlKCkgJiYgdGhpcy5vcHRzLmlzb2xhdGVTaW1EZXZpY2UgJiZcbiAgICAgICAgdGhpcy5pb3NTZGtWZXJzaW9uID49IDgpIHtcbiAgICAgIGF3YWl0IHRoaXMuc2ltLmlzb2xhdGVTaW0oKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBsYXVuY2hBbmRRdWl0U2ltdWxhdG9yICgpIHtcbiAgICBsb2dnZXIuZGVidWcoJ05vIHNpbXVsYXRvciBkaXJlY3RvcmllcyBmb3VuZC4nKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5zaW0ubGF1bmNoQW5kUXVpdCh0aGlzLmlzU2FmYXJpKCkpO1xuICB9XG5cbiAgYXN5bmMgc2V0TG9jYWxlICgpIHtcbiAgICBpZiAodGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgICAgbG9nZ2VyLmRlYnVnKFwiTm90IHNldHRpbmcgbG9jYWxlIGJlY2F1c2Ugd2UncmUgdXNpbmcgYSByZWFsIGRldmljZVwiKTtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2UgaWYgKCF0aGlzLm9wdHMubGFuZ3VhZ2UgJiYgIXRoaXMub3B0cy5sb2NhbGUgJiYgIXRoaXMub3B0cy5jYWxlbmRhckZvcm1hdCkge1xuICAgICAgbG9nZ2VyLmRlYnVnKFwiTm90IHNldHRpbmcgbG9jYWxlXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIHdlIG5lZWQgdGhlIHNpbXVsYXRvciB0byBoYXZlIGl0cyBkaXJlY3RvcmllcyBpbiBwbGFjZVxuICAgIGlmIChhd2FpdCB0aGlzLnNpbS5pc0ZyZXNoKCkpIHtcbiAgICAgIHRoaXMubGF1bmNoQW5kUXVpdFNpbXVsYXRvcigpO1xuICAgIH1cblxuICAgIGxvZ2dlci5kZWJ1ZyhcIlNldHRpbmcgbG9jYWxlIGluZm9ybWF0aW9uXCIpO1xuICAgIHRoaXMubG9jYWxlQ29uZmlnID0gdGhpcy5sb2NhbGVDb25maWcgfHwge307XG4gICAgdGhpcy5sb2NhbGVDb25maWcgPSB7XG4gICAgICBsYW5ndWFnZTogdGhpcy5vcHRzLmxhbmd1YWdlIHx8IHRoaXMubG9jYWxlQ29uZmlnLmxhbmd1YWdlLFxuICAgICAgbG9jYWxlOiB0aGlzLm9wdHMubG9jYWxlIHx8IHRoaXMubG9jYWxlQ29uZmlnLmxvY2FsZSxcbiAgICAgIGNhbGVuZGFyRm9ybWF0OiB0aGlzLm9wdHMuY2FsZW5kYXJGb3JtYXQgfHwgdGhpcy5sb2NhbGVDb25maWcuY2FsZW5kYXJGb3JtYXRcbiAgICB9O1xuXG4gICAgdHJ5IHtcbiAgICAgIGxldCB1cGRhdGVkID0gYXdhaXQgdGhpcy5zaW0udXBkYXRlTG9jYWxlKHRoaXMub3B0cy5sYW5ndWFnZSwgdGhpcy5vcHRzLmxvY2FsZSwgdGhpcy5vcHRzLmNhbGVuZGFyRm9ybWF0KTtcbiAgICAgIGlmICh1cGRhdGVkKSB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZygnTG9jYWxlIHdhcyB1cGRhdGVkLiBTdG9wcGluZyBzaW11bGF0b3IuJyk7XG4gICAgICAgIGF3YWl0IHRoaXMuZW5kU2ltdWxhdG9yKCk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgbG9nZ2VyLmVycm9yQW5kVGhyb3coYEFwcGl1bSB3YXMgdW5hYmxlIHRvIHNldCBsb2NhbGUgaW5mbzogJHtlfWApO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHNldFByZWZlcmVuY2VzICgpIHtcbiAgICBpZiAoIXRoaXMubmVlZFRvU2V0UHJlZnMpIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhcIk5vIGlPUyAvIGFwcCBwcmVmZXJlbmNlcyB0byBzZXRcIik7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIGlmICh0aGlzLm9wdHMuZnVsbFJlc2V0KSB7XG4gICAgICBsZXQgbXNnID0gXCJDYW5ub3Qgc2V0IHByZWZlcmVuY2VzIGJlY2F1c2UgYSBmdWxsLXJlc2V0IHdhcyByZXF1ZXN0ZWRcIjtcbiAgICAgIGxvZ2dlci5kZWJ1Zyhtc2cpO1xuICAgICAgbG9nZ2VyLmVycm9yKG1zZyk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IobXNnKTtcbiAgICB9XG5cbiAgICBsb2dnZXIuZGVidWcoXCJTZXR0aW5nIGlPUyBhbmQgYXBwIHByZWZlcmVuY2VzXCIpO1xuXG4gICAgaWYgKGF3YWl0IHRoaXMuc2ltLmlzRnJlc2goKSkge1xuICAgICAgYXdhaXQgdGhpcy5sYXVuY2hBbmRRdWl0U2ltdWxhdG9yKCk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuc2V0TG9jU2VydmljZXNQcmVmcygpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihcIkVycm9yIHNldHRpbmcgbG9jYXRpb24gc2VydmljZXMgcHJlZmVyZW5jZXMsIHByZWZzIHdpbGwgbm90IHdvcmtcIik7XG4gICAgICBsb2dnZXIuZXJyb3IoZSk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuc2V0U2FmYXJpUHJlZnMoKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoXCJFcnJvciBzZXR0aW5nIHNhZmFyaSBwcmVmZXJlbmNlcywgcHJlZnMgd2lsbCBub3Qgd29ya1wiKTtcbiAgICAgIGxvZ2dlci5lcnJvcihlKTtcbiAgICB9XG5cbiAgICBsb2dnZXIuZGVidWcoXCJVcGRhdGVkIHBsaXN0IGZpbGVzLCByZWJvb3RpbmcgdGhlIHNpbXVsYXRvciBpZiBpdCdzIGFscmVhZHkgb3BlblwiKTtcbiAgICBhd2FpdCB0aGlzLmVuZFNpbXVsYXRvcigpO1xuICB9XG5cbiAgYXN5bmMgc2V0TG9jU2VydmljZXNQcmVmcyAoKSB7XG4gICAgbGV0IGxvY1NlcnYgPSBfLmZpbmQoW3RoaXMub3B0cy5sb2NhdGlvblNlcnZpY2VzRW5hYmxlZCwgdGhpcy5vcHRzLmxvY2F0aW9uU2VydmljZXNBdXRob3JpemVkXSwgKGMpID0+IHtcbiAgICAgIHJldHVybiAhXy5pc1VuZGVmaW5lZChjKTtcbiAgICB9KTtcbiAgICBpZiAoIV8uaXNVbmRlZmluZWQobG9jU2VydikpIHtcbiAgICAgIGxvY1NlcnYgPSBsb2NTZXJ2ID8gMSA6IDA7XG4gICAgICBsb2dnZXIuZGVidWcoYFNldHRpbmcgbG9jYXRpb24gc2VydmljZXMgdG8gJHtsb2NTZXJ2fWApO1xuICAgICAgYXdhaXQgdGhpcy5zaW0udXBkYXRlU2V0dGluZ3MoJ2xvY2F0aW9uU2VydmljZXMnLCB7XG4gICAgICAgIExvY2F0aW9uU2VydmljZXNFbmFibGVkOiBsb2NTZXJ2LFxuICAgICAgICAnTG9jYXRpb25TZXJ2aWNlc0VuYWJsZWRJbjcuMCc6IGxvY1NlcnYsXG4gICAgICAgICdMb2NhdGlvblNlcnZpY2VzRW5hYmxlZEluOC4wJzogbG9jU2VydlxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmICghXy5pc1VuZGVmaW5lZCh0aGlzLm9wdHMubG9jYXRpb25TZXJ2aWNlc0F1dGhvcml6ZWQpKSB7XG4gICAgICBpZiAoIXRoaXMub3B0cy5idW5kbGVJZCkge1xuICAgICAgICBsZXQgbXNnID0gXCJDYW4ndCBzZXQgbG9jYXRpb24gc2VydmljZXMgZm9yIGFwcCB3aXRob3V0IGJ1bmRsZSBJRFwiO1xuICAgICAgICBsb2dnZXIuZXJyb3IobXNnKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1zZyk7XG4gICAgICB9XG4gICAgICBsZXQgbG9jQXV0aCA9ICEhdGhpcy5vcHRzLmxvY2F0aW9uU2VydmljZXNBdXRob3JpemVkO1xuICAgICAgaWYgKGxvY0F1dGgpIHtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKFwiQXV0aG9yaXppbmcgbG9jYXRpb24gc2VydmljZXMgZm9yIGFwcFwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhcIkRlLWF1dGhvcml6aW5nIGxvY2F0aW9uIHNlcnZpY2VzIGZvciBhcHBcIik7XG4gICAgICB9XG4gICAgICBhd2FpdCB0aGlzLnNpbS51cGRhdGVMb2NhdGlvblNldHRpbmdzKHRoaXMub3B0cy5idW5kbGVJZCwgbG9jQXV0aCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc2V0U2FmYXJpUHJlZnMgKCkge1xuICAgIGxldCBzYWZhcmlTZXR0aW5ncyA9IHt9O1xuXG4gICAgaWYgKF8uaGFzKHRoaXMub3B0cywgJ3NhZmFyaUFsbG93UG9wdXBzJykpIHtcbiAgICAgIGxldCB2YWwgPSAhIXRoaXMub3B0cy5zYWZhcmlBbGxvd1BvcHVwcztcbiAgICAgIGxvZ2dlci5kZWJ1ZyhgU2V0dGluZyBqYXZhc2NyaXB0IHdpbmRvdyBvcGVuaW5nIHRvICcke3ZhbH0nYCk7XG4gICAgICBzYWZhcmlTZXR0aW5ncy5XZWJLaXRKYXZhU2NyaXB0Q2FuT3BlbldpbmRvd3NBdXRvbWF0aWNhbGx5ID0gdmFsO1xuICAgICAgc2FmYXJpU2V0dGluZ3MuSmF2YVNjcmlwdENhbk9wZW5XaW5kb3dzQXV0b21hdGljYWxseSA9IHZhbDtcbiAgICB9XG4gICAgaWYgKF8uaGFzKHRoaXMub3B0cywgJ3NhZmFyaUlnbm9yZUZyYXVkV2FybmluZycpKSB7XG4gICAgICBsZXQgdmFsID0gIXRoaXMub3B0cy5zYWZhcmlJZ25vcmVGcmF1ZFdhcm5pbmc7XG4gICAgICBsb2dnZXIuZGVidWcoYFNldHRpbmcgZnJhdWR1bGVudCB3ZWJzaXRlIHdhcm5pbmcgdG8gJyR7dmFsfSdgKTtcbiAgICAgIHNhZmFyaVNldHRpbmdzLldhcm5BYm91dEZyYXVkdWxlbnRXZWJzaXRlcyA9IHZhbDtcbiAgICB9XG4gICAgaWYgKF8uaGFzKHRoaXMub3B0cywgJ3NhZmFyaU9wZW5MaW5rc0luQmFja2dyb3VuZCcpKSB7XG4gICAgICBsZXQgdmFsID0gdGhpcy5vcHRzLnNhZmFyaU9wZW5MaW5rc0luQmFja2dyb3VuZCA/IDEgOiAwO1xuICAgICAgbG9nZ2VyLmRlYnVnKGBTZXR0aW5nIG9wZW5pbmcgbGlua3MgaW4gYmFja2dyb3VuZCB0byAnJHshIXZhbH0nYCk7XG4gICAgICBzYWZhcmlTZXR0aW5ncy5PcGVuTGlua3NJbkJhY2tncm91bmQgPSB2YWw7XG4gICAgfVxuICAgIGlmIChfLnNpemUoc2FmYXJpU2V0dGluZ3MpID4gMCkge1xuICAgICAgYXdhaXQgdGhpcy5zaW0udXBkYXRlU2FmYXJpU2V0dGluZ3Moc2FmYXJpU2V0dGluZ3MpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHN0YXJ0TG9nQ2FwdHVyZSAoKSB7XG4gICAgaWYgKCFfLmlzRW1wdHkodGhpcy5sb2dzKSkge1xuICAgICAgbG9nZ2VyLndhcm4oXCJUcnlpbmcgdG8gc3RhcnQgaU9TIGxvZyBjYXB0dXJlIGJ1dCBpdCdzIGFscmVhZHkgc3RhcnRlZCFcIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMubG9ncy5jcmFzaGxvZyA9IG5ldyBJT1NDcmFzaExvZygpO1xuICAgIHRoaXMubG9ncy5zeXNsb2cgPSBuZXcgSU9TTG9nKHtcbiAgICAgIHNpbTogdGhpcy5zaW0sXG4gICAgICB1ZGlkOiB0aGlzLm9wdHMudWRpZFxuICAgICwgc2hvd0xvZ3M6IHRoaXMub3B0cy5zaG93SU9TTG9nXG4gICAgfSk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMubG9ncy5zeXNsb2cuc3RhcnRDYXB0dXJlKCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2dnZXIud2FybihcIkNvdWxkIG5vdCBjYXB0dXJlIGxvZ3MgZnJvbSBkZXZpY2UuIENvbnRpbnVpbmcgd2l0aG91dCBjYXB0dXJpbmcgbG9ncy5cIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGF3YWl0IHRoaXMubG9ncy5jcmFzaGxvZy5zdGFydENhcHR1cmUoKTtcbiAgfVxuXG4gIGFzeW5jIHByZWxhdW5jaFNpbXVsYXRvciAoKSB7XG4gICAgaWYgKCF0aGlzLnNob3VsZFByZWxhdW5jaFNpbXVsYXRvcikge1xuICAgICAgbG9nZ2VyLmRlYnVnKFwiTm90IHByZS1sYXVuY2hpbmcgc2ltdWxhdG9yXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBhd2FpdCB0aGlzLmVuZFNpbXVsYXRvcigpO1xuICAgIC8vIFRPRE86IGltcGxlbWVudCBwcmVsYXVuY2ggc2ltIGluIHNpbXVsYXRvciBwYWNrYWdlXG4gIH1cblxuICBhc3luYyBvbkluc3RydW1lbnRzTGF1bmNoICgpIHtcbiAgICBsb2dnZXIuZGVidWcoJ0luc3RydW1lbnRzIGxhdW5jaGVkLiBTdGFydGluZyBwb2xsIGxvb3AgZm9yIG5ldyBjb21tYW5kcy4nKTtcbiAgICBpZiAodGhpcy5vcHRzLm9yaWdBcHBQYXRoKSB7XG4gICAgICBsb2dnZXIuZGVidWcoXCJDb3B5aW5nIGFwcCBiYWNrIHRvIGl0cyBvcmlnaW5hbCBwbGFjZVwiKTtcbiAgICAgIHJldHVybiBhd2FpdCBmcy5uY3AodGhpcy5vcHRzLmFwcCwgdGhpcy5vcHRzLm9yaWdBcHBQYXRoKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBzZXRCdW5kbGVJZCAoKSB7XG4gICAgaWYgKHRoaXMub3B0cy5idW5kbGVJZCkge1xuICAgICAgLy8gV2UgYWxyZWFkeSBoYXZlIGEgYnVuZGxlIElkXG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCBiSWQgPSBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zZW5kQ29tbWFuZCgnYXUuYnVuZGxlSWQoKScpO1xuICAgICAgbG9nZ2VyLmRlYnVnKGBCdW5kbGUgSUQgZm9yIG9wZW4gYXBwIGlzICR7YklkLnZhbHVlfWApO1xuICAgICAgdGhpcy5vcHRzLmJ1bmRsZUlkID0gYklkLnZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHNldEluaXRpYWxPcmllbnRhdGlvbiAoKSB7XG4gICAgaWYgKHR5cGVvZiB0aGlzLm9wdHMuaW5pdGlhbE9yaWVudGF0aW9uID09PSBcInN0cmluZ1wiICYmXG4gICAgICAgIF8uaW5jbHVkZXMoW1wiTEFORFNDQVBFXCIsIFwiUE9SVFJBSVRcIl0sXG4gICAgICAgICAgICAgICAgICAgdGhpcy5vcHRzLmluaXRpYWxPcmllbnRhdGlvbi50b1VwcGVyQ2FzZSgpKVxuICAgICAgICApIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhgU2V0dGluZyBpbml0aWFsIG9yaWVudGF0aW9uIHRvICR7dGhpcy5vcHRzLmluaXRpYWxPcmllbnRhdGlvbn1gKTtcbiAgICAgIGxldCBjb21tYW5kID0gYGF1LnNldFNjcmVlbk9yaWVudGF0aW9uKCcke3RoaXMub3B0cy5pbml0aWFsT3JpZW50YXRpb24udG9VcHBlckNhc2UoKX0nKWA7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zZW5kQ29tbWFuZChjb21tYW5kKTtcbiAgICAgICAgdGhpcy5vcHRzLmN1ck9yaWVudGF0aW9uID0gdGhpcy5vcHRzLmluaXRpYWxPcmllbnRhdGlvbjtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBsb2dnZXIud2FybihgU2V0dGluZyBpbml0aWFsIG9yaWVudGF0aW9uIGZhaWxlZCB3aXRoOiAke2Vycn1gKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpc1JlYWxEZXZpY2UgKCkge1xuICAgIHJldHVybiAhIXRoaXMub3B0cy51ZGlkO1xuICB9XG5cbiAgaXNTYWZhcmkgKCkge1xuICAgIHJldHVybiB0aGlzLm9wdHMuc2FmYXJpO1xuICB9XG5cbiAgYXN5bmMgd2FpdEZvckFwcExhdW5jaGVkICAoKSB7XG4gICAgLy8gb24gaU9TOCBpbiBwYXJ0aWN1bGFyLCB3ZSBjYW4gZ2V0IGEgd29ya2luZyBzZXNzaW9uIGJlZm9yZSB0aGUgYXBwXG4gICAgLy8gaXMgcmVhZHkgdG8gcmVzcG9uZCB0byBjb21tYW5kczsgaW4gdGhhdCBjYXNlIHRoZSBzb3VyY2Ugd2lsbCBiZSBlbXB0eVxuICAgIC8vIHNvIHdlIGp1c3Qgc3BpbiB1bnRpbCBpdCdzIG5vdFxuICAgIGxldCBjb25kRm47XG4gICAgaWYgKHRoaXMub3B0cy53YWl0Rm9yQXBwU2NyaXB0KSB7XG4gICAgICAvLyB0aGUgZGVmYXVsdCBnZXRTb3VyY2VGb3JFbGVtZW50Rm9yWE1MIGRvZXMgbm90IGZpdCBzb21lIHVzZSBjYXNlLCBzbyBtYWtpbmcgdGhpcyBjdXN0b21pemFibGUuXG4gICAgICAvLyBUT0RPOiBjb2xsZWN0IHNjcmlwdCBmcm9tIGN1c3RvbWVyIGFuZCBwcm9wb3NlIHNldmVyYWwgb3B0aW9ucywgcGxlYXNlIGNvbW1lbnQgaW4gaXNzdWUgIzQxOTAuXG4gICAgICBsb2dnZXIuZGVidWcoYFVzaW5nIGN1c3RvbSBzY3JpcHQgdG8gd2FpdCBmb3IgYXBwIHN0YXJ0OiAke3RoaXMub3B0cy53YWl0Rm9yQXBwU2NyaXB0fWApO1xuICAgICAgY29uZEZuID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICBsZXQgcmVzO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHJlcyA9IGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKGB0cnl7XFxuJHt0aGlzLm9wdHMud2FpdEZvckFwcFNjcmlwdH1gICtcbiAgICAgICAgICAgICAgICAgICAgIGBcXG59IGNhdGNoKGVycikgeyAkLmxvZyhcIndhaXRGb3JBcHBTY3JpcHQgZXJyOiBcIiArIGVycm9yKTsgZmFsc2U7IH07YCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhgQ2Fubm90IGV2YWwgd2FpdEZvckFwcFNjcmlwdCBzY3JpcHQsIGVycjogJHtlcnJ9YCk7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgcmVzICE9PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICBsb2dnZXIuZGVidWcoJ1VuZXhwZWN0ZWQgcmV0dXJuIHR5cGUgaW4gd2FpdEZvckFwcFNjcmlwdCBzY3JpcHQnKTtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgIH07XG4gICAgfSBlbHNlIGlmICh0aGlzLmlzU2FmYXJpKCkpIHtcbiAgICAgIGlmICh0aGlzLmlzUmVhbERldmljZSgpKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuY2xpY2tCdXR0b25Ub0xhdW5jaFNhZmFyaSgpO1xuICAgICAgfVxuICAgICAgbG9nZ2VyLmRlYnVnKCdXYWl0aW5nIGZvciBpbml0aWFsIHdlYnZpZXcnKTtcbiAgICAgIGF3YWl0IHRoaXMubmF2VG9Jbml0aWFsV2VidmlldygpO1xuICAgICAgY29uZEZuID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhcIldhaXRpbmcgZm9yIGFwcCBzb3VyY2UgdG8gY29udGFpbiBlbGVtZW50c1wiKTtcbiAgICAgIGNvbmRGbiA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBsZXQgc291cmNlID0gYXdhaXQgdGhpcy5nZXRTb3VyY2VGb3JFbGVtZW50Rm9yWE1MKCk7XG4gICAgICAgICAgc291cmNlID0gSlNPTi5wYXJzZShzb3VyY2UgfHwgXCJ7fVwiKTtcbiAgICAgICAgICBsZXQgYXBwRWxzID0gKHNvdXJjZS5VSUFBcHBsaWNhdGlvbiB8fCB7fSlbJz4nXTtcbiAgICAgICAgICByZXR1cm4gYXBwRWxzICYmIGFwcEVscy5sZW5ndGggPiAwICYmICFJb3NEcml2ZXIuaXNTcHJpbmdCb2FyZChzb3VyY2UuVUlBQXBwbGljYXRpb24pO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgbG9nZ2VyLndhcm4oYENvdWxkbid0IGV4dHJhY3QgYXBwIGVsZW1lbnQgZnJvbSBzb3VyY2UsIGVycm9yIHdhczogJHtlfWApO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHdhaXRGb3JDb25kaXRpb24oY29uZEZuLCB7bG9nZ2VyLCB3YWl0TXM6IDEwMDAwLCBpbnRlcnZhbE1zOiA1MDB9KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmIChlcnIubWVzc2FnZSAmJiBlcnIubWVzc2FnZS5tYXRjaCgvQ29uZGl0aW9uIHVubWV0LykpIHtcbiAgICAgICAgbG9nZ2VyLndhcm4oJ0luaXRpYWwgc3BpbiB0aW1lZCBvdXQsIGNvbnRpbnVpbmcgYnV0IHRoZSBhcHAgbWlnaHQgbm90IGJlIHJlYWR5LicpO1xuICAgICAgICBsb2dnZXIuZGVidWcoYEluaXRpYWwgc3BpbiBlcnJvciB3YXM6ICR7ZXJyfWApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyBpc1NwcmluZ0JvYXJkICh1aUFwcE9iaikge1xuICAvLyBUT0RPOiBtb3ZlIHRvIGhlbHBlcnNcbiAgLy8gVGVzdCBmb3IgaU9TIGhvbWVzY3JlZW4gKFNwcmluZ0JvYXJkKS4gQVVUIG9jY2Fzc2lvbmFsbHkgc3RhcnQgdGhlIHNpbSwgYnV0IGZhaWxzIHRvIGxvYWRcbiAgLy8gdGhlIGFwcC4gSWYgdGhhdCBvY2N1cnMsIGdldFNvdXJjZUZvckVsZW1lbnRGb1hNTCB3aWxsIHJldHVybiBhIGRvYyBvYmplY3QgdGhhdCBtZWV0cyBvdXJcbiAgLy8gYXBwLWNoZWNrIGNvbmRpdGlvbnMsIHJlc3VsdGluZyBpbiBhIGZhbHNlIHBvc2l0aXZlLiBUaGlzIGZ1bmN0aW9uIHRlc3RzIHRoZSBVaUFwcGxpY2F0aW9uXG4gIC8vIHByb3BlcnR5J3MgbWV0YSBkYXRhIHRvIGVuc3VyZSB0aGF0IHRoZSBBcHBpdW0gZG9lc24ndCBjb25mdXNlIFNwcmluZ0JvYXJkIHdpdGggdGhlIGFwcFxuICAvLyB1bmRlciB0ZXN0LlxuICAgIHJldHVybiBfLnByb3BlcnR5T2YodWlBcHBPYmpbJ0AnXSkoJ25hbWUnKSA9PT0gJ1NwcmluZ0JvYXJkJztcbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZUluc3RydW1lbnRzICgpIHtcbiAgICBsb2dnZXIuZGVidWcoXCJDcmVhdGluZyBpbnN0cnVtZW50c1wiKTtcbiAgICB0aGlzLnVpQXV0b0NsaWVudCA9IG5ldyBVSUF1dG9DbGllbnQodGhpcy5zb2NrKTtcbiAgICB0aGlzLmluc3RydW1lbnRzID0gYXdhaXQgdGhpcy5tYWtlSW5zdHJ1bWVudHMoKTtcbiAgICB0aGlzLmluc3RydW1lbnRzLm9uU2h1dGRvd24uY2F0Y2goYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gdW5leHBlY3RlZCBleGl0XG4gICAgICBhd2FpdCB0aGlzLnN0YXJ0VW5leHBlY3RlZFNodXRkb3duKG5ldyBlcnJvcnMuVW5rbm93bkVycm9yKCdBYm5vcm1hbCBJbnN0cnVtZW50cyB0ZXJtaW5hdGlvbiEnKSk7XG4gICAgfSkuZG9uZSgpO1xuICB9XG5cbiAgc2hvdWxkSWdub3JlSW5zdHJ1bWVudHNFeGl0ICgpIHtcbiAgICByZXR1cm4gdGhpcy5zYWZhcmkgJiYgdGhpcy5pc1JlYWxEZXZpY2UoKTtcbiAgfVxuXG4gIGFzeW5jIG1ha2VJbnN0cnVtZW50cyAoKSB7XG4gICAgLy8gYXQgdGhlIG1vbWVudCBhbGwgdGhlIGxvZ2dpbmcgaW4gdWlhdXRvIGlzIGF0IGRlYnVnIGxldmVsXG4gICAgbGV0IGJvb3RzdHJhcFBhdGggPSBhd2FpdCBwcmVwYXJlQm9vdHN0cmFwKHtcbiAgICAgIHNvY2s6IHRoaXMuc29jayxcbiAgICAgIGludGVyS2V5RGVsYXk6IHRoaXMub3B0cy5pbnRlcktleURlbGF5LFxuICAgICAganVzdExvb3BJbmZpbml0ZWx5OiBmYWxzZSxcbiAgICAgIGF1dG9BY2NlcHRBbGVydHM6IHRoaXMub3B0cy5hdXRvQWNjZXB0QWxlcnRzLFxuICAgICAgYXV0b0Rpc21pc3NBbGVydHM6IHRoaXMub3B0cy5hdXRvRGlzbWlzc0FsZXJ0cyxcbiAgICAgIHNlbmRLZXlTdHJhdGVneTogdGhpcy5vcHRzLnNlbmRLZXlTdHJhdGVneSB8fCAodGhpcy5pc1JlYWxEZXZpY2UoKSA/ICdncm91cGVkJyA6ICdvbmVCeU9uZScpXG4gICAgfSk7XG4gICAgbGV0IGluc3RydW1lbnRzID0gbmV3IEluc3RydW1lbnRzKHtcbiAgICAgIC8vIG9uIHJlYWwgZGV2aWNlcyBidW5kbGVJZCBpcyBhbHdheXMgdXNlZFxuICAgICAgYXBwOiAoIXRoaXMuaXNSZWFsRGV2aWNlKCkgPyB0aGlzLm9wdHMuYXBwIDogbnVsbCkgfHwgdGhpcy5vcHRzLmJ1bmRsZUlkLFxuICAgICAgdWRpZDogdGhpcy5vcHRzLnVkaWQsXG4gICAgICBwcm9jZXNzQXJndW1lbnRzOiB0aGlzLm9wdHMucHJvY2Vzc0FyZ3VtZW50cyxcbiAgICAgIGlnbm9yZVN0YXJ0dXBFeGl0OiB0aGlzLnNob3VsZElnbm9yZUluc3RydW1lbnRzRXhpdCgpLFxuICAgICAgYm9vdHN0cmFwOiBib290c3RyYXBQYXRoLFxuICAgICAgdGVtcGxhdGU6IHRoaXMub3B0cy5hdXRvbWF0aW9uVHJhY2VUZW1wbGF0ZVBhdGgsXG4gICAgICBpbnN0cnVtZW50c1BhdGg6IHRoaXMub3B0cy5pbnN0cnVtZW50c1BhdGgsXG4gICAgICB3aXRob3V0RGVsYXk6IHRoaXMub3B0cy53aXRob3V0RGVsYXksXG4gICAgICBwbGF0Zm9ybVZlcnNpb246IHRoaXMub3B0cy5wbGF0Zm9ybVZlcnNpb24sXG4gICAgICB3ZWJTb2NrZXQ6IHRoaXMub3B0cy53ZWJTb2NrZXQsXG4gICAgICBsYXVuY2hUaW1lb3V0OiB0aGlzLm9wdHMubGF1bmNoVGltZW91dCxcbiAgICAgIGZsYWtleVJldHJpZXM6IHRoaXMub3B0cy5iYWNrZW5kUmV0cmllcyxcbiAgICAgIHJlYWxEZXZpY2U6IHRoaXMuaXNSZWFsRGV2aWNlKCksXG4gICAgICBzaW11bGF0b3JTZGtBbmREZXZpY2U6IHRoaXMuaW9zU2RrVmVyc2lvbiA+PSA3LjEgPyBhd2FpdCB0aGlzLmFkanVzdGVkRGV2aWNlTmFtZSgpIDogbnVsbCxcbiAgICAgIHRtcERpcjogcGF0aC5yZXNvbHZlKHRoaXMub3B0cy50bXBEaXIgfHwgJy90bXAnLCAnYXBwaXVtLWluc3RydW1lbnRzJyksXG4gICAgICB0cmFjZURpcjogdGhpcy5vcHRzLnRyYWNlRGlyXG4gICAgfSk7XG4gICAgcmV0dXJuIGluc3RydW1lbnRzO1xuICB9XG5cbiAgYXN5bmMgc3RhcnRJbnN0cnVtZW50cyAoKSB7XG4gICAgbG9nZ2VyLmRlYnVnKFwiU3RhcnRpbmcgVUlBdXRvQ2xpZW50LCBhbmQgbGF1bmNoaW5nIEluc3RydW1lbnRzLlwiKTtcblxuICAgIGF3YWl0IEIuYWxsKFtcbiAgICAgIHRoaXMudWlBdXRvQ2xpZW50LnN0YXJ0KCkudGhlbigoKSA9PiB7IHRoaXMuaW5zdHJ1bWVudHMucmVnaXN0ZXJMYXVuY2goKTsgfSksXG4gICAgICB0aGlzLmluc3RydW1lbnRzLmxhdW5jaCgpXG4gICAgXSk7XG4gIH1cblxuICBhc3luYyBjb25maWd1cmVCb290c3RyYXAgKCkge1xuICAgIGxvZ2dlci5kZWJ1ZyhcIlNldHRpbmcgYm9vdHN0cmFwIGNvbmZpZyBrZXlzL3ZhbHVlc1wiKTtcbiAgICBsZXQgaXNWZXJib3NlID0gdHJ1ZTsgLy8gVE9ETzogbGV2ZWwgd2FzIGNvbmZpZ3VyZWQgYWNjb3JkaW5nIHRvIGxvZ2dlclxuICAgIGxldCBjbWQgPSAndGFyZ2V0ID0gJC50YXJnZXQoKTtcXG4nO1xuICAgIGNtZCArPSAnYXUgPSAkO1xcbic7XG4gICAgY21kICs9IGAkLmlzVmVyYm9zZSA9ICR7aXNWZXJib3NlfTtcXG5gO1xuICAgIC8vIE5vdCB1c2luZyB1aWF1dG8gZ3JhY2UgcGVyaW9kIGJlY2F1c2Ugb2YgYnVnLlxuICAgIC8vIGNtZCArPSAnJC50YXJnZXQoKS5zZXRUaW1lb3V0KDEpO1xcbic7XG4gICAgYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoY21kKTtcbiAgfVxuXG4gIGFzeW5jIGNoZWNrU2ltQXZhaWxhYmxlICgpIHtcbiAgICBpZiAodGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgICAgbG9nZ2VyLmRlYnVnKFwiTm90IGNoZWNraW5nIHdoZXRoZXIgc2ltdWxhdG9yIGlzIGF2YWlsYWJsZSBzaW5jZSB3ZSdyZSBvbiBcIiArXG4gICAgICAgICAgICAgICAgICAgXCJhIHJlYWwgZGV2aWNlXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlvc1Nka1ZlcnNpb24gPCA3LjEpIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhcIkluc3RydW1lbnRzIHYgPCA3LjEsIG5vdCBjaGVja2luZyBkZXZpY2Ugc3RyaW5nIHN1cHBvcnRcIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbG9nZ2VyLmRlYnVnKFwiQ2hlY2tpbmcgd2hldGhlciBpbnN0cnVtZW50cyBzdXBwb3J0cyBvdXIgZGV2aWNlIHN0cmluZ1wiKTtcbiAgICBsZXQgdGltZW91dCA9IF8uaXNPYmplY3QodGhpcy5vcHRzLmxhdW5jaFRpbWVvdXQpID8gdGhpcy5vcHRzLmxhdW5jaFRpbWVvdXQuZ2xvYmFsIDogdGhpcy5vcHRzLmxhdW5jaFRpbWVvdXQ7XG4gICAgbGV0IGF2YWlsRGV2aWNlcyA9IGF3YWl0IHJldHJ5KDMsIGluc3RydW1lbnRzVXRpbHMuZ2V0QXZhaWxhYmxlRGV2aWNlcywgdGltZW91dCk7XG4gICAgbGV0IGRTdHJpbmcgPSBhd2FpdCB0aGlzLmFkanVzdGVkRGV2aWNlTmFtZSgpO1xuICAgIGxldCBub0RldmljZXNFcnJvciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBtc2cgPSBgQ291bGQgbm90IGZpbmQgYSBkZXZpY2UgdG8gbGF1bmNoLiBZb3UgcmVxdWVzdGVkIGAgK1xuICAgICAgICAgICAgICAgIGAnJHtkU3RyaW5nfScsIGJ1dCB0aGUgYXZhaWxhYmxlIGRldmljZXMgd2VyZTogYCArXG4gICAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkoYXZhaWxEZXZpY2VzKTtcbiAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KG1zZyk7XG4gICAgfTtcbiAgICBpZiAodGhpcy5pb3NTZGtWZXJzaW9uID49IDgpIHtcbiAgICAgIGxldCBzaW0gPSB1dGlscy5nZXRTaW1Gb3JEZXZpY2VTdHJpbmcoZFN0cmluZywgYXZhaWxEZXZpY2VzKTtcbiAgICAgIGlmIChzaW1bMF0gPT09IG51bGwgfHwgc2ltWzFdID09PSBudWxsKSB7XG4gICAgICAgIG5vRGV2aWNlc0Vycm9yKCk7XG4gICAgICB9XG4gICAgICB0aGlzLmlvc1NpbVVkaWQgPSBzaW1bMV07XG4gICAgICBsb2dnZXIuZGVidWcoYGlPUyBzaW0gVURJRCBpcyAke3RoaXMuaW9zU2ltVWRpZH1gKTtcbiAgICB9IGVsc2UgaWYgKCFfLmluY2x1ZGVzKGF2YWlsRGV2aWNlcywgZFN0cmluZykpIHtcbiAgICAgIG5vRGV2aWNlc0Vycm9yKCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0U291cmNlRm9yRWxlbWVudEZvclhNTCAoY3R4KSB7XG4gICAgbGV0IHNvdXJjZTtcbiAgICBpZiAoIWN0eCkge1xuICAgICAgc291cmNlID0gYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoXCJhdS5tYWluQXBwKCkuZ2V0VHJlZUZvclhNTCgpXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzb3VyY2UgPSBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zZW5kQ29tbWFuZChgYXUuZ2V0RWxlbWVudCgnJHtjdHh9JykuZ2V0VHJlZUZvclhNTCgpYCk7XG4gICAgfVxuICAgIC8vIFRPRE86IGFsbCB0aGlzIGpzb24veG1sIGxvZ2ljIGlzIHZlcnkgZXhwZW5zaXZlLCB3ZSBuZWVkXG4gICAgLy8gdG8gdXNlIGEgU0FYIHBhcnNlciBpbnN0ZWFkLlxuICAgIGlmIChzb3VyY2UpIHtcbiAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShzb3VyY2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyB0aGlzIHNob3VsZCBuZXZlciBoYXBwZW4gYnV0IHdlJ3ZlIHJlY2VpdmVkIGJ1ZyByZXBvcnRzOyB0aGlzIHdpbGwgaGVscCB1cyB0cmFjayBkb3duXG4gICAgICAvLyB3aGF0J3Mgd3JvbmcgaW4gZ2V0VHJlZUZvclhNTFxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBCYWQgcmVzcG9uc2UgZnJvbSBnZXRUcmVlRm9yWE1MLiByZXMgd2FzICR7SlNPTi5zdHJpbmdpZnkoc291cmNlKX1gKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBhZGp1c3RlZERldmljZU5hbWUgKCkge1xuICAgIHRoaXMub3B0cy5fYWRqdXN0ZWREZXZpY2VOYW1lID0gdGhpcy5vcHRzLl9hZGp1c3RlZERldmljZU5hbWUgfHwgYXdhaXQgZ2V0RGV2aWNlU3RyaW5nKHRoaXMub3B0cyk7XG4gICAgcmV0dXJuIHRoaXMub3B0cy5fYWRqdXN0ZWREZXZpY2VOYW1lO1xuICB9XG5cbiAgZ2V0IHJlYWxEZXZpY2UgKCkge1xuICAgIHRoaXMuX3JlYWxEZXZpY2UgPSB0aGlzLl9yZWFsRGV2aWNlIHx8IHRoaXMuZ2V0SURldmljZU9iaigpO1xuICAgIHJldHVybiB0aGlzLl9yZWFsRGV2aWNlO1xuICB9XG5cbiAgc2V0IHJlYWxEZXZpY2UgKHJkKSB7XG4gICAgdGhpcy5fcmVhbERldmljZSA9IHJkO1xuICB9XG59XG5cbmZvciAobGV0IFtjbWQsIGZuXSBvZiBfLnRvUGFpcnMoY29tbWFuZHMpKSB7XG4gIElvc0RyaXZlci5wcm90b3R5cGVbY21kXSA9IGZuO1xufVxuXG5cbmV4cG9ydCB7IElvc0RyaXZlciB9O1xuZXhwb3J0IGRlZmF1bHQgSW9zRHJpdmVyO1xuIl19
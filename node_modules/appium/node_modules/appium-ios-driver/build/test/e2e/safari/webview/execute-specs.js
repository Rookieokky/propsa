/* globals expect */
'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _desired = require('./desired');

var _desired2 = _interopRequireDefault(_desired);

var _setupBase = require('../../setup-base');

var _setupBase2 = _interopRequireDefault(_setupBase);

var _helpersWebview = require('../../helpers/webview');

var SCROLL_INTO_VIEW = 'return arguments[0].scrollIntoView(true);';
var GET_RIGHT_INNERHTML = 'return document.body.innerHTML.indexOf(\'I am some page content\') > 0';
var GET_WRONG_INNERHTML = 'return document.body.innerHTML.indexOf(\'I am not some page content\') > 0';
var GET_ELEM_BY_TAGNAME = 'return document.getElementsByTagName(\'a\');';

describe('safari - webview - execute', function () {
  var _this = this;

  var driver = (0, _setupBase2['default'])(this, _desired2['default'], { 'no-reset': true }).driver;
  before(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap((0, _helpersWebview.loadWebView)(_desired2['default'], driver));

        case 2:
          return context$2$0.abrupt('return', context$2$0.sent);

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should bubble up javascript errors', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      var _this2 = this;

      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          expect(function callee$2$0() {
            return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
              while (1) switch (context$3$0.prev = context$3$0.next) {
                case 0:
                  context$3$0.next = 2;
                  return _regeneratorRuntime.awrap(driver.execute('\'nan\'--'));

                case 2:
                  return context$3$0.abrupt('return', context$3$0.sent);

                case 3:
                case 'end':
                  return context$3$0.stop();
              }
            }, null, _this2);
          }).to['throw'];

        case 1:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should eval javascript', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.execute('return 1'));

        case 2:
          context$2$0.sent.should.be.equal(1);

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should not be returning hardcoded results', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.execute('return 1+1'));

        case 2:
          context$2$0.sent.should.be.equal(2);

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should return nothing when you don\'t explicitly return', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.execute('1+1'));

        case 2:
          context$2$0.t0 = context$2$0.sent;
          expect(context$2$0.t0).to.not.exist;

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should execute code inside the web view', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.execute(GET_RIGHT_INNERHTML));

        case 2:
          context$2$0.sent.should.be.ok;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(driver.execute(GET_WRONG_INNERHTML));

        case 5:
          context$2$0.sent.should.not.be.ok;

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should convert selenium element arg to webview element', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElement('id', 'useragent'));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(driver.execute(SCROLL_INTO_VIEW, [el]));

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should catch stale or undefined element as arg', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElement('id', 'useragent'));

        case 2:
          el = context$2$0.sent;
          return context$2$0.abrupt('return', driver.execute(SCROLL_INTO_VIEW, [{ 'ELEMENT': el.value + 1 }]).should.beRejected);

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should be able to return multiple elements from javascript', function callee$1$0() {
    var res;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.execute(GET_ELEM_BY_TAGNAME));

        case 2:
          res = context$2$0.sent;

          expect(res).to.have.length.above(0);

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should pass along non-element arguments', function callee$1$0() {
    var arg;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          arg = 'non-element-argument';
          context$2$0.next = 3;
          return _regeneratorRuntime.awrap(driver.execute('var args = Array.prototype.slice.call(arguments, 0); return args[0];', [arg]));

        case 3:
          context$2$0.t0 = arg;
          context$2$0.sent.should.be.equal(context$2$0.t0);

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should handle return values correctly', function callee$1$0() {
    var arg;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          arg = ['one', 'two', 'three'];
          context$2$0.next = 3;
          return _regeneratorRuntime.awrap(driver.execute('var args = Array.prototype.slice.call(arguments, 0); return args;', arg));

        case 3:
          context$2$0.t0 = arg;
          context$2$0.sent.should.eql(context$2$0.t0);

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZTJlL3NhZmFyaS93ZWJ2aWV3L2V4ZWN1dGUtc3BlY3MuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozt1QkFDb0IsV0FBVzs7Ozt5QkFDYixrQkFBa0I7Ozs7OEJBQ1IsdUJBQXVCOztBQUVuRCxJQUFNLGdCQUFnQiw4Q0FBOEMsQ0FBQztBQUNyRSxJQUFNLG1CQUFtQiwyRUFBeUUsQ0FBQztBQUNuRyxJQUFNLG1CQUFtQiwrRUFBNkUsQ0FBQztBQUN2RyxJQUFNLG1CQUFtQixpREFBK0MsQ0FBQzs7QUFFekUsUUFBUSxDQUFDLDRCQUE0QixFQUFFLFlBQVc7OztBQUNoRCxNQUFNLE1BQU0sR0FBRyw0QkFBTSxJQUFJLHdCQUFXLEVBQUMsVUFBVSxFQUFFLElBQUksRUFBQyxDQUFDLENBQUMsTUFBTSxDQUFDO0FBQy9ELFFBQU0sQ0FBQzs7Ozs7MkNBQWtCLHVEQUFxQixNQUFNLENBQUM7Ozs7Ozs7Ozs7R0FBQSxDQUFDLENBQUM7O0FBRXZELElBQUUsQ0FBQyxvQ0FBb0MsRUFBRTs7Ozs7O0FBQ3ZDLGdCQUFNLENBQUM7Ozs7O21EQUFrQixNQUFNLENBQUMsT0FBTyxhQUFXOzs7Ozs7Ozs7O1dBQUEsQ0FBQyxDQUFDLEVBQUUsU0FBTSxDQUFDOzs7Ozs7O0dBQzlELENBQUMsQ0FBQzs7QUFFSCxJQUFFLENBQUMsd0JBQXdCLEVBQUU7Ozs7OzJDQUNwQixNQUFNLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQzs7OzJCQUFFLE1BQU0sQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUM7Ozs7Ozs7R0FDckQsQ0FBQyxDQUFDOztBQUVILElBQUUsQ0FBQywyQ0FBMkMsRUFBRTs7Ozs7MkNBQ3ZDLE1BQU0sQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDOzs7MkJBQUUsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQzs7Ozs7OztHQUN2RCxDQUFDLENBQUM7O0FBRUgsSUFBRSw0REFBMkQ7Ozs7OzJDQUM5QyxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQzs7OztBQUFsQyxnQkFBTSxpQkFBOEIsRUFBRSxDQUFDLEdBQUcsQ0FBQyxLQUFLOzs7Ozs7O0dBQ2pELENBQUMsQ0FBQzs7QUFFSCxJQUFFLENBQUMseUNBQXlDLEVBQUU7Ozs7OzJDQUNyQyxNQUFNLENBQUMsT0FBTyxDQUFDLG1CQUFtQixDQUFDOzs7MkJBQUUsTUFBTSxDQUFDLEVBQUUsQ0FBQyxFQUFFOzsyQ0FDakQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQzs7OzJCQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUU7Ozs7Ozs7R0FDN0QsQ0FBQyxDQUFDOztBQUVILElBQUUsQ0FBQyx3REFBd0QsRUFBRTtRQUN2RCxFQUFFOzs7OzsyQ0FBUyxNQUFNLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxXQUFXLENBQUM7OztBQUFoRCxZQUFFOzsyQ0FDQSxNQUFNLENBQUMsT0FBTyxDQUFDLGdCQUFnQixFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7Ozs7Ozs7R0FDN0MsQ0FBQyxDQUFDOztBQUVILElBQUUsQ0FBQyxnREFBZ0QsRUFBRTtRQUMvQyxFQUFFOzs7OzsyQ0FBUyxNQUFNLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxXQUFXLENBQUM7OztBQUFoRCxZQUFFOzhDQUNDLE1BQU0sQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxFQUFDLFNBQVMsRUFBRyxFQUFFLENBQUMsS0FBSyxHQUFHLENBQUMsQUFBQyxFQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFVOzs7Ozs7O0dBQ3pGLENBQUMsQ0FBQzs7QUFFSCxJQUFFLENBQUMsNERBQTRELEVBQUU7UUFDM0QsR0FBRzs7Ozs7MkNBQVMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQzs7O0FBQS9DLGFBQUc7O0FBQ1AsZ0JBQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Ozs7Ozs7R0FDckMsQ0FBQyxDQUFDO0FBQ0gsSUFBRSxDQUFDLHlDQUF5QyxFQUFFO1FBQ3hDLEdBQUc7Ozs7QUFBSCxhQUFHLEdBQUcsc0JBQXNCOzsyQ0FDekIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxzRUFBc0UsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDOzs7MkJBQWtCLEdBQUc7MkJBQW5CLE1BQU0sQ0FBQyxFQUFFLENBQUMsS0FBSzs7Ozs7OztHQUN0SCxDQUFDLENBQUM7QUFDSCxJQUFFLENBQUMsdUNBQXVDLEVBQUU7UUFDdEMsR0FBRzs7OztBQUFILGFBQUcsR0FBRyxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsT0FBTyxDQUFDOzsyQ0FDMUIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxtRUFBbUUsRUFBRSxHQUFHLENBQUM7OzsyQkFBYSxHQUFHOzJCQUFkLE1BQU0sQ0FBQyxHQUFHOzs7Ozs7O0dBQzVHLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L2UyZS9zYWZhcmkvd2Vidmlldy9leGVjdXRlLXNwZWNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFscyBleHBlY3QgKi9cbmltcG9ydCBkZXNpcmVkIGZyb20gJy4vZGVzaXJlZCc7XG5pbXBvcnQgc2V0dXAgZnJvbSAnLi4vLi4vc2V0dXAtYmFzZSc7XG5pbXBvcnQgeyBsb2FkV2ViVmlldyB9IGZyb20gJy4uLy4uL2hlbHBlcnMvd2Vidmlldyc7XG5cbmNvbnN0IFNDUk9MTF9JTlRPX1ZJRVcgPSBgcmV0dXJuIGFyZ3VtZW50c1swXS5zY3JvbGxJbnRvVmlldyh0cnVlKTtgO1xuY29uc3QgR0VUX1JJR0hUX0lOTkVSSFRNTCA9IGByZXR1cm4gZG9jdW1lbnQuYm9keS5pbm5lckhUTUwuaW5kZXhPZignSSBhbSBzb21lIHBhZ2UgY29udGVudCcpID4gMGA7XG5jb25zdCBHRVRfV1JPTkdfSU5ORVJIVE1MID0gYHJldHVybiBkb2N1bWVudC5ib2R5LmlubmVySFRNTC5pbmRleE9mKCdJIGFtIG5vdCBzb21lIHBhZ2UgY29udGVudCcpID4gMGA7XG5jb25zdCBHRVRfRUxFTV9CWV9UQUdOQU1FID0gYHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYScpO2A7XG5cbmRlc2NyaWJlKCdzYWZhcmkgLSB3ZWJ2aWV3IC0gZXhlY3V0ZScsIGZ1bmN0aW9uKCkge1xuICBjb25zdCBkcml2ZXIgPSBzZXR1cCh0aGlzLCBkZXNpcmVkLCB7J25vLXJlc2V0JzogdHJ1ZX0pLmRyaXZlcjtcbiAgYmVmb3JlKGFzeW5jICgpID0+IGF3YWl0IGxvYWRXZWJWaWV3KGRlc2lyZWQsIGRyaXZlcikpO1xuXG4gIGl0KCdzaG91bGQgYnViYmxlIHVwIGphdmFzY3JpcHQgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgIGV4cGVjdChhc3luYyAoKSA9PiBhd2FpdCBkcml2ZXIuZXhlY3V0ZShgJ25hbictLWApKS50by50aHJvdztcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBldmFsIGphdmFzY3JpcHQnLCBhc3luYyAoKSA9PiB7XG4gICAgKGF3YWl0IGRyaXZlci5leGVjdXRlKCdyZXR1cm4gMScpKS5zaG91bGQuYmUuZXF1YWwoMSk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgbm90IGJlIHJldHVybmluZyBoYXJkY29kZWQgcmVzdWx0cycsIGFzeW5jICgpID0+IHtcbiAgICAoYXdhaXQgZHJpdmVyLmV4ZWN1dGUoJ3JldHVybiAxKzEnKSkuc2hvdWxkLmJlLmVxdWFsKDIpO1xuICB9KTtcblxuICBpdChgc2hvdWxkIHJldHVybiBub3RoaW5nIHdoZW4geW91IGRvbid0IGV4cGxpY2l0bHkgcmV0dXJuYCwgYXN5bmMgKCkgPT4ge1xuICAgIGV4cGVjdChhd2FpdCBkcml2ZXIuZXhlY3V0ZSgnMSsxJykpLnRvLm5vdC5leGlzdDtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBleGVjdXRlIGNvZGUgaW5zaWRlIHRoZSB3ZWIgdmlldycsIGFzeW5jICgpID0+IHtcbiAgICAoYXdhaXQgZHJpdmVyLmV4ZWN1dGUoR0VUX1JJR0hUX0lOTkVSSFRNTCkpLnNob3VsZC5iZS5vaztcbiAgICAoYXdhaXQgZHJpdmVyLmV4ZWN1dGUoR0VUX1dST05HX0lOTkVSSFRNTCkpLnNob3VsZC5ub3QuYmUub2s7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgY29udmVydCBzZWxlbml1bSBlbGVtZW50IGFyZyB0byB3ZWJ2aWV3IGVsZW1lbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmZpbmRFbGVtZW50KCdpZCcsICd1c2VyYWdlbnQnKTtcbiAgICBhd2FpdCBkcml2ZXIuZXhlY3V0ZShTQ1JPTExfSU5UT19WSUVXLCBbZWxdKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBjYXRjaCBzdGFsZSBvciB1bmRlZmluZWQgZWxlbWVudCBhcyBhcmcnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmZpbmRFbGVtZW50KCdpZCcsICd1c2VyYWdlbnQnKTtcbiAgICByZXR1cm4gZHJpdmVyLmV4ZWN1dGUoU0NST0xMX0lOVE9fVklFVywgW3snRUxFTUVOVCc6IChlbC52YWx1ZSArIDEpfV0pLnNob3VsZC5iZVJlamVjdGVkO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGJlIGFibGUgdG8gcmV0dXJuIG11bHRpcGxlIGVsZW1lbnRzIGZyb20gamF2YXNjcmlwdCcsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgcmVzID0gYXdhaXQgZHJpdmVyLmV4ZWN1dGUoR0VUX0VMRU1fQllfVEFHTkFNRSk7XG4gICAgZXhwZWN0KHJlcykudG8uaGF2ZS5sZW5ndGguYWJvdmUoMCk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIHBhc3MgYWxvbmcgbm9uLWVsZW1lbnQgYXJndW1lbnRzJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBhcmcgPSAnbm9uLWVsZW1lbnQtYXJndW1lbnQnO1xuICAgIChhd2FpdCBkcml2ZXIuZXhlY3V0ZSgndmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDApOyByZXR1cm4gYXJnc1swXTsnLCBbYXJnXSkpLnNob3VsZC5iZS5lcXVhbChhcmcpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBoYW5kbGUgcmV0dXJuIHZhbHVlcyBjb3JyZWN0bHknLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGFyZyA9IFsnb25lJywgJ3R3bycsICd0aHJlZSddO1xuICAgIChhd2FpdCBkcml2ZXIuZXhlY3V0ZSgndmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDApOyByZXR1cm4gYXJnczsnLCBhcmcpKS5zaG91bGQuZXFsKGFyZyk7XG4gIH0pO1xufSk7XG4iXX0=
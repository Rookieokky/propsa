'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _setupBase = require("../setup-base");

var _setupBase2 = _interopRequireDefault(_setupBase);

var _desired = require('./desired');

var _desired2 = _interopRequireDefault(_desired);

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _helpersRecipesJs = require('../helpers/recipes.js');

describe('uicatalog - find by xpath', function () {
  var session = (0, _setupBase2['default'])(this, _desired2['default']);
  var driver = session.driver;

  describe('individual calls', function () {
    var _this = this;

    beforeEach(function callee$2$0() {
      var el;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElement('xpath', "//UIAStaticText[contains(@label,'Buttons')]"));

          case 2:
            el = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.click(el));

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    afterEach(function callee$2$0() {
      var el;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElement('accessibility id', 'UICatalog'));

          case 2:
            el = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.click(el));

          case 5:
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap(_bluebird2['default'].delay(1000));

          case 7:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should respect implicit wait', function callee$2$0() {
      var begin, end;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.implicitWait(5000));

          case 2:
            begin = Date.now();
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.findElement('xpath', "//something_not_there").should.eventually.be.rejected);

          case 5:
            end = Date.now();

            (end - begin).should.be.above(5000);

          case 7:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should return the last button', function callee$2$0() {
      var el;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElement('xpath', "//UIAButton[last()]"));

          case 2:
            el = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.getText(el));

          case 5:
            context$3$0.sent.should.equal("Button");

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    // this is the name of the last button
    it('should return a single element', function callee$2$0() {
      var el;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElement('xpath', "//UIAButton"));

          case 2:
            el = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.getText(el));

          case 5:
            context$3$0.sent.should.equal("UICatalog");

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should return multiple elements', function callee$2$0() {
      var els;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElements('xpath', "//UIAButton"));

          case 2:
            els = context$3$0.sent;

            els.should.have.length.above(5);

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should filter by name', function callee$2$0() {
      var el;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElement('xpath', "//UIAButton[@name='X Button']"));

          case 2:
            el = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.getText(el));

          case 5:
            context$3$0.sent.should.equal("X Button");

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should know how to restrict root-level elements', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_bluebird2['default'].resolve(driver.findElement('xpath', "/UIAButton"))['catch'](_helpersRecipesJs.throwMatchableError).should.be.rejectedWith(/jsonwpCode: 7/));

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should search an extended path by child', function callee$2$0() {
      var el;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElement('xpath', "//UIANavigationBar/UIAStaticText"));

          case 2:
            el = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.getText(el));

          case 5:
            context$3$0.sent.should.equal('Buttons');

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should search an extended path by descendant', function callee$2$0() {
      var els, texts;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElements('xpath', "//UIATableCell//UIAButton"));

          case 2:
            els = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(_bluebird2['default'].all(_lodash2['default'].map(els, function (el) {
              return driver.getText(el);
            })));

          case 5:
            texts = context$3$0.sent;

            texts.should.not.include("UICatalog");
            texts.should.include("X Button");

          case 8:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should filter by indices', function callee$2$0() {
      var el;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.implicitWait(10000));

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.findElement('xpath', "//UIATableCell[4]/UIAButton[1]"));

          case 4:
            el = context$3$0.sent;
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap(driver.getAttribute('name', el));

          case 7:
            context$3$0.sent.should.equal('X Button');

          case 8:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should filter by partial text', function callee$2$0() {
      var el;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElement('xpath', "//UIATableCell//UIAButton[contains(@name, 'X ')]"));

          case 2:
            el = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.getText(el));

          case 5:
            context$3$0.sent.should.equal("X Button");

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });

  describe('duplicate text field', function () {
    var _this2 = this;

    beforeEach(function callee$2$0() {
      var el;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElement('accessibility id', 'Text Fields'));

          case 2:
            el = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.click(el));

          case 5:
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap(_bluebird2['default'].delay(2000));

          case 7:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    afterEach(function callee$2$0() {
      var el;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElement('accessibility id', 'UICatalog'));

          case 2:
            el = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.click(el));

          case 5:
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap(_bluebird2['default'].delay(1000));

          case 7:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should find only one text field', function callee$2$0() {
      var els;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElements('xpath', '//UIATableView["Empty list"]/UIATableCell[1]/UIATextField'));

          case 2:
            els = context$3$0.sent;

            els.should.have.length(1);

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should find only one text field when doing relative search', function callee$2$0() {
      var el2, els;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElement('xpath', '//UIATableView["Empty list"]'));

          case 2:
            el2 = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.findElementsFromElement('xpath', '//UIATableCell[1]/UIATextField', el2));

          case 5:
            els = context$3$0.sent;

            els.should.have.length(1);

          case 7:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should find only one secure text field', function callee$2$0() {
      var els;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElements('xpath', '//UIATableView["Empty list"]/UIATableCell[3]/UIASecureTextField'));

          case 2:
            els = context$3$0.sent;

            els.should.have.length(1);

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
  });

  describe('multiple calls', function () {
    var runs = 5;

    var test = function test(path, minLength) {
      return function () {
        var _this3 = this;

        it('should not crash', function callee$4$0() {
          var els;
          return _regeneratorRuntime.async(function callee$4$0$(context$5$0) {
            while (1) switch (context$5$0.prev = context$5$0.next) {
              case 0:
                context$5$0.next = 2;
                return _regeneratorRuntime.awrap(driver.findElements('xpath', path));

              case 2:
                els = context$5$0.sent;

                els.should.have.length.above(minLength);

              case 4:
              case 'end':
                return context$5$0.stop();
            }
          }, null, _this3);
        });
      };
    };

    describe('finding specific path', function () {
      for (var n = 0; n < runs; n++) {
        describe('test ' + (n + 1), test("//UIAApplication[1]/UIAWindow/UIATableView/UIATableCell", 17));
      }
    });

    describe('finding //*', function () {
      for (var n = 0; n < runs; n++) {
        describe('test ' + (n + 1), test("//*", 52));
      }
    });
  });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZTJlL3VpY2F0YWxvZy9maW5kLWJ5LXhwYXRoLXNwZWNzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozt5QkFBa0IsZUFBZTs7Ozt1QkFDYixXQUFXOzs7O3dCQUNqQixVQUFVOzs7O3NCQUNWLFFBQVE7Ozs7Z0NBQ2MsdUJBQXVCOztBQUUzRCxRQUFRLENBQUMsMkJBQTJCLEVBQUUsWUFBWTtBQUNoRCxNQUFJLE9BQU8sR0FBRyw0QkFBTSxJQUFJLHVCQUFVLENBQUM7QUFDbkMsTUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQzs7QUFFNUIsVUFBUSxDQUFDLGtCQUFrQixFQUFFLFlBQVk7OztBQUN2QyxjQUFVLENBQUM7VUFDTCxFQUFFOzs7Ozs2Q0FBUyxNQUFNLENBQUMsV0FBVyxDQUFDLE9BQU8sRUFBRSw2Q0FBNkMsQ0FBQzs7O0FBQXJGLGNBQUU7OzZDQUNBLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDOzs7Ozs7O0tBQ3ZCLENBQUMsQ0FBQzs7QUFFSCxhQUFTLENBQUM7VUFDSixFQUFFOzs7Ozs2Q0FBUyxNQUFNLENBQUMsV0FBVyxDQUFDLGtCQUFrQixFQUFFLFdBQVcsQ0FBQzs7O0FBQTlELGNBQUU7OzZDQUNBLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDOzs7OzZDQUNoQixzQkFBRSxLQUFLLENBQUMsSUFBSSxDQUFDOzs7Ozs7O0tBQ3BCLENBQUMsQ0FBQzs7QUFFSCxNQUFFLENBQUMsOEJBQThCLEVBQUU7VUFHN0IsS0FBSyxFQUdMLEdBQUc7Ozs7OzZDQUxELE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDOzs7QUFFM0IsaUJBQUssR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFOzs2Q0FDaEIsTUFBTSxDQUFDLFdBQVcsQ0FBQyxPQUFPLEVBQUUsdUJBQXVCLENBQUMsQ0FDdkQsTUFBTSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsUUFBUTs7O0FBQzVCLGVBQUcsR0FBRyxJQUFJ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LEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLEVBQUUsQ0FBQyxFQUFFLEVBQUU7QUFDN0IsZ0JBQVEsWUFBUyxDQUFDLEdBQUcsQ0FBQyxDQUFBLEVBQUksSUFBSSxDQUFDLHlEQUF5RCxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7T0FDaEc7S0FDRixDQUFDLENBQUM7O0FBRUgsWUFBUSxDQUFDLGFBQWEsRUFBRSxZQUFZO0FBQ2xDLFdBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLEVBQUUsQ0FBQyxFQUFFLEVBQUU7QUFDN0IsZ0JBQVEsWUFBUyxDQUFDLEdBQUcsQ0FBQyxDQUFBLEVBQUksSUFBSSxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO09BQzVDO0tBQ0YsQ0FBQyxDQUFDO0dBQ0osQ0FBQyxDQUFDO0NBQ0osQ0FBQyxDQUFDIiwiZmlsZSI6InRlc3QvZTJlL3VpY2F0YWxvZy9maW5kLWJ5LXhwYXRoLXNwZWNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHNldHVwIGZyb20gXCIuLi9zZXR1cC1iYXNlXCI7XG5pbXBvcnQgZGVzaXJlZCBmcm9tICcuL2Rlc2lyZWQnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IHRocm93TWF0Y2hhYmxlRXJyb3IgfSBmcm9tICcuLi9oZWxwZXJzL3JlY2lwZXMuanMnO1xuXG5kZXNjcmliZSgndWljYXRhbG9nIC0gZmluZCBieSB4cGF0aCcsIGZ1bmN0aW9uICgpIHtcbiAgbGV0IHNlc3Npb24gPSBzZXR1cCh0aGlzLCBkZXNpcmVkKTtcbiAgbGV0IGRyaXZlciA9IHNlc3Npb24uZHJpdmVyO1xuXG4gIGRlc2NyaWJlKCdpbmRpdmlkdWFsIGNhbGxzJywgZnVuY3Rpb24gKCkge1xuICAgIGJlZm9yZUVhY2goYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmZpbmRFbGVtZW50KCd4cGF0aCcsIFwiLy9VSUFTdGF0aWNUZXh0W2NvbnRhaW5zKEBsYWJlbCwnQnV0dG9ucycpXVwiKTtcbiAgICAgIGF3YWl0IGRyaXZlci5jbGljayhlbCk7XG4gICAgfSk7XG5cbiAgICBhZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmZpbmRFbGVtZW50KCdhY2Nlc3NpYmlsaXR5IGlkJywgJ1VJQ2F0YWxvZycpO1xuICAgICAgYXdhaXQgZHJpdmVyLmNsaWNrKGVsKTtcbiAgICAgIGF3YWl0IEIuZGVsYXkoMTAwMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlc3BlY3QgaW1wbGljaXQgd2FpdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGRyaXZlci5pbXBsaWNpdFdhaXQoNTAwMCk7XG5cbiAgICAgIGxldCBiZWdpbiA9IERhdGUubm93KCk7XG4gICAgICBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnQoJ3hwYXRoJywgXCIvL3NvbWV0aGluZ19ub3RfdGhlcmVcIilcbiAgICAgICAgLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkO1xuICAgICAgbGV0IGVuZCA9IERhdGUubm93KCk7XG4gICAgICAoZW5kIC0gYmVnaW4pLnNob3VsZC5iZS5hYm92ZSg1MDAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHRoZSBsYXN0IGJ1dHRvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBlbCA9IGF3YWl0IGRyaXZlci5maW5kRWxlbWVudCgneHBhdGgnLCBcIi8vVUlBQnV0dG9uW2xhc3QoKV1cIik7XG4gICAgICAoYXdhaXQgZHJpdmVyLmdldFRleHQoZWwpKS5zaG91bGQuZXF1YWwoXCJCdXR0b25cIik7IC8vIHRoaXMgaXMgdGhlIG5hbWUgb2YgdGhlIGxhc3QgYnV0dG9uXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBhIHNpbmdsZSBlbGVtZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmZpbmRFbGVtZW50KCd4cGF0aCcsIFwiLy9VSUFCdXR0b25cIik7XG4gICAgICAoYXdhaXQgZHJpdmVyLmdldFRleHQoZWwpKS5zaG91bGQuZXF1YWwoXCJVSUNhdGFsb2dcIik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBtdWx0aXBsZSBlbGVtZW50cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBlbHMgPSBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnRzKCd4cGF0aCcsIFwiLy9VSUFCdXR0b25cIik7XG4gICAgICBlbHMuc2hvdWxkLmhhdmUubGVuZ3RoLmFib3ZlKDUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmaWx0ZXIgYnkgbmFtZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBlbCA9IGF3YWl0IGRyaXZlci5maW5kRWxlbWVudCgneHBhdGgnLCBcIi8vVUlBQnV0dG9uW0BuYW1lPSdYIEJ1dHRvbiddXCIpO1xuICAgICAgKGF3YWl0IGRyaXZlci5nZXRUZXh0KGVsKSkuc2hvdWxkLmVxdWFsKFwiWCBCdXR0b25cIik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGtub3cgaG93IHRvIHJlc3RyaWN0IHJvb3QtbGV2ZWwgZWxlbWVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBCLnJlc29sdmUoZHJpdmVyLmZpbmRFbGVtZW50KCd4cGF0aCcsIFwiL1VJQUJ1dHRvblwiKSlcbiAgICAgICAgLmNhdGNoKHRocm93TWF0Y2hhYmxlRXJyb3IpXG4gICAgICAgIC5zaG91bGQuYmUucmVqZWN0ZWRXaXRoKC9qc29ud3BDb2RlOiA3Lyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNlYXJjaCBhbiBleHRlbmRlZCBwYXRoIGJ5IGNoaWxkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmZpbmRFbGVtZW50KCd4cGF0aCcsIFwiLy9VSUFOYXZpZ2F0aW9uQmFyL1VJQVN0YXRpY1RleHRcIik7XG4gICAgICAoYXdhaXQgZHJpdmVyLmdldFRleHQoZWwpKS5zaG91bGQuZXF1YWwoJ0J1dHRvbnMnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc2VhcmNoIGFuIGV4dGVuZGVkIHBhdGggYnkgZGVzY2VuZGFudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBlbHMgPSBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnRzKCd4cGF0aCcsIFwiLy9VSUFUYWJsZUNlbGwvL1VJQUJ1dHRvblwiKTtcbiAgICAgIGxldCB0ZXh0cyA9IGF3YWl0IEIuYWxsKF8ubWFwKGVscywgKGVsKSA9PiB7IHJldHVybiBkcml2ZXIuZ2V0VGV4dChlbCk7IH0pKTtcbiAgICAgIHRleHRzLnNob3VsZC5ub3QuaW5jbHVkZShcIlVJQ2F0YWxvZ1wiKTtcbiAgICAgIHRleHRzLnNob3VsZC5pbmNsdWRlKFwiWCBCdXR0b25cIik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZpbHRlciBieSBpbmRpY2VzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZHJpdmVyLmltcGxpY2l0V2FpdCgxMDAwMCk7XG4gICAgICBsZXQgZWwgPSBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnQoJ3hwYXRoJywgXCIvL1VJQVRhYmxlQ2VsbFs0XS9VSUFCdXR0b25bMV1cIik7XG4gICAgICAoYXdhaXQgZHJpdmVyLmdldEF0dHJpYnV0ZSgnbmFtZScsIGVsKSkuc2hvdWxkLmVxdWFsKCdYIEJ1dHRvbicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmaWx0ZXIgYnkgcGFydGlhbCB0ZXh0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmZpbmRFbGVtZW50KCd4cGF0aCcsIFwiLy9VSUFUYWJsZUNlbGwvL1VJQUJ1dHRvbltjb250YWlucyhAbmFtZSwgJ1ggJyldXCIpO1xuICAgICAgKGF3YWl0IGRyaXZlci5nZXRUZXh0KGVsKSkuc2hvdWxkLmVxdWFsKFwiWCBCdXR0b25cIik7XG4gICAgfSk7XG5cbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2R1cGxpY2F0ZSB0ZXh0IGZpZWxkJywgZnVuY3Rpb24gKCkge1xuXG4gICAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgZWwgPSBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnQoJ2FjY2Vzc2liaWxpdHkgaWQnLCAnVGV4dCBGaWVsZHMnKTtcbiAgICAgIGF3YWl0IGRyaXZlci5jbGljayhlbCk7XG4gICAgICBhd2FpdCBCLmRlbGF5KDIwMDApO1xuICAgIH0pO1xuXG4gICAgYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBlbCA9IGF3YWl0IGRyaXZlci5maW5kRWxlbWVudCgnYWNjZXNzaWJpbGl0eSBpZCcsICdVSUNhdGFsb2cnKTtcbiAgICAgIGF3YWl0IGRyaXZlci5jbGljayhlbCk7XG4gICAgICBhd2FpdCBCLmRlbGF5KDEwMDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmaW5kIG9ubHkgb25lIHRleHQgZmllbGQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgZWxzID0gYXdhaXQgZHJpdmVyLmZpbmRFbGVtZW50cygneHBhdGgnLCAnLy9VSUFUYWJsZVZpZXdbXCJFbXB0eSBsaXN0XCJdL1VJQVRhYmxlQ2VsbFsxXS9VSUFUZXh0RmllbGQnKTtcbiAgICAgIGVscy5zaG91bGQuaGF2ZS5sZW5ndGgoMSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZpbmQgb25seSBvbmUgdGV4dCBmaWVsZCB3aGVuIGRvaW5nIHJlbGF0aXZlIHNlYXJjaCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBlbDIgPSBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnQoJ3hwYXRoJywgJy8vVUlBVGFibGVWaWV3W1wiRW1wdHkgbGlzdFwiXScpO1xuICAgICAgbGV0IGVscyA9IGF3YWl0IGRyaXZlci5maW5kRWxlbWVudHNGcm9tRWxlbWVudCgneHBhdGgnLCAnLy9VSUFUYWJsZUNlbGxbMV0vVUlBVGV4dEZpZWxkJywgZWwyKTtcbiAgICAgIGVscy5zaG91bGQuaGF2ZS5sZW5ndGgoMSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZpbmQgb25seSBvbmUgc2VjdXJlIHRleHQgZmllbGQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgZWxzID0gYXdhaXQgZHJpdmVyLmZpbmRFbGVtZW50cygneHBhdGgnLCAnLy9VSUFUYWJsZVZpZXdbXCJFbXB0eSBsaXN0XCJdL1VJQVRhYmxlQ2VsbFszXS9VSUFTZWN1cmVUZXh0RmllbGQnKTtcbiAgICAgIGVscy5zaG91bGQuaGF2ZS5sZW5ndGgoMSk7XG4gICAgfSk7XG5cbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ211bHRpcGxlIGNhbGxzJywgZnVuY3Rpb24gKCkge1xuICAgIGxldCBydW5zID0gNTtcblxuICAgIGxldCB0ZXN0ID0gZnVuY3Rpb24gKHBhdGgsIG1pbkxlbmd0aCkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaXQoJ3Nob3VsZCBub3QgY3Jhc2gnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgbGV0IGVscyA9IGF3YWl0IGRyaXZlci5maW5kRWxlbWVudHMoJ3hwYXRoJywgcGF0aCk7XG4gICAgICAgICAgZWxzLnNob3VsZC5oYXZlLmxlbmd0aC5hYm92ZShtaW5MZW5ndGgpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgfTtcblxuICAgIGRlc2NyaWJlKCdmaW5kaW5nIHNwZWNpZmljIHBhdGgnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBmb3IgKGxldCBuID0gMDsgbiA8IHJ1bnM7IG4rKykge1xuICAgICAgICBkZXNjcmliZShgdGVzdCAke24gKyAxfWAsIHRlc3QoXCIvL1VJQUFwcGxpY2F0aW9uWzFdL1VJQVdpbmRvdy9VSUFUYWJsZVZpZXcvVUlBVGFibGVDZWxsXCIsIDE3KSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnZmluZGluZyAvLyonLCBmdW5jdGlvbiAoKSB7XG4gICAgICBmb3IgKGxldCBuID0gMDsgbiA8IHJ1bnM7IG4rKykge1xuICAgICAgICBkZXNjcmliZShgdGVzdCAke24gKyAxfWAsIHRlc3QoXCIvLypcIiwgNTIpKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==
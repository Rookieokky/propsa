require('source-map-support').install();

'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _getIterator = require('babel-runtime/core-js/get-iterator')['default'];

var _interopRequireWildcard = require('babel-runtime/helpers/interop-require-wildcard')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _ = require('../..');

var _nodeSimctl = require('node-simctl');

var simctl = _interopRequireWildcard(_nodeSimctl);

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _appiumSupport = require('appium-support');

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _sampleApps = require('sample-apps');

var _sampleApps2 = _interopRequireDefault(_sampleApps);

var LONG_TIMEOUT = 120 * 1000;

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

function runTests(deviceType) {
  describe('simulator ' + deviceType.version, function () {
    this.timeout(LONG_TIMEOUT);
    var udid = undefined;
    before(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _.killAllSimulators)());

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    beforeEach(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(simctl.createDevice('ios-simulator testing', deviceType.device, deviceType.version));

          case 2:
            udid = context$3$0.sent;

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    afterEach(function callee$2$0() {
      var devicePresent;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(simctl.getDevices());

          case 2:
            context$3$0.t0 = deviceType.version;

            context$3$0.t1 = function (device) {
              return device.udid === udid;
            };

            context$3$0.t2 = context$3$0.sent[context$3$0.t0].filter(context$3$0.t1).length;
            devicePresent = context$3$0.t2 > 0;

            if (!devicePresent) {
              context$3$0.next = 11;
              break;
            }

            context$3$0.next = 9;
            return _regeneratorRuntime.awrap((0, _.killAllSimulators)());

          case 9:
            context$3$0.next = 11;
            return _regeneratorRuntime.awrap(simctl.deleteDevice(udid));

          case 11:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should detect whether a simulator has been run before', function callee$2$0() {
      var sim;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _.getSimulator)(udid));

          case 2:
            sim = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(sim.isFresh().should.eventually.equal(true));

          case 5:
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap(sim.launchAndQuit());

          case 7:
            context$3$0.next = 9;
            return _regeneratorRuntime.awrap(sim.isFresh().should.eventually.equal(false));

          case 9:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should launch and shutdown a sim', function callee$2$0() {
      var sim;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _.getSimulator)(udid));

          case 2:
            sim = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(sim.launchAndQuit());

          case 5:
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap(sim.stat());

          case 7:
            context$3$0.sent.state.should.equal('Shutdown');

          case 8:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should launch and shutdown a sim, also starting safari', function callee$2$0() {
      var sim;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _.getSimulator)(udid));

          case 2:
            sim = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(sim.launchAndQuit(true));

          case 5:
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap(sim.stat());

          case 7:
            context$3$0.sent.state.should.equal('Shutdown');

          case 8:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should clean a sim', function callee$2$0() {
      var sim;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _.getSimulator)(udid));

          case 2:
            sim = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(sim.isFresh().should.eventually.equal(true));

          case 5:
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap(sim.launchAndQuit());

          case 7:
            context$3$0.next = 9;
            return _regeneratorRuntime.awrap(sim.isFresh().should.eventually.equal(false));

          case 9:
            context$3$0.next = 11;
            return _regeneratorRuntime.awrap(sim.clean());

          case 11:
            context$3$0.next = 13;
            return _regeneratorRuntime.awrap(sim.isFresh().should.eventually.equal(true));

          case 13:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should not find any TestApp data or bundle directories on a fresh simulator', function callee$2$0() {
      var sim, dirs;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _.getSimulator)(udid));

          case 2:
            sim = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(sim.getAppDirs('TestApp', 'io.appium.TestApp'));

          case 5:
            dirs = context$3$0.sent;

            dirs.should.have.length(0);

          case 7:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should find both a data and bundle directory for TestApp', function callee$2$0() {
      var sim, dirs;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _.getSimulator)(udid));

          case 2:
            sim = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(sim.run());

          case 5:
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap(simctl.installApp(udid, (0, _sampleApps2['default'])('TestApp')));

          case 7:
            context$3$0.next = 9;
            return _regeneratorRuntime.awrap(simctl.launch(udid, 'io.appium.TestApp'));

          case 9:
            context$3$0.next = 11;
            return _regeneratorRuntime.awrap(sim.getAppDirs('TestApp', 'io.appium.TestApp'));

          case 11:
            dirs = context$3$0.sent;

            dirs.should.have.length(2);
            dirs[0].should.contain('/Data/');
            dirs[1].should.contain('/Bundle/');

          case 15:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it.only('should be able to delete an app', function callee$2$0() {
      var sim;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _.getSimulator)(udid));

          case 2:
            sim = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(sim.run());

          case 5:
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap(simctl.launch(udid, 'io.appium.TestApp').should.eventually.be.rejectedWith(/The operation couldn’t be completed/));

          case 7:
            context$3$0.next = 9;
            return _regeneratorRuntime.awrap(simctl.installApp(udid, (0, _sampleApps2['default'])('TestApp')));

          case 9:
            context$3$0.next = 11;
            return _regeneratorRuntime.awrap(simctl.launch(udid, 'io.appium.TestApp'));

          case 11:
            context$3$0.next = 13;
            return _regeneratorRuntime.awrap(sim.removeApp('io.appium.TestApp'));

          case 13:
            context$3$0.next = 15;
            return _regeneratorRuntime.awrap(simctl.launch(udid, 'io.appium.TestApp').should.eventually.be.rejectedWith(/The operation couldn’t be completed/));

          case 15:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should delete custom app data', function callee$2$0() {
      var sim, dirs;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _.getSimulator)(udid));

          case 2:
            sim = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(sim.run());

          case 5:
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap(simctl.installApp(udid, (0, _sampleApps2['default'])('TestApp')));

          case 7:
            context$3$0.next = 9;
            return _regeneratorRuntime.awrap(simctl.launch(udid, 'io.appium.TestApp'));

          case 9:
            context$3$0.next = 11;
            return _regeneratorRuntime.awrap(sim.cleanCustomApp('TestApp', 'io.appium.TestApp'));

          case 11:

            // clear paths to force the simulator to get a new list of directories
            sim.appDataBundlePaths = {};

            context$3$0.next = 14;
            return _regeneratorRuntime.awrap(sim.getAppDirs('TestApp', 'io.appium.TestApp'));

          case 14:
            dirs = context$3$0.sent;

            dirs.should.have.length(0);

          case 16:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should delete a sim', function callee$2$0() {
      var numDevices, sim, numDevicesAfter;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(simctl.getDevices());

          case 2:
            context$3$0.t0 = deviceType.version;
            numDevices = context$3$0.sent[context$3$0.t0].length;

            numDevices.should.be.above(0);

            context$3$0.next = 7;
            return _regeneratorRuntime.awrap((0, _.getSimulator)(udid));

          case 7:
            sim = context$3$0.sent;
            context$3$0.next = 10;
            return _regeneratorRuntime.awrap(sim['delete']());

          case 10:
            context$3$0.next = 12;
            return _regeneratorRuntime.awrap(simctl.getDevices());

          case 12:
            context$3$0.t1 = deviceType.version;
            numDevicesAfter = context$3$0.sent[context$3$0.t1].length;

            numDevicesAfter.should.equal(numDevices - 1);

          case 15:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    var itText = 'should match a bundleId to its app directory on a used sim';
    var bundleId = 'com.apple.mobilesafari';
    if (deviceType.version === '7.1') {
      itText = 'should match an app to its app directory on a used sim';
      bundleId = 'MobileSafari';
    }
    it(itText, function callee$2$0() {
      var sim, path;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _.getSimulator)(udid));

          case 2:
            sim = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(sim.launchAndQuit());

          case 5:
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap(sim.getAppDir(bundleId));

          case 7:
            path = context$3$0.sent;
            context$3$0.next = 10;
            return _regeneratorRuntime.awrap(_appiumSupport.fs.hasAccess(path).should.eventually.be['true']);

          case 10:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    itText = 'should match a bundleId to its app directory on a fresh sim';
    bundleId = 'com.apple.mobilesafari';
    if (deviceType.version === '7.1') {
      itText = 'should match an app to its app directory on a fresh sim';
      bundleId = 'MobileSafari';
    }
    it(itText, function callee$2$0() {
      var sim, path;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _.getSimulator)(udid));

          case 2:
            sim = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(sim.getAppDir(bundleId));

          case 5:
            path = context$3$0.sent;
            context$3$0.next = 8;
            return _regeneratorRuntime.awrap(_appiumSupport.fs.hasAccess(path).should.eventually.be['true']);

          case 8:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should start a sim using the "run" method', function callee$2$0() {
      var sim, stat;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _.getSimulator)(udid));

          case 2:
            sim = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(sim.run());

          case 5:
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap(sim.stat());

          case 7:
            stat = context$3$0.sent;

            stat.state.should.equal('Booted');

            context$3$0.next = 11;
            return _regeneratorRuntime.awrap(sim.shutdown());

          case 11:
            context$3$0.next = 13;
            return _regeneratorRuntime.awrap(sim.stat());

          case 13:
            stat = context$3$0.sent;

            stat.state.should.equal('Shutdown');

          case 15:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should be able to start safari', function callee$2$0() {
      var sim;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _.getSimulator)(udid));

          case 2:
            sim = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(sim.run());

          case 5:
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap(sim.openUrl('http://apple.com'));

          case 7:
            context$3$0.next = 9;
            return _regeneratorRuntime.awrap(sim.shutdown());

          case 9:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    // this test to catch errors in openUrl, that arise from bad sims or certain versions of xcode
    it('should detect if a sim is running', function callee$2$0() {
      var sim, running;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _.getSimulator)(udid));

          case 2:
            sim = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(sim.isRunning());

          case 5:
            running = context$3$0.sent;

            running.should.be['false'];

            context$3$0.next = 9;
            return _regeneratorRuntime.awrap(sim.run());

          case 9:
            context$3$0.next = 11;
            return _regeneratorRuntime.awrap(sim.isRunning());

          case 11:
            running = context$3$0.sent;

            running.should.be['true'];

            context$3$0.next = 15;
            return _regeneratorRuntime.awrap(sim.shutdown());

          case 15:
            context$3$0.next = 17;
            return _regeneratorRuntime.awrap(sim.isRunning());

          case 17:
            running = context$3$0.sent;

            running.should.be['false'];

          case 19:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should isolate sim', function callee$2$0() {
      var sim, numDevices;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _.getSimulator)(udid));

          case 2:
            sim = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(sim.isolateSim());

          case 5:
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap(simctl.getDevices());

          case 7:
            context$3$0.t0 = deviceType.version;
            numDevices = context$3$0.sent[context$3$0.t0].length;

            numDevices.should.equal(1);

          case 10:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });

  describe('reuse an already-created already-run simulator ' + deviceType.version, function () {
    this.timeout(LONG_TIMEOUT);
    var sim = undefined;
    before(function callee$2$0() {
      var udid;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _.killAllSimulators)());

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(simctl.createDevice('ios-simulator testing', deviceType.device, deviceType.version));

          case 4:
            udid = context$3$0.sent;
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap((0, _.getSimulator)(udid));

          case 7:
            sim = context$3$0.sent;
            context$3$0.next = 10;
            return _regeneratorRuntime.awrap(sim.run());

          case 10:
            context$3$0.next = 12;
            return _regeneratorRuntime.awrap(sim.shutdown());

          case 12:
            context$3$0.next = 14;
            return _regeneratorRuntime.awrap(_bluebird2['default'].delay(4000));

          case 14:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    after(function callee$2$0() {
      var devicePresent;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(simctl.getDevices());

          case 2:
            context$3$0.t0 = deviceType.version;

            context$3$0.t1 = function (device) {
              return device.udid === sim.udid;
            };

            context$3$0.t2 = context$3$0.sent[context$3$0.t0].filter(context$3$0.t1).length;
            devicePresent = context$3$0.t2 > 0;

            if (!devicePresent) {
              context$3$0.next = 9;
              break;
            }

            context$3$0.next = 9;
            return _regeneratorRuntime.awrap(simctl.deleteDevice(sim.udid));

          case 9:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should start a sim using the "run" method', function callee$2$0() {
      var stat;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(sim.run());

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(sim.stat());

          case 4:
            stat = context$3$0.sent;

            stat.state.should.equal('Booted');

            context$3$0.next = 8;
            return _regeneratorRuntime.awrap(sim.shutdown());

          case 8:
            context$3$0.next = 10;
            return _regeneratorRuntime.awrap(sim.stat());

          case 10:
            stat = context$3$0.sent;

            stat.state.should.equal('Shutdown');

          case 12:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });
}

var deviceTypes = [{
  version: '8.4',
  device: 'iPhone 6'
}, {
  version: '9.0',
  device: 'iPhone 6s'
}, {
  version: '9.1',
  device: 'iPhone 6s'
}];
var _iteratorNormalCompletion = true;
var _didIteratorError = false;
var _iteratorError = undefined;

try {
  for (var _iterator = _getIterator(deviceTypes), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
    var deviceType = _step.value;

    runTests(deviceType);
  }
} catch (err) {
  _didIteratorError = true;
  _iteratorError = err;
} finally {
  try {
    if (!_iteratorNormalCompletion && _iterator['return']) {
      _iterator['return']();
    }
  } finally {
    if (_didIteratorError) {
      throw _iteratorError;
    }
  }
}

// only want to get rid of the device if it is present

// install & launch test app

// should not be able to launch

// install & launch test app

// should not be able to launch anymore

// install & launch test app

// delete app directories

// only want to get rid of the device if it is present
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3Qvc2ltdWxhdG9yLWUyZS1zcGVjcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Z0JBRWdELE9BQU87OzBCQUMvQixhQUFhOztJQUF6QixNQUFNOztvQkFDRCxNQUFNOzs7OzhCQUNJLGtCQUFrQjs7Ozs2QkFDMUIsZ0JBQWdCOzt3QkFDckIsVUFBVTs7OzswQkFDRCxhQUFhOzs7O0FBR3BDLElBQU0sWUFBWSxHQUFHLEdBQUcsR0FBQyxJQUFJLENBQUM7O0FBRTlCLGtCQUFLLE1BQU0sRUFBRSxDQUFDO0FBQ2Qsa0JBQUssR0FBRyw2QkFBZ0IsQ0FBQzs7QUFFekIsU0FBUyxRQUFRLENBQUUsVUFBVSxFQUFFO0FBQzdCLFVBQVEsZ0JBQWMsVUFBVSxDQUFDLE9BQU8sRUFBSSxZQUFZO0FBQ3RELFFBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7QUFDM0IsUUFBSSxJQUFJLFlBQUEsQ0FBQztBQUNULFVBQU0sQ0FBQzs7Ozs7NkNBQ0MsMEJBQW1COzs7Ozs7O0tBQzFCLENBQUMsQ0FBQzs7QUFFSCxjQUFVLENBQUM7Ozs7OzZDQUNJLE1BQU0sQ0FBQyxZQUFZLENBQUMsdUJBQXVCLEVBQ3ZCLFVBQVUsQ0FBQyxNQUFNLEVBQ2pCLFVBQVUsQ0FBQyxPQUFPLENBQUM7OztBQUZwRCxnQkFBSTs7Ozs7OztLQUdMLENBQUMsQ0FBQztBQUNILGFBQVMsQ0FBQztVQUVKLGFBQWE7Ozs7OzZDQUFVLE1BQU0sQ0FBQyxVQUFVLEVBQUU7Ozs2QkFBRSxVQUFVLENBQUMsT0FBTzs7NkJBQ3hELFVBQUMsTUFBTSxFQUFLO0FBQ2xCLHFCQUFPLE1BQU0sQ0FBQyxJQUFJLEtBQUssSUFBSSxDQUFDO2FBQzdCOzs4REFGQSxNQUFNLGlCQUVKLE1BQU07QUFIUCx5QkFBYSxvQkFHSCxDQUFDOztpQkFDWCxhQUFhOzs7Ozs7NkNBQ1QsMEJBQW1COzs7OzZDQUNuQixNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQzs7Ozs7OztL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QUM7Ozs7Ozs7S0FDckMsQ0FBQyxDQUFDO0dBQ0osQ0FBQyxDQUFDO0NBQ0o7O0FBRUQsSUFBTSxXQUFXLEdBQUcsQ0FDbEI7QUFDRSxTQUFPLEVBQUUsS0FBSztBQUNkLFFBQU0sRUFBRSxVQUFVO0NBQ25CLEVBQ0Q7QUFDRSxTQUFPLEVBQUUsS0FBSztBQUNkLFFBQU0sRUFBRSxXQUFXO0NBQ3BCLEVBQ0Q7QUFDRSxTQUFPLEVBQUUsS0FBSztBQUNkLFFBQU0sRUFBRSxXQUFXO0NBQ3BCLENBQ0YsQ0FBQzs7Ozs7O0FBQ0Ysb0NBQXVCLFdBQVcsNEdBQUU7UUFBM0IsVUFBVTs7QUFDakIsWUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0dBQ3RCIiwiZmlsZSI6InRlc3Qvc2ltdWxhdG9yLWUyZS1zcGVjcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIHRyYW5zcGlsZTptb2NoYVxuXG5pbXBvcnQgeyBnZXRTaW11bGF0b3IsIGtpbGxBbGxTaW11bGF0b3JzIH0gZnJvbSAnLi4vLi4nO1xuaW1wb3J0ICogYXMgc2ltY3RsIGZyb20gJ25vZGUtc2ltY3RsJztcbmltcG9ydCBjaGFpIGZyb20gJ2NoYWknO1xuaW1wb3J0IGNoYWlBc1Byb21pc2VkIGZyb20gJ2NoYWktYXMtcHJvbWlzZWQnO1xuaW1wb3J0IHsgZnMgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgZ2V0QXBwUGF0aCBmcm9tICdzYW1wbGUtYXBwcyc7XG5cblxuY29uc3QgTE9OR19USU1FT1VUID0gMTIwKjEwMDA7XG5cbmNoYWkuc2hvdWxkKCk7XG5jaGFpLnVzZShjaGFpQXNQcm9taXNlZCk7XG5cbmZ1bmN0aW9uIHJ1blRlc3RzIChkZXZpY2VUeXBlKSB7XG4gIGRlc2NyaWJlKGBzaW11bGF0b3IgJHtkZXZpY2VUeXBlLnZlcnNpb259YCwgZnVuY3Rpb24gKCkge1xuICAgIHRoaXMudGltZW91dChMT05HX1RJTUVPVVQpO1xuICAgIGxldCB1ZGlkO1xuICAgIGJlZm9yZShhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBhd2FpdCBraWxsQWxsU2ltdWxhdG9ycygpO1xuICAgIH0pO1xuXG4gICAgYmVmb3JlRWFjaChhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICB1ZGlkID0gYXdhaXQgc2ltY3RsLmNyZWF0ZURldmljZSgnaW9zLXNpbXVsYXRvciB0ZXN0aW5nJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUuZGV2aWNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZS52ZXJzaW9uKTtcbiAgICB9KTtcbiAgICBhZnRlckVhY2goYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgLy8gb25seSB3YW50IHRvIGdldCByaWQgb2YgdGhlIGRldmljZSBpZiBpdCBpcyBwcmVzZW50XG4gICAgICBsZXQgZGV2aWNlUHJlc2VudCA9IChhd2FpdCBzaW1jdGwuZ2V0RGV2aWNlcygpKVtkZXZpY2VUeXBlLnZlcnNpb25dXG4gICAgICAgIC5maWx0ZXIoKGRldmljZSkgPT4ge1xuICAgICAgICAgIHJldHVybiBkZXZpY2UudWRpZCA9PT0gdWRpZDtcbiAgICAgICAgfSkubGVuZ3RoID4gMDtcbiAgICAgIGlmIChkZXZpY2VQcmVzZW50KSB7XG4gICAgICAgIGF3YWl0IGtpbGxBbGxTaW11bGF0b3JzKCk7XG4gICAgICAgIGF3YWl0IHNpbWN0bC5kZWxldGVEZXZpY2UodWRpZCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRldGVjdCB3aGV0aGVyIGEgc2ltdWxhdG9yIGhhcyBiZWVuIHJ1biBiZWZvcmUnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgc2ltID0gYXdhaXQgZ2V0U2ltdWxhdG9yKHVkaWQpO1xuICAgICAgYXdhaXQgc2ltLmlzRnJlc2goKS5zaG91bGQuZXZlbnR1YWxseS5lcXVhbCh0cnVlKTtcbiAgICAgIGF3YWl0IHNpbS5sYXVuY2hBbmRRdWl0KCk7XG4gICAgICBhd2FpdCBzaW0uaXNGcmVzaCgpLnNob3VsZC5ldmVudHVhbGx5LmVxdWFsKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbGF1bmNoIGFuZCBzaHV0ZG93biBhIHNpbScsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBzaW0gPSBhd2FpdCBnZXRTaW11bGF0b3IodWRpZCk7XG4gICAgICBhd2FpdCBzaW0ubGF1bmNoQW5kUXVpdCgpO1xuICAgICAgKGF3YWl0IHNpbS5zdGF0KCkpLnN0YXRlLnNob3VsZC5lcXVhbCgnU2h1dGRvd24nKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbGF1bmNoIGFuZCBzaHV0ZG93biBhIHNpbSwgYWxzbyBzdGFydGluZyBzYWZhcmknLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgc2ltID0gYXdhaXQgZ2V0U2ltdWxhdG9yKHVkaWQpO1xuICAgICAgYXdhaXQgc2ltLmxhdW5jaEFuZFF1aXQodHJ1ZSk7XG4gICAgICAoYXdhaXQgc2ltLnN0YXQoKSkuc3RhdGUuc2hvdWxkLmVxdWFsKCdTaHV0ZG93bicpO1xuICAgIH0pO1xuXG5cbiAgICBpdCgnc2hvdWxkIGNsZWFuIGEgc2ltJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IHNpbSA9IGF3YWl0IGdldFNpbXVsYXRvcih1ZGlkKTtcbiAgICAgIGF3YWl0IHNpbS5pc0ZyZXNoKCkuc2hvdWxkLmV2ZW50dWFsbHkuZXF1YWwodHJ1ZSk7XG4gICAgICBhd2FpdCBzaW0ubGF1bmNoQW5kUXVpdCgpO1xuICAgICAgYXdhaXQgc2ltLmlzRnJlc2goKS5zaG91bGQuZXZlbnR1YWxseS5lcXVhbChmYWxzZSk7XG4gICAgICBhd2FpdCBzaW0uY2xlYW4oKTtcbiAgICAgIGF3YWl0IHNpbS5pc0ZyZXNoKCkuc2hvdWxkLmV2ZW50dWFsbHkuZXF1YWwodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCBmaW5kIGFueSBUZXN0QXBwIGRhdGEgb3IgYnVuZGxlIGRpcmVjdG9yaWVzIG9uIGEgZnJlc2ggc2ltdWxhdG9yJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IHNpbSA9IGF3YWl0IGdldFNpbXVsYXRvcih1ZGlkKTtcbiAgICAgIGxldCBkaXJzID0gYXdhaXQgc2ltLmdldEFwcERpcnMoJ1Rlc3RBcHAnLCAnaW8uYXBwaXVtLlRlc3RBcHAnKTtcbiAgICAgIGRpcnMuc2hvdWxkLmhhdmUubGVuZ3RoKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmaW5kIGJvdGggYSBkYXRhIGFuZCBidW5kbGUgZGlyZWN0b3J5IGZvciBUZXN0QXBwJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IHNpbSA9IGF3YWl0IGdldFNpbXVsYXRvcih1ZGlkKTtcbiAgICAgIGF3YWl0IHNpbS5ydW4oKTtcblxuICAgICAgLy8gaW5zdGFsbCAmIGxhdW5jaCB0ZXN0IGFwcFxuICAgICAgYXdhaXQgc2ltY3RsLmluc3RhbGxBcHAodWRpZCwgZ2V0QXBwUGF0aCgnVGVzdEFwcCcpKTtcbiAgICAgIGF3YWl0IHNpbWN0bC5sYXVuY2godWRpZCwgJ2lvLmFwcGl1bS5UZXN0QXBwJyk7XG5cbiAgICAgIGxldCBkaXJzID0gYXdhaXQgc2ltLmdldEFwcERpcnMoJ1Rlc3RBcHAnLCAnaW8uYXBwaXVtLlRlc3RBcHAnKTtcbiAgICAgIGRpcnMuc2hvdWxkLmhhdmUubGVuZ3RoKDIpO1xuICAgICAgZGlyc1swXS5zaG91bGQuY29udGFpbignL0RhdGEvJyk7XG4gICAgICBkaXJzWzFdLnNob3VsZC5jb250YWluKCcvQnVuZGxlLycpO1xuICAgIH0pO1xuXG4gICAgaXQub25seSgnc2hvdWxkIGJlIGFibGUgdG8gZGVsZXRlIGFuIGFwcCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBzaW0gPSBhd2FpdCBnZXRTaW11bGF0b3IodWRpZCk7XG4gICAgICBhd2FpdCBzaW0ucnVuKCk7XG5cbiAgICAgIC8vIHNob3VsZCBub3QgYmUgYWJsZSB0byBsYXVuY2hcbiAgICAgIGF3YWl0IHNpbWN0bC5sYXVuY2godWRpZCwgJ2lvLmFwcGl1bS5UZXN0QXBwJylcbiAgICAgICAgLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkV2l0aCgvVGhlIG9wZXJhdGlvbiBjb3VsZG7igJl0IGJlIGNvbXBsZXRlZC8pO1xuXG4gICAgICAvLyBpbnN0YWxsICYgbGF1bmNoIHRlc3QgYXBwXG4gICAgICBhd2FpdCBzaW1jdGwuaW5zdGFsbEFwcCh1ZGlkLCBnZXRBcHBQYXRoKCdUZXN0QXBwJykpO1xuICAgICAgYXdhaXQgc2ltY3RsLmxhdW5jaCh1ZGlkLCAnaW8uYXBwaXVtLlRlc3RBcHAnKTtcblxuICAgICAgYXdhaXQgc2ltLnJlbW92ZUFwcCgnaW8uYXBwaXVtLlRlc3RBcHAnKTtcblxuICAgICAgLy8gc2hvdWxkIG5vdCBiZSBhYmxlIHRvIGxhdW5jaCBhbnltb3JlXG4gICAgICBhd2FpdCBzaW1jdGwubGF1bmNoKHVkaWQsICdpby5hcHBpdW0uVGVzdEFwcCcpXG4gICAgICAgIC5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZFdpdGgoL1RoZSBvcGVyYXRpb24gY291bGRu4oCZdCBiZSBjb21wbGV0ZWQvKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGVsZXRlIGN1c3RvbSBhcHAgZGF0YScsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBzaW0gPSBhd2FpdCBnZXRTaW11bGF0b3IodWRpZCk7XG4gICAgICBhd2FpdCBzaW0ucnVuKCk7XG5cbiAgICAgIC8vIGluc3RhbGwgJiBsYXVuY2ggdGVzdCBhcHBcbiAgICAgIGF3YWl0IHNpbWN0bC5pbnN0YWxsQXBwKHVkaWQsIGdldEFwcFBhdGgoJ1Rlc3RBcHAnKSk7XG4gICAgICBhd2FpdCBzaW1jdGwubGF1bmNoKHVkaWQsICdpby5hcHBpdW0uVGVzdEFwcCcpO1xuXG4gICAgICAvLyBkZWxldGUgYXBwIGRpcmVjdG9yaWVzXG4gICAgICBhd2FpdCBzaW0uY2xlYW5DdXN0b21BcHAoJ1Rlc3RBcHAnLCAnaW8uYXBwaXVtLlRlc3RBcHAnKTtcblxuICAgICAgLy8gY2xlYXIgcGF0aHMgdG8gZm9yY2UgdGhlIHNpbXVsYXRvciB0byBnZXQgYSBuZXcgbGlzdCBvZiBkaXJlY3Rvcmllc1xuICAgICAgc2ltLmFwcERhdGFCdW5kbGVQYXRocyA9IHt9O1xuXG4gICAgICBsZXQgZGlycyA9IGF3YWl0IHNpbS5nZXRBcHBEaXJzKCdUZXN0QXBwJywgJ2lvLmFwcGl1bS5UZXN0QXBwJyk7XG4gICAgICBkaXJzLnNob3VsZC5oYXZlLmxlbmd0aCgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGVsZXRlIGEgc2ltJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IG51bURldmljZXMgPSAoYXdhaXQgc2ltY3RsLmdldERldmljZXMoKSlbZGV2aWNlVHlwZS52ZXJzaW9uXS5sZW5ndGg7XG4gICAgICBudW1EZXZpY2VzLnNob3VsZC5iZS5hYm92ZSgwKTtcblxuICAgICAgbGV0IHNpbSA9IGF3YWl0IGdldFNpbXVsYXRvcih1ZGlkKTtcbiAgICAgIGF3YWl0IHNpbS5kZWxldGUoKTtcbiAgICAgIGxldCBudW1EZXZpY2VzQWZ0ZXIgPSAoYXdhaXQgc2ltY3RsLmdldERldmljZXMoKSlbZGV2aWNlVHlwZS52ZXJzaW9uXS5sZW5ndGg7XG4gICAgICBudW1EZXZpY2VzQWZ0ZXIuc2hvdWxkLmVxdWFsKG51bURldmljZXMtMSk7XG4gICAgfSk7XG5cbiAgICBsZXQgaXRUZXh0ID0gJ3Nob3VsZCBtYXRjaCBhIGJ1bmRsZUlkIHRvIGl0cyBhcHAgZGlyZWN0b3J5IG9uIGEgdXNlZCBzaW0nO1xuICAgIGxldCBidW5kbGVJZCA9ICdjb20uYXBwbGUubW9iaWxlc2FmYXJpJztcbiAgICBpZiAoZGV2aWNlVHlwZS52ZXJzaW9uID09PSAnNy4xJykge1xuICAgICAgaXRUZXh0ID0gJ3Nob3VsZCBtYXRjaCBhbiBhcHAgdG8gaXRzIGFwcCBkaXJlY3Rvcnkgb24gYSB1c2VkIHNpbSc7XG4gICAgICBidW5kbGVJZCA9ICdNb2JpbGVTYWZhcmknO1xuICAgIH1cbiAgICBpdChpdFRleHQsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBzaW0gPSBhd2FpdCBnZXRTaW11bGF0b3IodWRpZCk7XG4gICAgICBhd2FpdCBzaW0ubGF1bmNoQW5kUXVpdCgpO1xuXG4gICAgICBsZXQgcGF0aCA9IGF3YWl0IHNpbS5nZXRBcHBEaXIoYnVuZGxlSWQpO1xuICAgICAgYXdhaXQgZnMuaGFzQWNjZXNzKHBhdGgpLnNob3VsZC5ldmVudHVhbGx5LmJlLnRydWU7XG4gICAgfSk7XG5cbiAgICBpdFRleHQgPSAnc2hvdWxkIG1hdGNoIGEgYnVuZGxlSWQgdG8gaXRzIGFwcCBkaXJlY3Rvcnkgb24gYSBmcmVzaCBzaW0nO1xuICAgIGJ1bmRsZUlkID0gJ2NvbS5hcHBsZS5tb2JpbGVzYWZhcmknO1xuICAgIGlmIChkZXZpY2VUeXBlLnZlcnNpb24gPT09ICc3LjEnKSB7XG4gICAgICBpdFRleHQgPSAnc2hvdWxkIG1hdGNoIGFuIGFwcCB0byBpdHMgYXBwIGRpcmVjdG9yeSBvbiBhIGZyZXNoIHNpbSc7XG4gICAgICBidW5kbGVJZCA9ICdNb2JpbGVTYWZhcmknO1xuICAgIH1cbiAgICBpdChpdFRleHQsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBzaW0gPSBhd2FpdCBnZXRTaW11bGF0b3IodWRpZCk7XG4gICAgICBsZXQgcGF0aCA9IGF3YWl0IHNpbS5nZXRBcHBEaXIoYnVuZGxlSWQpO1xuICAgICAgYXdhaXQgZnMuaGFzQWNjZXNzKHBhdGgpLnNob3VsZC5ldmVudHVhbGx5LmJlLnRydWU7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHN0YXJ0IGEgc2ltIHVzaW5nIHRoZSBcInJ1blwiIG1ldGhvZCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBzaW0gPSBhd2FpdCBnZXRTaW11bGF0b3IodWRpZCk7XG5cbiAgICAgIGF3YWl0IHNpbS5ydW4oKTtcblxuICAgICAgbGV0IHN0YXQgPSBhd2FpdCBzaW0uc3RhdCgpO1xuICAgICAgc3RhdC5zdGF0ZS5zaG91bGQuZXF1YWwoJ0Jvb3RlZCcpO1xuXG4gICAgICBhd2FpdCBzaW0uc2h1dGRvd24oKTtcbiAgICAgIHN0YXQgPSBhd2FpdCBzaW0uc3RhdCgpO1xuICAgICAgc3RhdC5zdGF0ZS5zaG91bGQuZXF1YWwoJ1NodXRkb3duJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGJlIGFibGUgdG8gc3RhcnQgc2FmYXJpJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IHNpbSA9IGF3YWl0IGdldFNpbXVsYXRvcih1ZGlkKTtcblxuICAgICAgYXdhaXQgc2ltLnJ1bigpO1xuICAgICAgYXdhaXQgc2ltLm9wZW5VcmwoJ2h0dHA6Ly9hcHBsZS5jb20nKTtcbiAgICAgIGF3YWl0IHNpbS5zaHV0ZG93bigpO1xuXG4gICAgICAvLyB0aGlzIHRlc3QgdG8gY2F0Y2ggZXJyb3JzIGluIG9wZW5VcmwsIHRoYXQgYXJpc2UgZnJvbSBiYWQgc2ltcyBvciBjZXJ0YWluIHZlcnNpb25zIG9mIHhjb2RlXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRldGVjdCBpZiBhIHNpbSBpcyBydW5uaW5nJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IHNpbSA9IGF3YWl0IGdldFNpbXVsYXRvcih1ZGlkKTtcbiAgICAgIGxldCBydW5uaW5nID0gYXdhaXQgc2ltLmlzUnVubmluZygpO1xuICAgICAgcnVubmluZy5zaG91bGQuYmUuZmFsc2U7XG5cbiAgICAgIGF3YWl0IHNpbS5ydW4oKTtcbiAgICAgIHJ1bm5pbmcgPSBhd2FpdCBzaW0uaXNSdW5uaW5nKCk7XG4gICAgICBydW5uaW5nLnNob3VsZC5iZS50cnVlO1xuXG4gICAgICBhd2FpdCBzaW0uc2h1dGRvd24oKTtcbiAgICAgIHJ1bm5pbmcgPSBhd2FpdCBzaW0uaXNSdW5uaW5nKCk7XG4gICAgICBydW5uaW5nLnNob3VsZC5iZS5mYWxzZTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaXNvbGF0ZSBzaW0nLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgc2ltID0gYXdhaXQgZ2V0U2ltdWxhdG9yKHVkaWQpO1xuICAgICAgYXdhaXQgc2ltLmlzb2xhdGVTaW0oKTtcblxuICAgICAgbGV0IG51bURldmljZXMgPSAoYXdhaXQgc2ltY3RsLmdldERldmljZXMoKSlbZGV2aWNlVHlwZS52ZXJzaW9uXS5sZW5ndGg7XG5cbiAgICAgIG51bURldmljZXMuc2hvdWxkLmVxdWFsKDEpO1xuICAgIH0pO1xuXG4gIH0pO1xuXG4gIGRlc2NyaWJlKGByZXVzZSBhbiBhbHJlYWR5LWNyZWF0ZWQgYWxyZWFkeS1ydW4gc2ltdWxhdG9yICR7ZGV2aWNlVHlwZS52ZXJzaW9ufWAsIGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnRpbWVvdXQoTE9OR19USU1FT1VUKTtcbiAgICBsZXQgc2ltO1xuICAgIGJlZm9yZShhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBhd2FpdCBraWxsQWxsU2ltdWxhdG9ycygpO1xuICAgICAgbGV0IHVkaWQgPSBhd2FpdCBzaW1jdGwuY3JlYXRlRGV2aWNlKCdpb3Mtc2ltdWxhdG9yIHRlc3RpbmcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZS5kZXZpY2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLnZlcnNpb24pO1xuICAgICAgc2ltID0gYXdhaXQgZ2V0U2ltdWxhdG9yKHVkaWQpO1xuICAgICAgYXdhaXQgc2ltLnJ1bigpO1xuICAgICAgYXdhaXQgc2ltLnNodXRkb3duKCk7XG4gICAgICBhd2FpdCBCLmRlbGF5KDQwMDApO1xuICAgIH0pO1xuICAgIGFmdGVyKGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIG9ubHkgd2FudCB0byBnZXQgcmlkIG9mIHRoZSBkZXZpY2UgaWYgaXQgaXMgcHJlc2VudFxuICAgICAgbGV0IGRldmljZVByZXNlbnQgPSAoYXdhaXQgc2ltY3RsLmdldERldmljZXMoKSlbZGV2aWNlVHlwZS52ZXJzaW9uXVxuICAgICAgICAuZmlsdGVyKChkZXZpY2UpID0+IHtcbiAgICAgICAgICByZXR1cm4gZGV2aWNlLnVkaWQgPT09IHNpbS51ZGlkO1xuICAgICAgICB9KS5sZW5ndGggPiAwO1xuICAgICAgaWYgKGRldmljZVByZXNlbnQpIHtcbiAgICAgICAgYXdhaXQgc2ltY3RsLmRlbGV0ZURldmljZShzaW0udWRpZCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHN0YXJ0IGEgc2ltIHVzaW5nIHRoZSBcInJ1blwiIG1ldGhvZCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGF3YWl0IHNpbS5ydW4oKTtcblxuICAgICAgbGV0IHN0YXQgPSBhd2FpdCBzaW0uc3RhdCgpO1xuICAgICAgc3RhdC5zdGF0ZS5zaG91bGQuZXF1YWwoJ0Jvb3RlZCcpO1xuXG4gICAgICBhd2FpdCBzaW0uc2h1dGRvd24oKTtcbiAgICAgIHN0YXQgPSBhd2FpdCBzaW0uc3RhdCgpO1xuICAgICAgc3RhdC5zdGF0ZS5zaG91bGQuZXF1YWwoJ1NodXRkb3duJyk7XG4gICAgfSk7XG4gIH0pO1xufVxuXG5jb25zdCBkZXZpY2VUeXBlcyA9IFtcbiAge1xuICAgIHZlcnNpb246ICc4LjQnLFxuICAgIGRldmljZTogJ2lQaG9uZSA2J1xuICB9LFxuICB7XG4gICAgdmVyc2lvbjogJzkuMCcsXG4gICAgZGV2aWNlOiAnaVBob25lIDZzJ1xuICB9LFxuICB7XG4gICAgdmVyc2lvbjogJzkuMScsXG4gICAgZGV2aWNlOiAnaVBob25lIDZzJ1xuICB9XG5dO1xuZm9yIChsZXQgZGV2aWNlVHlwZSBvZiBkZXZpY2VUeXBlcykge1xuICBydW5UZXN0cyhkZXZpY2VUeXBlKTtcbn1cbiJdfQ==